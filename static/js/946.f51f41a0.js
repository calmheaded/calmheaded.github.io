"use strict";(self.webpackChunkthree_model_viewer=self.webpackChunkthree_model_viewer||[]).push([[946],{1946:function(e,s,t){t.r(s),t.d(s,{TDSLoader:function(){return r}});var a=t(216);class r extends a.aNw{constructor(e){super(e),this.debug=!1,this.group=null,this.materials=[],this.meshes=[]}load(e,s,t,r){const i=this,d=""===this.path?a.Zp0.extractUrlBase(e):this.path;var h=new a.hH6(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,(function(t){try{s(i.parse(t,d))}catch(t){r&&r(t),i.manager.itemError(e)}}),t,r)}parse(e,s){this.group=new a.ZAu,this.materials=[],this.meshes=[],this.readFile(e,s);for(let t=0;t<this.meshes.length;t++)this.group.add(this.meshes[t]);return this.group}readFile(e,s){e=new DataView(e);var t,a=new i(e,0,this.debugMessage);if(a.id===h||a.id===n||a.id===d){let e=a.readChunk();for(;e;)e.id===o?(t=e.readDWord(),this.debugMessage("3DS file version: "+t)):e.id===b?this.readMeshData(e,s):this.debugMessage("Unknown main chunk: "+e.hexId),e=a.readChunk()}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,s){let t=e.readChunk();for(;t;){var a;t.id===m?(a=+t.readDWord(),this.debugMessage("Mesh Version: "+a)):t.id===f?(a=t.readFloat(),this.debugMessage("Master scale: "+a),this.group.scale.set(a,a,a)):t.id===j?(this.debugMessage("Named Object"),this.readNamedObject(t)):t.id===k?(this.debugMessage("Material"),this.readMaterialEntry(t,s)):this.debugMessage("Unknown MDATA chunk: "+t.hexId),t=e.readChunk()}}readNamedObject(e){var s,t=e.readString();let a=e.readChunk();for(;a;)a.id===V?((s=this.readMesh(a)).name=t,this.meshes.push(s)):this.debugMessage("Unknown named object chunk: "+a.hexId),a=e.readChunk()}readMaterialEntry(e,s){let t=e.readChunk();for(var r,i,d=new a.xoR;t;)t.id===w?(d.name=t.readString(),this.debugMessage("   Name: "+d.name)):t.id===S?(this.debugMessage("   Wireframe"),d.wireframe=!0):t.id===U?(r=t.readByte(),d.wireframeLinewidth=r,this.debugMessage("   Wireframe Thickness: "+r)):t.id===W?(d.side=a.ehD,this.debugMessage("   DoubleSided")):t.id===I?(this.debugMessage("   Additive Blending"),d.blending=a.WMw):t.id===C?(this.debugMessage("   Diffuse Color"),d.color=this.readColor(t)):t.id===v?(this.debugMessage("   Specular Color"),d.specular=this.readColor(t)):t.id===y?(this.debugMessage("   Ambient color"),d.color=this.readColor(t)):t.id===x?(r=this.readPercentage(t),d.shininess=100*r,this.debugMessage("   Shininess : "+r)):t.id===F?(i=this.readPercentage(t),d.opacity=1-i,this.debugMessage("  Transparency : "+i),d.transparent=d.opacity<1):t.id===D?(this.debugMessage("   ColorMap"),d.map=this.readMap(t,s)):t.id===O?(this.debugMessage("   BumpMap"),d.bumpMap=this.readMap(t,s)):t.id===B?(this.debugMessage("   OpacityMap"),d.alphaMap=this.readMap(t,s)):t.id===A?(this.debugMessage("   SpecularMap"),d.specularMap=this.readMap(t,s)):this.debugMessage("   Unknown material chunk: "+t.hexId),t=e.readChunk();this.materials[d.name]=d}readMesh(e){let s=e.readChunk();var t=new a.u9r,r=new a.xoR,i=new a.Kj0(t,r);for(i.name="mesh";s;){if(s.id===z){var d=s.readWord(),h=(this.debugMessage("   Vertex: "+d),[]);for(let e=0;e<d;e++)h.push(s.readFloat()),h.push(s.readFloat()),h.push(s.readFloat());t.setAttribute("position",new a.a$l(h,3))}else if(s.id===L)this.readFaceArray(s,i);else if(s.id===q){var n=s.readWord(),o=(this.debugMessage("   UV: "+n),[]);for(let e=0;e<n;e++)o.push(s.readFloat()),o.push(s.readFloat());t.setAttribute("uv",new a.a$l(o,2))}else if(s.id===E){this.debugMessage("   Tranformation Matrix (TODO)");var u=[];for(let e=0;e<12;e++)u[e]=s.readFloat();var g=new a.yGw,l=(g.elements[0]=u[0],g.elements[1]=u[6],g.elements[2]=u[3],g.elements[3]=u[9],g.elements[4]=u[2],g.elements[5]=u[8],g.elements[6]=u[5],g.elements[7]=u[11],g.elements[8]=u[1],g.elements[9]=u[7],g.elements[10]=u[4],g.elements[11]=u[10],g.elements[12]=0,g.elements[13]=0,g.elements[14]=0,g.elements[15]=1,g.transpose(),new a.yGw);l.copy(g).invert(),t.applyMatrix4(l),g.decompose(i.position,i.quaternion,i.scale)}else this.debugMessage("   Unknown mesh chunk: "+s.hexId);s=e.readChunk()}return t.computeVertexNormals(),i}readFaceArray(e,s){var t=e.readWord(),a=(this.debugMessage("   Faces: "+t),[]);for(let o=0;o<t;++o)a.push(e.readWord(),e.readWord(),e.readWord()),e.readWord();s.geometry.setIndex(a);let r=0,i=0;for(;!e.endOfChunk;){var d,h,n=e.readChunk();n.id===_?(this.debugMessage("      Material Group"),h=3*(d=this.readMaterialGroup(n)).index.length,s.geometry.addGroup(i,h,r),i+=h,r++,h=this.materials[d.name],!1===Array.isArray(s.material)&&(s.material=[]),void 0!==h&&s.material.push(h)):this.debugMessage("      Unknown face array chunk: "+n.hexId)}1===s.material.length&&(s.material=s.material[0])}readMap(e,s){let t=e.readChunk(),r={};var i,d=new a.dpR(this.manager);for(d.setPath(this.resourcePath||s).setCrossOrigin(this.crossOrigin);t;)t.id===R?(i=t.readString(),r=d.load(i),this.debugMessage("      File: "+s+i)):t.id===P?(r.offset.x=t.readFloat(),this.debugMessage("      OffsetX: "+r.offset.x)):t.id===T?(r.offset.y=t.readFloat(),this.debugMessage("      OffsetY: "+r.offset.y)):t.id===G?(r.repeat.x=t.readFloat(),this.debugMessage("      RepeatX: "+r.repeat.x)):t.id===N?(r.repeat.y=t.readFloat(),this.debugMessage("      RepeatY: "+r.repeat.y)):this.debugMessage("      Unknown map chunk: "+t.hexId),t=e.readChunk();return r}readMaterialGroup(e){var s=e.readString(),t=e.readWord(),a=(this.debugMessage("         Name: "+s),this.debugMessage("         Faces: "+t),[]);for(let r=0;r<t;++r)a.push(e.readWord());return{name:s,index:a}}readColor(e){e=e.readChunk();var s,t,r,i=new a.Ilk;return e.id===g||e.id===l?(s=e.readByte(),t=e.readByte(),r=e.readByte(),i.setRGB(s/255,t/255,r/255),this.debugMessage("      Color: "+i.r+", "+i.g+", "+i.b)):e.id===u||e.id===p?(s=e.readFloat(),t=e.readFloat(),r=e.readFloat(),i.setRGB(s,t,r),this.debugMessage("      Color: "+i.r+", "+i.g+", "+i.b)):this.debugMessage("      Unknown color chunk: "+e.hexId),i}readPercentage(e){var s=e.readChunk();switch(s.id){case M:return s.readShort()/100;case c:return s.readFloat();default:return this.debugMessage("      Unknown percentage chunk: "+s.hexId),0}}debugMessage(e){this.debug}}class i{constructor(e,s,t){this.data=e,this.offset=s,this.position=s,this.debugMessage=t,this.debugMessage instanceof Function&&(this.debugMessage=function(){}),this.id=this.readWord(),this.size=this.readDWord(),this.end=this.offset+this.size,this.end>e.byteLength&&this.debugMessage("Bad chunk size for chunk at "+s)}readChunk(){if(this.endOfChunk)return null;try{var e=new i(this.data,this.position,this.debugMessage);return this.position+=e.size,e}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),null}}get hexId(){return this.id.toString(16)}get endOfChunk(){return this.position>=this.end}readByte(){var e=this.data.getUint8(this.position,!0);return this.position+=1,e}readFloat(){try{var e=this.data.getFloat32(this.position,!0);return this.position+=4,e}catch(e){return this.debugMessage(e+" "+this.position+" "+this.data.byteLength),0}}readInt(){var e=this.data.getInt32(this.position,!0);return this.position+=4,e}readShort(){var e=this.data.getInt16(this.position,!0);return this.position+=2,e}readDWord(){var e=this.data.getUint32(this.position,!0);return this.position+=4,e}readWord(){var e=this.data.getUint16(this.position,!0);return this.position+=2,e}readString(){let e="",s=this.readByte();for(;s;)e+=String.fromCharCode(s),s=this.readByte();return e}}const d=19789,h=15786,n=49725,o=2,u=16,g=17,l=18,p=19,M=48,c=49,b=15677,m=15678,f=256,k=45055,w=40960,y=40976,C=40992,v=41008,x=41024,F=41040,W=41089,I=41091,S=41093,U=41095,D=41472,B=41488,O=41520,A=41476,R=41728,G=41812,N=41814,P=41816,T=41818,j=16384,V=16640,z=16656,L=16672,_=16688,q=16704,E=16736}}]);