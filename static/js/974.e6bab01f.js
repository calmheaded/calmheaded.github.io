"use strict";(self.webpackChunkthree_model_viewer=self.webpackChunkthree_model_viewer||[]).push([[974],{2974:function(e,t,r){r.r(t),r.d(t,{ColladaLoader:function(){return i}});var a=r(216);class n extends a.yxD{constructor(e){super(e)}parse(e){e.length;var t=0;const r=new Uint8Array(e),n={id_length:r[t++],colormap_type:r[t++],image_type:r[t++],colormap_index:r[t++]|r[t++]<<8,colormap_length:r[t++]|r[t++]<<8,colormap_size:r[t++],origin:[r[t++]|r[t++]<<8,r[t++]|r[t++]<<8],width:r[t++]|r[t++]<<8,height:r[t++]|r[t++]<<8,pixel_size:r[t++],flags:r[t++]};var i=n;switch(i.image_type){case 1:case 9:256<i.colormap_length||24!==i.colormap_size||i.colormap_type;break;case 2:case 3:case 10:case 11:i.colormap_type}i.width<=0||i.height,8!==i.pixel_size&&16!==i.pixel_size&&24!==i.pixel_size&&i.pixel_size,n.id_length,e.length,t+=n.id_length;let s=!1,o=!1,l=!1;switch(n.image_type){case 9:s=!0,o=!0;break;case 1:o=!0;break;case 10:s=!0;break;case 2:break;case 11:s=!0,l=!0;break;case 3:l=!0}e=new Uint8Array(n.width*n.height*4),t=function(e,t,r,a,n){let i,s;var o=r.pixel_size>>3,l=r.width*r.height*o;if(t&&(s=n.subarray(a,a+=r.colormap_length*(r.colormap_size>>3))),e){i=new Uint8Array(l);let e,t,r,s=0;for(var c=new Uint8Array(o);s<l;)if(e=n[a++],t=1+(127&e),128&e){for(r=0;r<o;++r)c[r]=n[a++];for(r=0;r<t;++r)i.set(c,s+r*o);s+=o*t}else{for(t*=o,r=0;r<t;++r)i[s+r]=n[a++];s+=t}}else i=n.subarray(a,a+=t?r.width*r.height:l);return{pixel_data:i,palettes:s}}(s,o,n,t,r);{var c=e,d=n.width,u=n.height,h=t.pixel_data,f=t.palettes;let r,a,i,s,o,fe;switch((48&n.flags)>>4){default:case 2:r=0,i=1,o=d,a=0,s=1,fe=u;break;case 0:r=0,i=1,o=d,a=u-1,s=-1,fe=-1;break;case 3:r=d-1,i=-1,o=-1,a=0,s=1,fe=u;break;case 1:r=d-1,i=-1,o=-1,a=u-1,s=-1,fe=-1}if(l)switch(n.pixel_size){case 8:{var m=c,p=a,v=s,g=fe,b=r,y=i,N=o,x=h;let e,t,l,d=0;var w=n.width;for(l=p;l!==g;l+=v)for(t=b;t!==N;t+=y,d++)e=x[d],m[4*(t+w*l)+0]=e,m[4*(t+w*l)+1]=e,m[4*(t+w*l)+2]=e,m[4*(t+w*l)+3]=255}break;case 16:{var k=c;p=a;var A=s,_=fe,T=r,C=i,O=o,j=h;let e,t,l=0;var M=n.width;for(t=p;t!==_;t+=A)for(e=T;e!==O;e+=C,l+=2)k[4*(e+M*t)+0]=j[l+0],k[4*(e+M*t)+1]=j[l+0],k[4*(e+M*t)+2]=j[l+0],k[4*(e+M*t)+3]=j[l+1]}}else switch(n.pixel_size){case 8:{var q=c,I=a,S=s,R=fe,P=r,z=i,E=o,U=h,G=f,B=G;let e,t,l,d=0;var L=n.width;for(l=I;l!==R;l+=S)for(t=P;t!==E;t+=z,d++)e=U[d],q[4*(t+L*l)+3]=255,q[4*(t+L*l)+2]=B[3*e+0],q[4*(t+L*l)+1]=B[3*e+1],q[4*(t+L*l)+0]=B[3*e+2]}break;case 16:{var F=c;G=a;var D=s,V=fe,W=r,J=i,X=o,$=h;let e,t,l,d=0;var Z=n.width;for(l=G;l!==V;l+=D)for(t=W;t!==X;t+=J,d+=2)e=$[d+0]+($[d+1]<<8),F[4*(t+Z*l)+0]=(31744&e)>>7,F[4*(t+Z*l)+1]=(992&e)>>2,F[4*(t+Z*l)+2]=(31&e)<<3,F[4*(t+Z*l)+3]=32768&e?0:255}break;case 24:{var H=c;I=a;var K=s,Y=fe,Q=r,ee=i,te=o,re=h;let e,t,l=0;var ae=n.width;for(t=I;t!==Y;t+=K)for(e=Q;e!==te;e+=ee,l+=3)H[4*(e+ae*t)+3]=255,H[4*(e+ae*t)+2]=re[l+0],H[4*(e+ae*t)+1]=re[l+1],H[4*(e+ae*t)+0]=re[l+2]}break;case 32:{var ne=c,ie=a,se=s,oe=fe,le=r,ce=i,de=o,ue=h;let e,t,l=0;var he=n.width;for(t=ie;t!==oe;t+=se)for(e=le;e!==de;e+=ce,l+=4)ne[4*(e+he*t)+2]=ue[l+0],ne[4*(e+he*t)+1]=ue[l+1],ne[4*(e+he*t)+0]=ue[l+2],ne[4*(e+he*t)+3]=ue[l+3]}}}return{data:e,width:n.width,height:n.height,flipY:!0,generateMipmaps:!0,minFilter:a.D1R}}}class i extends a.aNw{constructor(e){super(e)}load(e,t,r,n){const i=this,s=""===i.path?a.Zp0.extractUrlBase(e):i.path;var o=new a.hH6(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r,s))}catch(r){n&&n(r),i.manager.itemError(e)}}),r,n)}parse(e,t){function r(e,t){var r=[],a=e.childNodes;for(let i=0,s=a.length;i<s;i++){var n=a[i];n.nodeName===t&&r.push(n)}return r}function i(e){if(0===e.length)return[];var t=e.trim().split(/\s+/),r=new Array(t.length);for(let a=0,n=t.length;a<n;a++)r[a]=parseFloat(t[a]);return r}function s(e){if(0===e.length)return[];var t=e.trim().split(/\s+/),r=new Array(t.length);for(let a=0,n=t.length;a<n;a++)r[a]=parseInt(t[a]);return r}function o(e){return e.substring(1)}function l(e){return 0===Object.keys(e).length}function c(e,t,a,n){if(e=r(e,t)[0],void 0!==e){var i=r(e,a);for(let e=0;e<i.length;e++)n(i[e])}}function d(e,t){for(const r in e)e[r].build=t(e[r])}function u(e,t){return void 0===e.build&&(e.build=t(e)),e.build}function h(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(const y in r)if(r.hasOwnProperty(y)){var s=r[y],o=n[s.sampler],l=o.inputs.INPUT,c=(o=o.inputs.OUTPUT,s=function(e,t,r){var a=se.nodes[e.id],n=Z(a.id),i=a.transforms[e.sid];a=a.matrix.clone().transpose();let s,o,l,c,d,u;var h={};if("matrix"===i)for(l=0,c=t.array.length;l<c;l++)if(s=t.array[l],o=l*r.stride,void 0===h[s]&&(h[s]={}),!0===e.arraySyntax){var f=r.array[o],m=e.indices[0]+4*e.indices[1];h[s][m]=f}else for(d=0,u=r.stride;d<u;d++)h[s][d]=r.array[o+d];return i=function(e,t){var r=[];for(const a in e)r.push({time:parseFloat(a),value:e[a]});r.sort((function(e,t){return e.time-t.time}));for(let a=0;a<16;a++)!function(e,t,r){let a,n,i,s=!0;for(n=0,i=e.length;n<i;n++)void 0===(a=e[n]).value[t]?a.value[t]=null:s=!1;if(!0===s)for(n=0,i=e.length;n<i;n++)(a=e[n]).value[t]=r;else!function(e,t){var r,a;for(let i=0,s=e.length;i<s;i++){var n=e[i];null===n.value[t]&&(r=function(e,t,r){for(;0<=t;){var a=e[t];if(null!==a.value[r])return a;t--}return null}(e,i,t),a=function(e,t,r){for(;t<e.length;){var a=e[t];if(null!==a.value[r])return a;t++}return null}(e,i,t),null===r?n.value[t]=a.value[t]:null===a?n.value[t]=r.value[t]:function(e,t,r,a){r.time-t.time==0?e.value[a]=t.value[a]:e.value[a]=(e.time-t.time)*(r.value[a]-t.value[a])/(r.time-t.time)+t.value[a]}(n,r,a,t))}}(e,t)}(r,a,t.elements[a]);return r}(h,a),a={name:n.uuid,keyframes:i},a}(s,i[l],i[o]),l=(b=g=f=h=u=d=c=o=l=void 0,s),o=t,l.keyframes),d=(l=l.name,[]),u=[],h=[],f=[];for(let e=0,t=c.length;e<t;e++){var g=c[e],b=g.time;g=g.value;U.fromArray(g).transpose(),U.decompose(m,v,p),d.push(b),u.push(m.x,m.y,m.z),h.push(v.x,v.y,v.z,v.w),f.push(p.x,p.y,p.z)}0<u.length&&o.push(new a.yC1(l+".position",d,u)),0<h.length&&o.push(new a.iLg(l+".quaternion",d,h)),0<f.length&&o.push(new a.yC1(l+".scale",d,f))}return t}function f(e){return u(se.animations[e],h)}const m=new a.Pa4,p=new a.Pa4,v=new a._fP;function g(e){var t=[],r=e.name,n=e.end-e.start||-1,i=e.animations;for(let a=0,o=i.length;a<o;a++){var s=f(i[a]);for(let e=0,r=s.length;e<r;e++)t.push(s[e])}return new a.m7l(r,n,t)}function b(e){var t={id:e.id},r=se.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},r=e.sources,n=e.vertexWeights,i=n.vcount,s=n.v,o=n.inputs.JOINT.offset,l=n.inputs.WEIGHT.offset,c=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],u=r[n.inputs.WEIGHT.id].array;let h,f,m,p=0;for(h=0,m=i.length;h<m;h++){var v=i[h],g=[];for(f=0;f<v;f++){var b=s[p+o],y=s[p+l];y=u[y];g.push({index:b,weight:y}),p+=2}for(g.sort(k),f=0;f<4;f++){var N=g[f];void 0!==N?(t.indices.array.push(N.index),t.weights.array.push(N.weight)):(t.indices.array.push(0),t.weights.array.push(0))}}for(e.bindShapeMatrix?t.bindMatrix=(new a.yGw).fromArray(e.bindShapeMatrix).transpose():t.bindMatrix=(new a.yGw).identity(),h=0,m=c.array.length;h<m;h++){var x=c.array[h],w=(new a.yGw).fromArray(d.array,h*d.stride).transpose();t.joints.push({name:x,boneInverse:w})}return t;function k(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function y(e){return void 0!==e.build?e.build:e.init_from}function N(e){return e=se.images[e],void 0!==e?u(e,y):null}function x(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"color":t[r.nodeName]=i(r.textContent);break;case"float":t[r.nodeName]=parseFloat(r.textContent);break;case"texture":t[r.nodeName]={id:r.getAttribute("texture"),extra:w(r)}}}return t}function w(e){var t={technique:{}};for(let s=0,o=e.childNodes.length;s<o;s++){var r=e.childNodes[s];if(1===r.nodeType&&"extra"===r.nodeName){i=n=a=void 0;var a=r,n=t;for(let e=0,t=a.childNodes.length;e<t;e++){var i=a.childNodes[e];1===i.nodeType&&"technique"===i.nodeName&&function(e,t){for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=0:t.technique[r.nodeName]=parseInt(r.textContent);break;case"bump":t[r.nodeName]=A(r)}}}(i,n)}}}return t}function k(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];1===r.nodeType&&"technique"===r.nodeName&&(t.technique=function(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"double_sided":t[r.nodeName]=parseInt(r.textContent);break;case"bump":t[r.nodeName]=A(r)}}return t}(r))}return t}function A(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];1===r.nodeType&&"texture"===r.nodeName&&(t[r.nodeName]={id:r.getAttribute("texture"),texcoord:r.getAttribute("texcoord"),extra:w(r)})}return t}function _(e){return e}function T(e){r=e.url;const t=u(se.effects[r],_);var r=t.profile.technique;let n;switch(r.type){case"phong":case"blinn":n=new a.xoR;break;case"lambert":n=new a.YBo;break;default:n=new a.vBJ}function i(e,r=null){var n=t.profile.samplers[e.id];let i=null;return null!==(i=N(void 0!==n?t.profile.surfaces[n.source].init_from:e.id))&&void 0!==(n=function(e){let t=e.slice(2+(e.lastIndexOf(".")-1>>>0));return t=t.toLowerCase(),"tga"===t?te:ee}(i))?(n=n.load(i),void 0!==(e=e.extra)&&void 0!==e.technique&&!1===l(e.technique)?(e=e.technique,n.wrapS=e.wrapU?a.rpg:a.uWy,n.wrapT=e.wrapV?a.rpg:a.uWy,n.offset.set(e.offsetU||0,e.offsetV||0),n.repeat.set(e.repeatU||1,e.repeatV||1)):(n.wrapS=a.rpg,n.wrapT=a.rpg),null!==r&&(n.encoding=r),n):null}n.name=e.name||"";var s=r.parameters;for(const l in s){var o=s[l];switch(l){case"diffuse":o.color&&n.color.fromArray(o.color),o.texture&&(n.map=i(o.texture,a.knz));break;case"specular":o.color&&n.specular&&n.specular.fromArray(o.color),o.texture&&(n.specularMap=i(o.texture));break;case"bump":o.texture&&(n.normalMap=i(o.texture));break;case"ambient":o.texture&&(n.lightMap=i(o.texture,a.knz));break;case"shininess":o.float&&n.shininess&&(n.shininess=o.float);break;case"emission":o.color&&n.emissive&&n.emissive.fromArray(o.color),o.texture&&(n.emissiveMap=i(o.texture,a.knz))}}n.color.convertSRGBToLinear(),n.specular&&n.specular.convertSRGBToLinear(),n.emissive&&n.emissive.convertSRGBToLinear();let c=s.transparent,d=s.transparency;if(void 0===d&&c&&(d={float:1}),(c=void 0===c&&d?{opaque:"A_ONE",data:{color:[1,1,1,1]}}:c)&&d)if(c.data.texture)n.transparent=!0;else{var h=c.data.color;switch(c.opaque){case"A_ONE":n.opacity=h[3]*d.float;break;case"RGB_ZERO":n.opacity=1-h[0]*d.float;break;case"A_ZERO":n.opacity=1-h[3]*d.float;break;case"RGB_ONE":n.opacity=h[0]*d.float}n.opacity<1&&(n.transparent=!0)}if(void 0!==r.extra&&void 0!==r.extra.technique){var f=r.extra.technique;for(const e in f){var m=f[e];switch(e){case"double_sided":n.side=1===m?a.ehD:a.Wl3;break;case"bump":n.normalMap=i(m.texture),n.normalScale=new a.FM8(1,1)}}}return n}function C(e){let t;switch(e.optics.technique){case"perspective":t=new a.cPb(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r;n*=.5,r*=.5,t=new a.iKG(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new a.cPb}return t.name=e.name||"",t}function O(e){let t;switch(e.technique){case"directional":t=new a.Ox3;break;case"point":t=new a.cek;break;case"spot":t=new a.PMe;break;case"ambient":t=new a.Mig}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function j(e){var t={array:[],stride:3};for(let s=0;s<e.childNodes.length;s++){var a=e.childNodes[s];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=i(a.textContent);break;case"Name_array":t.array=function(e){if(0===e.length)return[];var t=e.trim().split(/\s+/),r=new Array(t.length);for(let a=0,n=t.length;a<n;a++)r[a]=t[a];return r}(a.textContent);break;case"technique_common":var n=r(a,"accessor")[0];void 0!==n&&(t.stride=parseInt(n.getAttribute("stride")))}}return t}function M(e){var t={},r=e.sources,n=e.vertices;e=e.primitives;if(0===e.length)return{};var i=function(e){var t={};for(let a=0;a<e.length;a++){var r=e[a];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(e);for(const l in i){var s=i[l];{o=void 0;var o=s;let e=0;for(let t=0,r=o.length;t<r;t++)!0===o[t].hasUV&&e++;0<e&&e<o.length&&(o.uvsNeedsFix=!0)}t[l]=function(e,t,r){const n={},i={array:[],stride:0},s={array:[],stride:0},o={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:0},d=[],u=4,h=[],f=4,m=new a.u9r,p=[];let v=0;for(let a=0;a<e.length;a++){var g=e[a],b=g.inputs;let n=0;switch(g.type){case"lines":case"linestrips":n=2*g.count;break;case"triangles":n=3*g.count;break;case"polylist":for(let e=0;e<g.count;e++){var y=g.vcount[e];switch(y){case 3:n+=3;break;case 4:n+=6;break;default:n+=3*(y-2)}}}m.addGroup(v,n,a),v+=n,g.material&&p.push(g.material);for(const a in b){var N=b[a];switch(a){case"VERTEX":for(const a in r){var x=r[a];switch(a){case"POSITION":var w=i.array.length;if(q(g,t[x],N.offset,i.array),i.stride=t[x].stride,t.skinWeights&&t.skinIndices&&(q(g,t.skinIndices,N.offset,d),q(g,t.skinWeights,N.offset,h)),!1===g.hasUV&&!0===e.uvsNeedsFix){var k=(i.array.length-w)/i.stride;for(let e=0;e<k;e++)o.array.push(0,0)}break;case"NORMAL":q(g,t[x],N.offset,s.array),s.stride=t[x].stride;break;case"COLOR":q(g,t[x],N.offset,c.array),c.stride=t[x].stride;break;case"TEXCOORD":q(g,t[x],N.offset,o.array),o.stride=t[x].stride;break;case"TEXCOORD1":q(g,t[x],N.offset,l.array),o.stride=t[x].stride}}break;case"NORMAL":q(g,t[N.id],N.offset,s.array),s.stride=t[N.id].stride;break;case"COLOR":q(g,t[N.id],N.offset,c.array,!0),c.stride=t[N.id].stride;break;case"TEXCOORD":q(g,t[N.id],N.offset,o.array),o.stride=t[N.id].stride;break;case"TEXCOORD1":q(g,t[N.id],N.offset,l.array),l.stride=t[N.id].stride}}}return 0<i.array.length&&m.setAttribute("position",new a.a$l(i.array,i.stride)),0<s.array.length&&m.setAttribute("normal",new a.a$l(s.array,s.stride)),0<c.array.length&&m.setAttribute("color",new a.a$l(c.array,c.stride)),0<o.array.length&&m.setAttribute("uv",new a.a$l(o.array,o.stride)),0<l.array.length&&m.setAttribute("uv2",new a.a$l(l.array,l.stride)),0<d.length&&m.setAttribute("skinIndex",new a.a$l(d,u)),0<h.length&&m.setAttribute("skinWeight",new a.a$l(h,f)),n.data=m,n.type=e[0].type,n.materialKeys=p,n}(s,r,n)}return t}function q(e,t,r,a,n=!1){const i=e.p;var s=e.stride,o=e.vcount;function l(e){let t=i[e+r]*d;for(var s=t+d;t<s;t++)a.push(c[t]);n&&(e=a.length-d-1,re.setRGB(a[e],a[1+e],a[2+e]).convertSRGBToLinear(),a[e]=re.r,a[1+e]=re.g,a[2+e]=re.b)}const c=t.array,d=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,r=o.length;t<r;t++){var u=o[t];if(4===u){var h=e+0*s,f=e+ +s,m=e+2*s,p=e+3*s;l(h),l(f),l(p),l(f),l(m),l(p)}else if(3===u)h=e+0*s,f=e+ +s,m=e+2*s,l(h),l(f),l(m);else if(4<u)for(let t=1,r=u-2;t<=r;t++){var v=e+0*s,g=e+s*t,b=e+s*(t+1);l(v),l(g),l(b)}e+=s*u}}else for(let y=0,N=i.length;y<N;y+=s)l(y)}function I(e){return u(se.geometries[e],M)}function S(e){return void 0!==e.build?e.build:e}function R(e){var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(function(e){var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(R(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(P(r))}}return t}(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(P(r))}}return t}function P(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new a.yGw,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new a.Pa4,t.obj.fromArray(r);break;case"rotate":t.obj=new a.Pa4,t.obj.fromArray(r),t.angle=a.M8C.degToRad(r[3])}return t}function z(e){return void 0!==e.build?e.build:e}function E(e){var t=e.getElementsByTagName("node");for(let a=0;a<t.length;a++){var r=t[a];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+ie++)}}const U=new a.yGw,G=new a.Pa4;function B(e){var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new a.yGw,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let s=0;s<e.childNodes.length;s++){var r=e.childNodes[s];if(1===r.nodeType){let e;switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),B(r);break;case"instance_camera":t.instanceCameras.push(o(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(L(r));break;case"instance_light":t.instanceLights.push(o(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(L(r));break;case"instance_node":t.instanceNodes.push(o(r.getAttribute("url")));break;case"matrix":e=i(r.textContent),t.matrix.multiply(U.fromArray(e).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":e=i(r.textContent),G.fromArray(e),t.matrix.multiply(U.makeTranslation(G.x,G.y,G.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":e=i(r.textContent);var n=a.M8C.degToRad(e[3]);t.matrix.multiply(U.makeRotationAxis(G.fromArray(e),n)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":e=i(r.textContent),t.matrix.scale(G.fromArray(e)),t.transforms[r.getAttribute("sid")]=r.nodeName}}}return $(t.id)||(se.nodes[t.id]=t),t}function L(e){var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]};for(let s=0;s<e.childNodes.length;s++){var r=e.childNodes[s];switch(r.nodeName){case"bind_material":var a=r.getElementsByTagName("instance_material");for(let e=0;e<a.length;e++){var n=a[e],i=n.getAttribute("symbol");n=n.getAttribute("target");t.materials[i]=o(n)}break;case"skeleton":t.skeletons.push(o(r.textContent))}}return t}function F(e,t){var r,n=[],i=[];let s,o,l;for(s=0;s<e.length;s++){var c=e[s];if($(c))D(Z(c),t,n);else if(r=c,void 0!==se.visualScenes[r]){var d=se.visualScenes[c].children;for(let e=0;e<d.length;e++){var u=d[e];"JOINT"===u.type&&D(Z(u.id),t,n)}}}for(s=0;s<t.length;s++)for(o=0;o<n.length;o++)if((l=n[o]).bone.name===t[s].name){(i[s]=l).processed=!0;break}for(s=0;s<n.length;s++)!1===(l=n[s]).processed&&(i.push(l),l.processed=!0);var h=[],f=[];for(s=0;s<i.length;s++)l=i[s],h.push(l.bone),f.push(l.boneInverse);return new a.OdW(h,f)}function D(e,t,r){e.traverse((function(e){if(!0===e.isBone){let i;for(let r=0;r<t.length;r++){var n=t[r];if(n.name===e.name){i=n.boneInverse;break}}void 0===i&&(i=new a.yGw),r.push({bone:e,boneInverse:i,processed:!1})}}))}function V(e){var t,r=[],n=e.matrix,i=e.nodes,s=e.type,o=e.instanceCameras,l=e.instanceControllers,c=e.instanceLights,d=e.instanceGeometries,h=e.instanceNodes;for(let a=0,u=i.length;a<u;a++)r.push(Z(i[a]));for(let a=0,b=o.length;a<b;a++){f=o[a];var f=void 0!==(f=se.cameras[f])?u(f,C):null;null!==f&&r.push(f.clone())}for(let a=0,k=l.length;a<k;a++){var m=l[a],p=(t=m.id,u(se.controllers[t],b)),v=X(I(p.id),m.materials),g=F(m.skeletons,p.skin.joints);for(let e=0,t=v.length;e<t;e++){const t=v[e];t.isSkinnedMesh&&(t.bind(g,p.skin.bindMatrix),t.normalizeSkinWeights()),r.push(t)}}for(let a=0,b=c.length;a<b;a++){y=c[a];var y=void 0!==(y=se.lights[y])?u(y,O):null;null!==y&&r.push(y.clone())}for(let a=0,u=d.length;a<u;a++){var N=d[a],x=X(I(N.id),N.materials);for(let e=0,t=x.length;e<t;e++)r.push(x[e])}for(let a=0,u=h.length;a<u;a++)r.push(Z(h[a]).clone());let w;if(0===i.length&&1===r.length)w=r[0];else{w=new("JOINT"===s?a.N$j:a.ZAu);for(let e=0;e<r.length;e++)w.add(r[e])}return w.name="JOINT"===s?e.sid:e.name,w.matrix.copy(n),w.matrix.decompose(w.position,w.quaternion,w.scale),w}const W=new a.vBJ({color:16711935});function J(e,t){var r=[];for(let n=0,i=e.length;n<i;n++){var a=t[e[n]];r.push(void 0===a?W:u(se.materials[a],T))}return r}function X(e,t){var r=[];for(const d in e){var n=e[d],i=J(n.materialKeys,t);if(0===i.length&&("lines"===d||"linestrips"===d?i.push(new a.nls):i.push(new a.xoR)),"lines"===d||"linestrips"===d)for(let e=0,t=i.length;e<t;e++){var s,o=i[e];!0!==o.isMeshPhongMaterial&&!0!==o.isMeshLambertMaterial||((s=new a.nls).color.copy(o.color),s.opacity=o.opacity,s.transparent=o.transparent,i[e]=s)}var l=void 0!==n.data.attributes.skinIndex,c=1===i.length?i[0]:i;let u;switch(d){case"lines":u=new a.ejS(n.data,c);break;case"linestrips":u=new a.x12(n.data,c);break;case"triangles":case"polylist":u=new(l?a.TUv:a.Kj0)(n.data,c)}r.push(u)}return r}function $(e){return void 0!==se.nodes[e]}function Z(e){return u(se.nodes[e],V)}function H(e){var t=new a.ZAu,r=(t.name=e.name,e.children);for(let a=0;a<r.length;a++){var n=r[a];t.add(Z(n.id))}return t}function K(e){return u(se.visualScenes[e],H)}if(0===e.length)return{scene:new a.xsS};e=(new DOMParser).parseFromString(e,"application/xml");const Y=r(e,"COLLADA")[0];if(e=e.getElementsByTagName("parsererror")[0],void 0!==e){var Q=r(e,"div")[0];let t;return t=Q?Q.textContent:function(e){let t="";for(var r=[e];r.length;){var a=r.shift();a.nodeType===Node.TEXT_NODE?t+=a.textContent:(t+="\n",r.push.apply(r,a.childNodes))}return t.trim()}(e),null}Y.getAttribute("version"),Q=r(Y,"asset")[0],e={unit:void 0!==(e=r(Q,"unit")[0])&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1,upAxis:void 0!==(e=r(Q,"up_axis")[0])?e.textContent:"Y_UP"};const ee=new a.dpR(this.manager);let te;ee.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),n&&(te=new n(this.manager)).setPath(this.resourcePath||t);const re=new a.Ilk,ae=[];let ne={},ie=0;const se={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};c(Y,"library_animations","animation",(function e(t){var r={sources:{},samplers:{},channels:{}};let n=!1;for(let a=0,s=t.childNodes.length;a<s;a++){var i=t.childNodes[a];if(1===i.nodeType){let t;switch(i.nodeName){case"source":t=i.getAttribute("id"),r.sources[t]=j(i);break;case"sampler":t=i.getAttribute("id"),r.samplers[t]=function(e){var t={inputs:{}};for(let n=0,i=e.childNodes.length;n<i;n++){var r,a=e.childNodes[n];1===a.nodeType&&"input"===a.nodeName&&(r=o(a.getAttribute("source")),a=a.getAttribute("semantic"),t.inputs[a]=r)}return t}(i);break;case"channel":t=i.getAttribute("target"),r.channels[t]=function(e){var t={},r=e.getAttribute("target");let a=r.split("/"),n=(r=a.shift(),a.shift());var i=-1!==n.indexOf("("),s=-1!==n.indexOf(".");if(s)a=n.split("."),n=a.shift(),t.member=a.shift();else if(i){var l=n.split("(");n=l.shift();for(let e=0;e<l.length;e++)l[e]=parseInt(l[e].replace(/\)/,""));t.indices=l}return t.id=r,t.sid=n,t.arraySyntax=i,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}(i);break;case"animation":e(i),n=!0}}}!1===n&&(se.animations[t.getAttribute("id")||a.M8C.generateUUID()]=r)})),c(Y,"library_animation_clips","animation_clip",(function(e){var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];1===r.nodeType&&"instance_animation"===r.nodeName&&t.animations.push(o(r.getAttribute("url")))}se.clips[e.getAttribute("id")]=t})),c(Y,"library_controllers","controller",(function(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"skin":t.id=o(r.getAttribute("source")),t.skin=function(e){var t={sources:{}};for(let n=0,l=e.childNodes.length;n<l;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(r.textContent);break;case"source":var a=r.getAttribute("id");t.sources[a]=j(r);break;case"joints":t.joints=function(e){var t={inputs:{}};for(let n=0,i=e.childNodes.length;n<i;n++){var r,a=e.childNodes[n];1===a.nodeType&&"input"===a.nodeName&&(r=a.getAttribute("semantic"),a=o(a.getAttribute("source")),t.inputs[r]=a)}return t}(r);break;case"vertex_weights":t.vertexWeights=function(e){var t={inputs:{}};for(let l=0,c=e.childNodes.length;l<c;l++){var r=e.childNodes[l];if(1===r.nodeType)switch(r.nodeName){case"input":var a=r.getAttribute("semantic"),n=o(r.getAttribute("source")),i=parseInt(r.getAttribute("offset"));t.inputs[a]={id:n,offset:i};break;case"vcount":t.vcount=s(r.textContent);break;case"v":t.v=s(r.textContent)}}return t}(r)}}return t}(r);break;case"morph":t.id=o(r.getAttribute("source"))}}se.controllers[e.getAttribute("id")]=t})),c(Y,"library_images","image",(function(e){var t={init_from:r(e,"init_from")[0].textContent};se.images[e.getAttribute("id")]=t})),c(Y,"library_effects","effect",(function(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];1===r.nodeType&&"profile_COMMON"===r.nodeName&&(t.profile=function(e){var t={surfaces:{},samplers:{}};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"newparam":!function(e,t){var r=e.getAttribute("sid");for(let n=0,i=e.childNodes.length;n<i;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=function(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];1===r.nodeType&&"init_from"===r.nodeName&&(t.init_from=r.textContent)}return t}(a);break;case"sampler2D":t.samplers[r]=function(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];1===r.nodeType&&"source"===r.nodeName&&(t.source=r.textContent)}return t}(a)}}}(r,t);break;case"technique":t.technique=function(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=r.nodeName,t.parameters=function(e){var t={};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[r.nodeName]=x(r);break;case"transparent":t[r.nodeName]={opaque:r.hasAttribute("opaque")?r.getAttribute("opaque"):"A_ONE",data:x(r)}}}return t}(r);break;case"extra":t.extra=k(r)}}return t}(r);break;case"extra":t.extra=k(r)}}return t}(r))}se.effects[e.getAttribute("id")]=t})),c(Y,"library_materials","material",(function(e){var t={name:e.getAttribute("name")};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];1===r.nodeType&&"instance_effect"===r.nodeName&&(t.url=o(r.getAttribute("url")))}se.materials[e.getAttribute("id")]=t})),c(Y,"library_cameras","camera",(function(e){var t={name:e.getAttribute("name")};for(let a=0,n=e.childNodes.length;a<n;a++){var r=e.childNodes[a];1===r.nodeType&&"optics"===r.nodeName&&(t.optics=function(e){for(let r=0;r<e.childNodes.length;r++){var t=e.childNodes[r];if("technique_common"===t.nodeName)return function(e){var t={};for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=function(e){var t={};for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}(r)}}return t}(t)}return{}}(r))}se.cameras[e.getAttribute("id")]=t})),c(Y,"library_lights","light",(function(e){let t={};for(let n=0,s=e.childNodes.length;n<s;n++){var r=e.childNodes[n];1===r.nodeType&&"technique_common"===r.nodeName&&(t=function(e){var t={};for(let n=0,s=e.childNodes.length;n<s;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=r.nodeName,t.parameters=function(e){var t={};for(let s=0,o=e.childNodes.length;s<o;s++){var r=e.childNodes[s];if(1===r.nodeType)switch(r.nodeName){case"color":var n=i(r.textContent);t.color=(new a.Ilk).fromArray(n).convertSRGBToLinear();break;case"falloff_angle":t.falloffAngle=parseFloat(r.textContent);break;case"quadratic_attenuation":n=parseFloat(r.textContent),t.distance=n?Math.sqrt(1/n):0}}return t}(r)}}return t}(r))}se.lights[e.getAttribute("id")]=t})),c(Y,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},a=r(e,"mesh")[0];if(void 0!==a){for(let e=0;e<a.childNodes.length;e++){var n=a.childNodes[e];if(1===n.nodeType){var i=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[i]=j(n);break;case"vertices":t.vertices=function(e){var t={};for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];1===r.nodeType&&(t[r.getAttribute("semantic")]=o(r.getAttribute("source")))}return t}(n);break;case"polygons":break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(function(e){var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let c=0,d=e.childNodes.length;c<d;c++){var r=e.childNodes[c];if(1===r.nodeType)switch(r.nodeName){case"input":var a=o(r.getAttribute("source")),n=r.getAttribute("semantic"),i=parseInt(r.getAttribute("offset")),l=parseInt(r.getAttribute("set"));t.inputs[0<l?n+l:n]={id:a,offset:i},t.stride=Math.max(t.stride,i+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=s(r.textContent);break;case"p":t.p=s(r.textContent)}}return t}(n))}}}se.geometries[e.getAttribute("id")]=t}})),c(Y,"library_nodes","node",B),c(Y,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]},a=(E(e),r(e,"node"));for(let r=0;r<a.length;r++)t.children.push(B(a[r]));se.visualScenes[e.getAttribute("id")]=t})),c(Y,"library_kinematics_models","kinematics_model",(function(e){var t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let l=0;l<e.childNodes.length;l++){var r=e.childNodes[l];if(1===r.nodeType&&"technique_common"===r.nodeName){o=s=n=void 0;var n=r,s=t;for(let e=0;e<n.childNodes.length;e++){var o=n.childNodes[e];if(1===o.nodeType)switch(o.nodeName){case"joint":s.joints[o.getAttribute("sid")]=function(e){let t;for(let n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=function(e){var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new a.Pa4,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"axis":var n=i(r.textContent);t.axis.fromArray(n);break;case"limits":n=r.getElementsByTagName("max")[0];var s=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}(r)}}return t}(o);break;case"link":s.links.push(R(o))}}}}se.kinematicsModels[e.getAttribute("id")]=t})),c(Y,"library_physics_models","physics_model",(function(e){var t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let o=0;o<e.childNodes.length;o++){var r=e.childNodes[o];if(1===r.nodeType&&"rigid_body"===r.nodeName){t.rigidBodies[r.getAttribute("name")]={},s=n=a=void 0;var a=r,n=t.rigidBodies[r.getAttribute("name")];for(let e=0;e<a.childNodes.length;e++){var s=a.childNodes[e];1===s.nodeType&&"technique_common"===s.nodeName&&function(e,t){for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=i(r.textContent);break;case"mass":t.mass=i(r.textContent)[0]}}}(s,n)}}}se.physicsModels[e.getAttribute("id")]=t})),c(Y,"scene","instance_kinematics_scene",(function(e){var t={bindJointAxis:[]};for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];1===r.nodeType&&"bind_joint_axis"===r.nodeName&&t.bindJointAxis.push(function(e){var t={target:e.getAttribute("target").split("/").pop()};for(let a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];1===r.nodeType&&"axis"===r.nodeName&&(r=r.getElementsByTagName("param")[0],t.axis=r.textContent,r=t.axis.split("inst_").pop().split("axis")[0],t.jointIndex=r.substring(0,r.length-1))}return t}(r))}se.kinematicsScenes[o(e.getAttribute("url"))]=t})),d(se.animations,h),d(se.clips,g),d(se.controllers,b),d(se.images,y),d(se.effects,_),d(se.materials,T),d(se.cameras,C),d(se.lights,O),d(se.geometries,M),d(se.visualScenes,H);var oe;t=se.clips;if(!0===l(t)){if(!1===l(se.animations)){var le=[];for(const e in se.animations){var ce=f(e);for(let e=0,t=ce.length;e<t;e++)le.push(ce[e])}ae.push(new a.m7l("default",-1,le))}}else for(const a in t)ae.push((oe=a,u(se.clips[oe],g)));t=Object.keys(se.kinematicsModels)[0];var de=Object.keys(se.kinematicsScenes)[0],ue=Object.keys(se.visualScenes)[0];if(void 0!==t&&void 0!==de){const e=u(se.kinematicsModels[t],S);t=de,de=u(se.kinematicsScenes[t],z);const r=K(ue);var he=de.bindJointAxis;const n={};for(let t=0,o=he.length;t<o;t++){var fe=he[t],me=Y.querySelector('[sid="'+fe.target+'"]');me&&(me=me.parentElement,function(t,s){const o=s.getAttribute("name"),l=e.joints[t];r.traverse((function(e){e.name===o&&(n[t]={object:e,transforms:function(e){var t=[],r=Y.querySelector('[id="'+e.id+'"]');for(let o=0;o<r.childNodes.length;o++){var n=r.childNodes[o];if(1===n.nodeType){let e,r;switch(n.nodeName){case"matrix":e=i(n.textContent);var s=(new a.yGw).fromArray(e).transpose();t.push({sid:n.getAttribute("sid"),type:n.nodeName,obj:s});break;case"translate":case"scale":e=i(n.textContent),r=(new a.Pa4).fromArray(e),t.push({sid:n.getAttribute("sid"),type:n.nodeName,obj:r});break;case"rotate":e=i(n.textContent),r=(new a.Pa4).fromArray(e),s=a.M8C.degToRad(e[3]),t.push({sid:n.getAttribute("sid"),type:n.nodeName,obj:r,angle:s})}}}return t}(s),joint:l,position:l.zeroPosition})}))}(fe.jointIndex,me))}const s=new a.yGw;ne={joints:e&&e.joints,getJointValue:function(e){if(e=n[e],e)return e.position},setJointValue:function(e,t){var r=n[e];if(r){var i=r.joint;if(!(t>i.limits.max||t<i.limits.min||i.static)){var o=r.object,l=i.axis,c=r.transforms;U.identity();for(let r=0;r<c.length;r++){var d=c[r];if(d.sid&&-1!==d.sid.indexOf(e))switch(i.type){case"revolute":U.multiply(s.makeRotationAxis(l,a.M8C.degToRad(t)));break;case"prismatic":U.multiply(s.makeTranslation(l.x*t,l.y*t,l.z*t))}else switch(d.type){case"matrix":U.multiply(d.obj);break;case"translate":U.multiply(s.makeTranslation(d.obj.x,d.obj.y,d.obj.z));break;case"scale":U.scale(d.obj);break;case"rotate":U.multiply(s.makeRotationAxis(d.obj,d.angle))}}o.matrix.copy(U),o.matrix.decompose(o.position,o.quaternion,o.scale),n[e].position=t}}}}}return t=r(Y,"scene")[0],ue=K(o(r(t,"instance_visual_scene")[0].getAttribute("url"))),ue.animations=ae,"Z_UP"===e.upAxis&&ue.rotation.set(-Math.PI/2,0,0),ue.scale.multiplyScalar(e.unit),{get animations(){return ae},kinematics:ne,library:se,scene:ue}}}}}]);