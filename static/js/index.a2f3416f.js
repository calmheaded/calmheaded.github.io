(function(){"use strict";var e={1975:function(e,t,s){var i=s(144),n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("div",{staticClass:"content"},[t("model-engine",{attrs:{width:e.width,height:e.height}})],1)])},o=[],a={name:"App",components:{},data(){return{width:"800",height:"800"}},methods:{test(){alert(1)}}},r=a,l=s(1001),c=(0,l.Z)(r,n,o,!1,null,null,null),h=c.exports,d=s(629);const u={showLoading:e=>e.showLoading,getBlastVal:e=>e.blastVal,isActive:e=>e.isActive,info:e=>e.measure.info,pointsDistance:e=>e.measure.pointsDistance,parallelFacesDistance:e=>e.measure.parallelFacesDistance,facesAngle:e=>e.measure.facesAngle};var g=u;const m={showLoading:!1,blastVal:1,duxian:!1,edgeVal:100},f={DUXIAN(e,t){e.duxian=t},SHOW_LOADING(e,t){e.showLoading=!1},CHANGE_BLASTVAL(e,t){e.blastVal=t},RESET_BLASTVAL(e){e.blastVal=1},CHANGE_EDGE_VAL(e,t){e.edgeVal=t}},p={showLoading({commit:e},t){e("SHOW_LOADING",!1)},changBlastVal({commit:e},t){e("CHANGE_BLASTVAL",t)},resetBlastVal({commit:e},t){e("RESET_BLASTVAL",t)}};var w={namespaced:!0,state:m,mutations:f,actions:p};const b={info:"无",pointsDistance:0,parallelFacesDistance:0,facesAngle:0,isActive:!1,showMeasureIInfo:!1},v={ShowMeasureInfo(e,t){e.showMeasureIInfo=t},IsActive(e,t){e.isActive=t},AddInfo(e,t){e.info=t},AddPointsDistance(e,t){e.pointsDistance=t},AddDistanceParallel(e,t){e.parallelFacesDistance=t},AddAngel(e,t){e.facesAngle=t},Reset(){b.pointsDistance=0,b.parallelFacesDistance=0,b.facesAngle=0,b.showMeasureIInfo=!1}},M={};var L={namespaced:!0,state:b,mutations:v,actions:M};i["default"].use(d.ZP);var y=new d.ZP.Store({modules:{app:w,measure:L},getters:g}),j=s(4517),C=s.n(j),k=function(){var e=this,t=e._self._c;return t("div",{staticClass:"viewer"},[t("div",{staticClass:"model-wrapper",attrs:{id:"model-wrapper"}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}],staticClass:"main_viewer",attrs:{id:"main_viewer","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}}),t("div",{staticClass:"side_menu_wrap",class:[e.isActive?"left0":"left200"]},[t("div",{staticClass:"side-menu"},[e._m(0),t("div",{staticClass:"btns"},e._l(e.btns,(function(s,i){return t("span",{key:i,class:[e.tabIndex==i?"active":""],on:{click:function(t){return e.backgroundTabClick(i)}}},[e._v(e._s(s))])})),0),e._m(1),t("div",{staticClass:"envMaps"},e._l(e.envMaps,(function(s,i){return t("el-image",{key:i,staticClass:"img",staticStyle:{width:"45px",height:"45px"},attrs:{src:s.url},on:{click:function(t){return e.SetEnvironment(s.name,s.backgroundIsEnvMap)}}})})),1),e._m(2),t("div",{staticClass:"blast-slider"},[t("el-slider",{directives:[{name:"show",rawName:"v-show",value:e.showSlider,expression:"showSlider"}],attrs:{min:0,max:100},on:{change:e.edgeChange},model:{value:e.edgeVal,callback:function(t){e.edgeVal=t},expression:"edgeVal"}})],1),e._m(3),t("div",{staticClass:"blast-slider"},[t("el-slider",{directives:[{name:"show",rawName:"v-show",value:e.showSlider,expression:"showSlider"}],attrs:{min:1,max:100},on:{change:e.blastChange},model:{value:e.blastVal,callback:function(t){e.blastVal=t},expression:"blastVal"}})],1),t("el-row",{staticClass:"row"},[t("span",[e._v("显示网格")]),t("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.changeWange},model:{value:e.wanggeValue,callback:function(t){e.wanggeValue=t},expression:"wanggeValue"}})],1),t("el-row",{staticClass:"row"},[t("span",[e._v("自动旋转")]),t("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.autoRotation},model:{value:e.rotationValue,callback:function(t){e.rotationValue=t},expression:"rotationValue"}})],1),e._m(4),t("div",{staticClass:"items"},[t("span",{class:[e.ifduxian?"active":""],on:{click:e.duxian}},[t("i",{staticClass:"icon iconfont",class:[e.ifduxian?"icon-quanbu":"icon-yanjing"]}),t("b",[e._v(e._s(e.ifduxian?"全显":"独显"))])]),t("span",{class:[e.dragMeshBtn?"active":""],on:{click:e.dragMesh}},[t("i",{staticClass:"icon iconfont icon-yidong"}),t("b",[e._v("移动")])]),t("span",{on:{click:e.reset}},[t("i",{staticClass:"icon iconfont icon-ic_fuwei"}),t("b",[e._v("重置")])]),t("span",{class:[e.MeasureisActive?"active":""],on:{click:e.celiang}},[t("i",{staticClass:"icon iconfont icon-chizi"}),t("b",[e._v("测量")])]),t("span",{on:{click:e.yincang}},[t("i",{staticClass:"icon iconfont icon-yincang"}),t("b",[e._v("隐藏")])]),t("span",{on:{click:e.touming2}},[t("i",{staticClass:"icon iconfont icon-toumingdutiaojie"}),t("b",[e._v("透明")])])])],1),t("div",{staticClass:"switch",on:{click:e.switchleft}},[t("i",{staticClass:"icon iconfont",class:[e.isActive?"icon-zuojiantou-copy ":"icon-zuojiantou"]})])]),t("div",{staticClass:"full-sceen",on:{click:e.fullScreen}},[t("i",{staticClass:"icon iconfont",class:[e.fullScreenBtn?"icon-quanping":"icon-quxiaoquanping"],staticStyle:{"font-size":"26px"}})]),e.MeasureisActive?t("div",{staticClass:"measureInfo"},[e.showMeasureIInfo?t("div",[t("span",[t("i",{staticClass:"icon iconfont icon-guanxianchangdu"}),t("b",[e._v(e._s(e.pointsDistance))])]),t("span",[t("i",{staticClass:"icon iconfont icon-jiaodu"}),t("b",[e._v(e._s(e.facesAngle))])])]):t("div",[t("span",[e._v(" "+e._s(e.info))])])]):e._e()])])},F=[function(){var e=this,t=e._self._c;return t("p",{staticClass:"label_row"},[t("span",[e._v("背景")])])},function(){var e=this,t=e._self._c;return t("p",{staticClass:"label_row"},[t("span",[e._v("背景图片")])])},function(){var e=this,t=e._self._c;return t("p",{staticClass:"label_row"},[t("span",[e._v("Edges")])])},function(){var e=this,t=e._self._c;return t("p",{staticClass:"label_row"},[t("span",[e._v("模型拆分")])])},function(){var e=this,t=e._self._c;return t("p",{staticClass:"label_row"},[t("span",[e._v("模型操作")])])}];class O{constructor(e,t){this.x=e,this.y=t}Clone(){return new O(this.x,this.y)}}function S(e,t){return new O(e.x-t.x,e.y-t.y)}function x(e){return Math.round(parseFloat(e))}function P(e,t){e.style.display=t?"block":"none"}function E(e){let t=x(e.paddingTop)+x(e.paddingBottom),s=x(e.borderTopWidth)+x(e.borderBottomWidth),i=x(e.marginTop)+x(e.marginBottom);return t+s+i}function I(e){let t=x(e.paddingLeft)+x(e.paddingRight),s=x(e.borderLeftWidth)+x(e.borderRightWidth),i=x(e.marginLeft)+x(e.marginRight);return t+s+i}function D(e,t,s){let i=getComputedStyle(e),n=t-I(i),o=s-E(i);return{width:n,height:o}}function R(e,t,s){let i=document.createElement(e);return t&&(i.className=t),s&&(i.innerHTML=s),i}function A(e,t,s,i){let n=R(t,s,i);return e.appendChild(n),n}function G(e,t,s){if(e.getBoundingClientRect){let i=e.getBoundingClientRect();t-=i.left,s-=i.top}return window.pageXOffset&&window.pageYOffset&&(t+=window.pageXOffset,s+=window.pageYOffset),new O(t,s)}var U=s(277),T=s(1229);class _{constructor(e,t,s){this.x=e,this.y=t,this.z=s}Clone(){return new _(this.x,this.y,this.z)}Length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}MultiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}Normalize(){let e=this.Length();return e>0&&this.MultiplyScalar(1/e),this}Offset(e,t){let s=e.Clone().Normalize();return this.x+=s.x*t,this.y+=s.y*t,this.z+=s.z*t,this}}function B(e,t){return new _(e.x-t.x,e.y-t.y,e.z-t.z)}function z(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z))}class V{constructor(e,t,s,i){this.eye=e,this.center=t,this.up=s,this.fov=i}Clone(){return new V(this.eye.Clone(),this.center.Clone(),this.up.Clone(),this.fov)}}const H=1e-8;function W(e,t){return Math.abs(t-e)<H}function N(e,t){return W(e.x,t.x)&&W(e.y,t.y)&&W(e.z,t.z)}function q(e,t){return N(e.eye,t.eye)&&N(e.center,t.center)&&N(e.up,t.up)}const K=1e-8,X=.017453292519943;function $(e){return Math.abs(e)<K}const Z={X:1,Y:2,Z:3};class Y{constructor(e){console.log(e,"scene in ViewerGeometry"),this.scene=e,this.mainObject=null}GetMainObject(){return this.mainObject}SetMainObject(e){this.mainObject=e,console.log(this.mainObject,"this.mainObject"),this.scene.add(this.mainObject)}Clear(){this.ClearMainObject()}ClearMainObject(){console.log(this.mainObject,"this.mainObjectin ClearMainObject"),null!==this.mainObject&&(this.EnumerateMeshes((e=>{console.log(e,"mesh in EnumerateMeshes "),e.geometry.dispose()})),this.scene.remove(this.mainObject),this.mainObject=null)}EnumerateMeshes(e){console.log(this.mainObject,"this.mainObject11111"),null!==this.mainObject&&this.mainObject.traverse((t=>{t.isMesh&&(console.log(t,"obj in EnumerateMeshes "),e(t))}))}GetMeshIntersectionUnderMouse(e,t,s,i){if(console.log(e,t,s,i,"in GetMeshIntersectionUnderMouse"),null===this.mainObject)return null;if(e.x<0||e.x>s||e.y<0||e.y>i)return null;let n=new U.iMs,o=new U.FM8;o.x=e.x/s*2-1,o.y=-e.y/i*2+1,n.setFromCamera(o,t);let a=n.intersectObject(this.mainObject,!0);console.log(a,"iSectObjects");for(let r=0;r<a.length;r++){let e=a[r];if("Mesh"===e.object.type&&e.object.visible)return e}return null}GetBoundingSphere(e){let t=this.GetBoundingBox(e);if(console.log(t,"boundingBox11"),null===t)return null;let s=new U.aLr;return t.getBoundingSphere(s),s}GetBoundingBox(e){if(null===this.mainObject)return;let t=(new U.ZzF).setFromObject(this.mainObject);const s=new U.Pa4;return t.getCenter(s),console.log("查看几何体中心坐标",s),console.log(t,"boundingBox in GetBoundingBox"),t}}class J{constructor(e){this.scene=e,this.ExtraObject=null}AddObject(e){null===this.ExtraObject&&(this.ExtraObject=new U.Tme,this.scene.add(this.ExtraObject)),this.ExtraObject.add(e)}Clear(){null!==this.ExtraObject&&(this.ExtraObject.traverse((e=>{(e.isMesh||e.isLineSegments)&&e.geometry.dispose()})),this.scene.remove(this.ExtraObject),this.ExtraObject=null)}}function Q(e,t,s){let i=t/s,n=i*i;return e*(n/(2*(n-i)+1))}function ee(e,t,s,i){let n=B(t,e).Normalize(),o=z(e,t),a=[];for(let r=0;r<s;r++){let t=i(o,r,s-1);a.push(e.Clone().Offset(n,t))}return a}class te{constructor(e,t,s,i){this.container=t,this.canvas=e,this.camera=s,this.callbacks=i,this.mouse=new se,this.clickDetector=new ie,this.onMouseClick=null,this.onMouseMove=null,this.canvas.addEventListener&&(console.log(this.canvas,"this.canvase111"),this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this))),this.container.addEventListener&&(this.container.addEventListener("mousemove",this.OnMouseMove.bind(this)),this.container.addEventListener("mouseup",this.OnMouseUp.bind(this)),this.container.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))}GetFitToSphereCamera(e,t){if($(t))return null;let s=this.camera.Clone();console.log(s,"fitCamera");let i=B(s.center,e);console.log(i,"offsetToOrigo"),s.eye=B(s.eye,i),s.center=e.Clone();let n=B(s.eye,s.center).Normalize();console.log(n,"centerEyeDirection");let o=this.camera.fov/2;this.canvas.width<this.canvas.height&&(o=o*this.canvas.width/this.canvas.height);let a=t/Math.sin(o*X);return s.eye=s.center.Clone().Offset(n,a),console.log(s,"fitCamera2"),s}Update(){this.callbacks.onUpdate()}GetCamera(){return this.camera}MoveCamera(e,t){function s(e,t,i,n){e.camera.eye=t.eye[n],e.camera.center=t.center[n],e.camera.up=t.up[n],e.Update(),n<i-1&&requestAnimationFrame((()=>{s(e,t,i,n+1)}))}if(null!==e){if(0===t||q(this.camera,e))this.camera=e;else{let i=Q,n={eye:ee(this.camera.eye,e.eye,t,i),center:ee(this.camera.center,e.center,t,i),up:ee(this.camera.up,e.up,t,i)};requestAnimationFrame((()=>{s(this,n,t,0)}))}this.Update()}}OnMouseDown(e){console.log(this,"this in OnMouseDown"),e.preventDefault(),this.mouse.Down(this.canvas,e),this.clickDetector.Start(this.mouse.GetPosition())}OnMouseMove(e){if(this.mouse.Move(this.canvas,e),this.clickDetector.Move(this.mouse.GetPosition()),this.onMouseMove){let t=G(this.canvas,e.clientX,e.clientY);this.onMouseMove(t)}if(!this.mouse.IsButtonDown())return;let t=this.mouse.GetMoveDiff();console.log(t,"movediff");this.mouse.GetButton()}OnMouseUp(e){if(this.mouse.Up(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){let t=this.mouse.GetPosition();this.Click(e.which,t)}}OnMouseLeave(e){this.mouse.Leave(this.canvas,e),this.clickDetector.Cancel()}SetMouseClickHandler(e){this.onMouseClick=e}SetMouseMoveHandler(e){this.onMouseMove=e}Click(e,t){this.onMouseClick&&this.onMouseClick(e,t)}}class se{constructor(){this.buttons=[],this.curr=new O(0,0),this.prev=new O(0,0),this.diff=new O(0,0)}Down(e,t){console.log(e,t,"in Down"),this.buttons.push(t.which),console.log(this.buttons,"this.buttons"),this.curr=this.GetPositionFromEvent(e,t),this.prev=this.curr.Clone()}Move(e,t){this.curr=this.GetPositionFromEvent(e,t),this.diff=S(this.curr,this.prev),this.prev=this.curr.Clone()}Up(e,t){console.log(this.buttons,"this.buttons 1");let s=this.buttons.indexOf(t.which);console.log(s,"buttonIndex"),-1!==s&&this.buttons.splice(s,1),console.log(this.buttons,"this.buttons 2"),this.curr=this.GetPositionFromEvent(e,t)}Leave(e,t){this.buttons=[],this.curr=this.GetPositionFromEvent(e,t)}GetButton(){let{length:e}=this.buttons;return console.log(e,"length in GetButton"),0===e?0:this.buttons[e-1]}GetMoveDiff(){return this.diff}IsButtonDown(){return this.buttons.length>0}GetPosition(){return this.curr}GetPositionFromEvent(e,t){return G(e,t.clientX,t.clientY)}}class ie{constructor(){this.isClick=!1,this.startPosition=null}Start(e){this.isClick=!0,this.startPosition=e,console.log(this.startPosition,"this.startPosition")}Move(e){this.isClick}End(){this.startPosition=null}Cancel(){this.isClick=!1,this.startPosition=null}IsClick(){return this.isClick}}function ne(e){return new U.Ilk(e.r/255,e.g/255,e.b/255)}const oe={Phong:1,Physical:2};class ae{constructor(e){this.scene=e,this.ambientLight=new U.Mig(4210752,3),this.directionalLight=new U.Ox3(16777215,1),this.directionalLight.castShadow=!0,this.directionalLight.position.set(1200,2800,1200),this.scene.add(new U.cBI(this.directionalLight)),this.scene.add(new U.Rki(this.directionalLight.shadow.camera)),this.environment=null,this.backgroundIsEnvMap=!1,this.scene.add(this.ambientLight),this.scene.add(this.directionalLight)}SetType(e){this.type=e,this.UpdateShading()}SetEnvironment(e,t,s){let i=new U.cBK;this.environment=i.load(e,(()=>{s()})),this.backgroundIsEnvMap=t}UpdateShading(){console.log(this.backgroundIsEnvMap,"this.backgroundIsEnvMap"),this.type===oe.Phong?(this.ambientLight.color.set(8947848),this.directionalLight.color.set(8947848),this.scene.environment=null):this.type===oe.Physical&&(this.ambientLight.color.set(0),this.directionalLight.color.set(5592405),this.scene.environment=this.environment),this.backgroundIsEnvMap?this.scene.background=this.environment:this.scene.background=null}}var re=s(5549),le=s(1049),ce=s(7996),he=s(454),de=s(8942),ue=s(8429);function ge(e,t=.01){return(new U.Pa4).addVectors(e.max,e.min).multiplyScalar(t)}function me(e){if(!e)return;const t=new U.ZzF;t.setFromObject(e);const s=ge(t),i=new U.ZzF;e.traverse((function(e){if(!(e.isMark||e.isMarkChild||e.isLine||e.isSprite)&&e.isMesh){i.setFromObject(e);const t=ge(i);e.userData.worldDir=(new U.Pa4).subVectors(t,s).normalize(),e.userData.worldDistance=(new U.Pa4).subVectors(t,s),e.userData.originPosition=e.getWorldPosition(new U.Pa4),e.userData.meshCenter=t.clone(),e.userData.explodeCenter=s.clone()}}))}function fe(e,t){console.log(e,t,"explodeModel"),e.traverse((function(e){if(console.log(e.userData,"value.userData"),!e.isMesh||!e.userData.originPosition)return;const s=e.userData.worldDir.clone().multiplyScalar(e.userData.worldDistance.length()*t);console.log(s,"distance");const i=(new U.Pa4).subVectors(e.userData.meshCenter,e.userData.originPosition);console.log(i,"offset");const n=e.userData.explodeCenter;console.log(n,"center");const o=(new U.Pa4).copy(n).add(s).sub(i),a=e.parent&&e.parent.worldToLocal(o.clone())?e.parent.worldToLocal(o.clone()):void 0;a&&e.position.copy(a)}))}class pe{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const s=this._listeners;void 0===s[e]&&(s[e]=[]),-1===s[e].indexOf(t)&&s[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const s=this._listeners;return void 0!==s[e]&&-1!==s[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const s=this._listeners,i=s[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners,s=t[e.type];if(void 0!==s){e.target=this;const t=s.slice(0);for(let s=0,i=t.length;s<i;s++)t[s].call(this,e)}}}let we;class be extends pe{constructor(e,t){super(),we=e,this.viewer=e,this.website=t,console.log(e,"viewer in outline"),this.renderer=e.renderer,this.scene=e.scene,this.camera=e.camera,this.container=e.canvas,console.log(this.container,"this.caontainer in outline"),this.composer=null,this.effectFXAA=null,this.outlinePass=null,this.selectedObject=null,this.groups=[],this.toumingMaterials={},this.yincangMeshs={},this.phongMaterial=new U.xoR({color:5592405,specular:16777215,shininess:10,flatShading:!1,side:U.ehD,skinning:!0}),this.model=null,this.dragControls=null,this.cloneModel=null,this.dragGroup=new U.ZAu,this.MeshPostions=new Map,this.flag=!1,this.blastValue=0}getSelectedObject(){return this.selectedObject}Click(e){console.log(e,"mouseCoordinates in Outline");let t=we.GetMeshIntersectionUnderMouse(e);if(console.log(t,"intersection in OutlineClick"),null===t)return!1;this.selectedObject=t.object,console.log(this.selectedObject.name,"选择的mesh"),this.addSelectedObject(this.selectedObject),this.outlineObj(this.selectedObjects)}Click2(e){console.log(e,"mouseCoordinates in Outline");let t=we.GetMeshIntersectionUnderMouse(e);if(console.log(t,"intersection in OutlineClick"),null===t)return!1;this.selectedObject=t.object,this.selectedObject.currentHex=this.selectedObject.material.emissive.getHex(),this.selectedObject.material.emissive.setHex(16711680)}addSelectedObject(e){this.selectedObjects=[],this.selectedObjects.push(e)}outlineObj(e){console.log(e,"selectedObjects in outlineObj"),this.composer=new re.x(this.renderer),console.log(this.composer,"this.composer");const t=new le.C(this.scene,this.camera);this.composer.addPass(t),this.outlinePass=new he.f(new U.FM8(this.container.offsetWidth,this.container.offsetHeight),this.scene,this.camera),console.log(this.outlinePass,"this.outlinePass"),this.composer.addPass(this.outlinePass),this.outlinePass.pulsePeriod=2,this.outlinePass.visibleEdgeColor.set("green"),this.outlinePass.hiddenEdgeColor.set("green"),this.outlinePass.usePatternTexture=!1,this.outlinePass.edgeStrength=5,this.outlinePass.edgeGlow=1,this.outlinePass.edgeThickness=1,this.effectFXAA=new ce.T(de.C),this.effectFXAA.uniforms.resolution.value.set(1/this.container.offsetWidth,1/this.container.offsetHeight),this.composer.addPass(this.effectFXAA),this.outlinePass.selectedObjects=e}duxian(e,t){this.model=e,console.log(this.selectedObject,"this.selectObj"),this.selectedObject&&(t?(y.commit("app/DUXIAN",!0),this.model.traverse((e=>{e instanceof U.Kj0&&e.name!==this.selectedObject.name&&(e.visible=!1)}))):(y.commit("app/DUXIAN",!1),this.model.traverse((e=>{e instanceof U.Kj0&&(e.visible=!0)}))))}touming(e,t){if(this.model=e,this.selectedObject)if(t)console.log(this.selectedObject,"选择的mesh 透明"),this.model.traverse((e=>{e instanceof U.Kj0&&(this.groups.push(e),e.name==this.selectedObject.name&&(this.toumingMaterials.hasOwnProperty(this.selectedObject.name)?this.selectedObject.material.transparent?this.selectedObject.material=this.toumingMaterials[e.name]:(e.material=this.phongMaterial,e.material.transparent=!0,e.material.opacity=.5):(this.toumingMaterials[e.name]=this.selectedObject.material,e.material=this.phongMaterial,e.material.transparent=!0,e.material.opacity=.5)))}));else for(const s in this.toumingMaterials)console.log(s,"key"),this.model.traverse((e=>{e instanceof U.Kj0&&e.name===s&&(e.material=this.toumingMaterials[s])}))}yincang(e){this.model=e,this.model.traverse((e=>{e instanceof U.Kj0&&e.name===this.selectedObject.name&&(this.yincangMeshs[e.name]=this.selectedObject,e.visible=!1)}))}dragMesh(e,t){this.flag=t,this.model=e,this.cloneModel=e.clone(),console.log(this.selectedObjects,"selectedObjects -dragMesh"),console.log(this.model,"this.model in dragMesh1 "),console.log(this.model,"this.cloneModel in dragMesh1 "),this.flag?(this.dragControls=new ue.S([this.model],this.viewer.camera,this.viewer.renderer.domElement),this.dragControls.addEventListener("dragstart",(e=>{console.log(e,"event0000"),we.controls.enabled=!1,console.log(this.selectedObject,"this.selectedObject1111"),this.MeshPostions.set(e.object.name,e.object.position)})),this.dragControls.addEventListener("dragend",(e=>{console.log(e,"event11111111"),console.log(this.MeshPostions,"  this.MeshPostions222"),we.controls.enabled=!0}))):(we.controls.enabled=!0,this.dragControls.deactivate())}rotation(e){we.controls.autoRotate=!!e}SetEnvironment(e="ice_river",t=!1,s){if(t){const t=new U.cBK,i="/static/envmaps/"+e+"/",n=[i+"posx.jpg",i+"negx.jpg",i+"posy.jpg",i+"negy.jpg",i+"posz.jpg",i+"negz.jpg"],o=t.load(n,(function(){s&&s()}));this.scene.background=o}else this.scene.background=new U.Ilk("#212121")}SetbackgroundColor(e){we.scene.background=0===e?new U.Ilk("#212121"):1===e?new U.Ilk("#474747"):new U.Ilk("#afafaf")}reset(){if(this.website.Measure(!1),this.model){y.commit("app/DUXIAN",!1);for(const e in this.yincangMeshs)this.model.traverse((t=>{t instanceof U.Kj0&&t.name===e&&(t.visible=!0)}));this.model.traverse((e=>{e instanceof U.Kj0&&(e.visible=!0)}));for(const e in this.toumingMaterials)this.model.traverse((t=>{t instanceof U.Kj0&&t.name===e&&(console.log(this.toumingMaterials[e],"this.toumingMaterials[key]"),t.material=this.toumingMaterials[e])}));if(this.blastValue=0,y.dispatch("app/resetBlastVal"),fe(this.model,this.blastValue),this.MeshPostions){for(let e of this.MeshPostions.keys())console.log(e,"key in  reset "),this.model.traverse((t=>{t.name===e&&(console.log(t,"child11111"),t.position.set(0,0,0))}));this.flag&&this.dragControls.activate()}}}tweenCamera(e,t){(new U.Pa4).copy(e.center),new U.Pa4(20,20,20)}Blast(e,t){this.model=e,this.blastValue=t,fe(this.model,this.blastValue),y.dispatch("app/changBlastVal",this.blastValue)}Edge(e,t){this.model=e,y.commit("app/CHANGE_EDGE_VAL",t),this.website.UpdateEdgeDisplay(!0,t)}}var ve=s(5897);function Me(e){let t=45;return e===Z.X?new V(new _(2,-3,1.5),new _(0,0,0),new _(1,0,0),t):e===Z.Y?new V(new _(-1.5,2,3),new _(0,0,0),new _(0,1,0),t):e===Z.Z?new V(new _(-1.5,-3,2),new _(0,0,0),new _(0,0,1),t):null}let Le=!1;class ye{constructor(e,t,s,i){this.website=i,this.signals=i.signals,console.log(this.signals,"this.signals  in Viewer"),this.settings={animationSteps:40},console.log(e,"mainDiv in Viewer"),this.canvas=null,this.mainDiv=e,this.renderer=null,this.scene=null,this.camera=null,this.fov=45,this.near=.1,this.far=1e4,this.navigation=null,this.shading=null,this.outline=null,this.view2=t,console.log(t,"view2 in Viewer")}Init(e){this.canvas=e,this.canvas.id="viewer";let t={canvas:this.canvas,antialias:!0};this.renderer=new U.CP7(t),window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=U.ntZ,this.renderer.setClearColor("#ffffff",1),this.renderer.setSize(this.canvas.width,this.canvas.height),this.scene=new U.xsS,this.scene.background=new U.Ilk(12571109),this.camera=new U.cPb(45,this.canvas.width/this.canvas.height,this.near,this.far),this.camera.position.set(500,500,500),console.log(this.camera,"this.camera...."),Le&&(this.camera2=new U.cPb(50,this.canvas.width/this.canvas.height,.1,3e3),this.camera2.position.set(600,600,600),this.camera2.lookAt(0,0,0)),this.cameraHelper=new U.Rki(this.camera),this.scene.add(this.cameraHelper);const s=new U.DvJ(10,10,10),i=new U.vBJ({color:65280}),n=new U.Kj0(s,i);n.position.set(500,500,500),this.scene.add(n),this.InitShading(),this.controls=new T.z(this.camera,this.mainDiv),this.controls.enableDamping=!0,this.controls.target.set(0,0,0),this.controls.update(),Le&&(this.controls2=new T.z(this.camera2,this.view2),this.controls2.target.set(0,0,0),this.controls2.update()),this.geometry=new Y(this.scene),this.extraGeometry=new J(this.scene);let o=this.renderer.domElement,a=Me(Z.Y);console.log(a,"camera in GetDefaultCamera"),this.navigation=new te(o,this.mainDiv,a,{onUpdate:()=>{this.RenderCamera()}}),this.outline=new be(this,this.website);let r=new U.y8_(1e3);this.scene.add(r);let l=new U.VLJ(1e4,100,2894892,8947848);this.scene.add(l),this.animate()}initGui(e){class t{constructor(e,t,s,i){this.obj=e,this.minProp=t,this.maxProp=s,this.minDif=i}get min(){return this.obj[this.minProp]}set min(e){this.obj[this.minProp]=e,this.obj[this.maxProp]=Math.max(this.obj[this.maxProp],e+this.minDif)}get max(){return this.obj[this.maxProp]}set max(e){this.obj[this.maxProp]=e,this.min=this.min}}function s(){console.log(e,"camera updateCamera"),e.updateProjectionMatrix()}const i=new ve.XS;i.add(this.camera,"fov",1,180).onChange(s);const n=new t(this.camera,"near","far",.1);i.add(n,"min",.1,50,.1).name("near").onChange(s),i.add(n,"max",.1,3e4,.1).name("far").onChange(s),this.makeXYZGUI(i,e.position,"position",s)}makeXYZGUI(e,t,s,i){const n=e.addFolder(s);n.add(t,"x",t.x-5e3,t.x+5e3).onChange(i),n.add(t,"y",t.y-5e4,t.y+5e3).onChange(i),n.add(t,"z",t.z-5e4,t.z+5e3).onChange(i),n.open()}InitShading(){this.shading=new ae(this.scene)}SetEnvironmentMapSettings(e,t){console.log(e,t,"SetEnvironmentMapSettings"),this.shading.SetEnvironment(e,t,(()=>{})),this.shading.UpdateShading()}SetCamera(e){}Resize(e,t){console.log(e,"width",t,"height");D(this.canvas,e,t);console.log(this.outline,"this.outline"),console.log(this.mainDiv.offsetWidth,"this.mainDiv.offsetWidth"),console.log(this.mainDiv.offsetHeight,"this.mainDiv.height"),this.ResizeRenderer(this.mainDiv.offsetWidth,this.mainDiv.offsetHeight)}ResizeRenderer(e,t){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}SetMainObject(e){console.log(e,"object in viewer SetMainObject"),this.geometry.SetMainObject(e)}AddExtraObject(e){this.extraGeometry.AddObject(e)}Clear(){this.geometry.Clear(),this.extraGeometry.Clear()}ClearExtra(){this.extraGeometry.Clear()}animate(){requestAnimationFrame(this.animate.bind(this)),this.controls&&this.controls.update(),this.render()}setScissorForElement(e){let t=this.mainDiv;const s=t.getBoundingClientRect(),i=e.getBoundingClientRect(),n=Math.min(i.right,s.right)-s.left,o=Math.max(0,i.left-s.left),a=Math.min(i.bottom,s.bottom)-s.top,r=Math.max(0,i.top-s.top),l=Math.min(s.width,n-o),c=Math.min(s.height,a-r),h=s.height-a;return this.renderer.setScissor(o,h,l,c),this.renderer.setViewport(o,h,l,c),l/c}resizeRendererToDisplaySize(e){const t=e.domElement,s=t.clientWidth,i=t.clientHeight,n=t.width!==s||t.height!==i;return n&&this.renderer.setSize(s,i,!1),n}RenderCamera(){let e=this.navigation.GetCamera();console.log(e,"navigationCamera11111111"),this.camera.position.set(e.eye.x,e.eye.y,e.eye.z),this.camera.up.set(e.up.x,e.up.y,e.up.z),this.camera.lookAt(new U.Pa4(e.center.x,e.center.y,e.center.z)),this.controls.target.set(e.center.x,e.center.y,e.center.z),this.controls.update()}render(){if(this.renderer){if(Le){let e=this.mainDiv,t=this.view2;this.resizeRendererToDisplaySize(this.renderer),this.renderer.setScissorTest(!0);{const t=this.setScissorForElement(e);this.camera.aspect=t,this.camera.updateProjectionMatrix(),this.cameraHelper.update(),this.renderer.render(this.scene,this.camera)}{const e=this.setScissorForElement(t);this.camera2.aspect=e,this.camera2.updateProjectionMatrix(),this.cameraHelper.visible=!0,this.renderer.render(this.scene,this.camera2)}}else this.renderer.clear(),this.renderer.render(this.scene,this.camera);null!=this.outline.composer&&this.outline.composer.render()}}SetMouseClickHandler(e){this.navigation.SetMouseClickHandler(e)}SetMouseMoveHandler(e){this.navigation.SetMouseMoveHandler(e)}GetCanvasSize(){let e=this.canvas.width,t=this.canvas.height;return window.devicePixelRatio&&(e/=window.devicePixelRatio,t/=window.devicePixelRatio),{width:e,height:t}}GetMeshIntersectionUnderMouse(e){let t=this.GetCanvasSize();console.log(t,"canvasSize");let s=this.geometry.GetMeshIntersectionUnderMouse(e,this.camera,t.width,t.height);return null===s?null:s}GetBoundingSphere(e){return this.geometry.GetBoundingSphere(e)}AdjustClippingPlanesToSphere(e){null!==e&&(e.radius<10?(this.camera.near=.01,this.camera.far=100):e.radius<100?(this.camera.near=.1,this.camera.far=1e3):e.radius<1e3?(this.camera.near=10,this.camera.far=1e4):(this.camera.near=100,this.camera.far=1e6),this.camera.updateProjectionMatrix(),this.RenderCamera())}FitSphereToWindow(e,t){if(console.log(e,t,"FitSphereToWindow"),null===e)return;let s=new _(e.center.x,e.center.y,e.center.z);console.log(s,"center in  FitSphereToWindow");let i=e.radius,n=this.navigation.GetFitToSphereCamera(s,i);console.log(n,"newCamera"),this.navigation.MoveCamera(n,t?this.settings.animationSteps:60)}}let je={StringToModelUrls(e){return null===e||0===e.length?null:e.split(",")}};class Ce{constructor(e,t){this.separator=t,this.paramList=e}GetModelUrls(){if(-1===this.paramList.indexOf("="))return this.paramList.split(",");let e=this.GetKeywordParams("model");return je.StringToModelUrls(e)}GetKeywordParams(e){if(null===this.paramList||0===this.paramList.length)return null;let t=`${e}=`;console.log(this.paramList," this.paramList GetKeywordParams");let s=this.paramList.split(this.separator);console.log(s,"urlParts");for(let i=0;i<s.length;i++){let e=s[i];if(e.startsWith(t))return e.substring(t.length)}return null}}function ke(e){return new Ce(e,"$")}class Fe{constructor(){this.eventListener=null,this.skipNextEvent=!1}SetEventListener(e){this.eventListener=e,window.onhashchange=this.OnChange.bind(this)}OnChange(){alert("OnChange"),this.skipNextEvent&&alert("skipNextEvent")}HasHash(){let e=this.GetHash();return console.log(e,"hash-----"),e.length>0}GetHash(){return window.location.hash.substring(1)}GetModelFilesFromHash(){let e=ke(this.GetHash());return e.GetModelUrls()}}const Oe={Url:1,File:2,Decompressed:3};function Se(e){let t=e.lastIndexOf("/");-1===t&&(t=e.lastIndexOf("\\"));let s=e;-1!==t&&(s=e.substring(t+1));let i=s.indexOf("?");return-1!==i&&(s=s.substring(0,i)),decodeURI(s)}function xe(e){let t=Se(e),s=t.lastIndexOf(".");if(console.log(s,"firstPoint in GetFileExtension"),-1===s)return"";let i=t.substring(s+1);return i.toLowerCase()}function Pe(e,t){return new Promise(((s,i)=>{console.log(e,"url in RequestUrl");let n=new XMLHttpRequest;n.open("GET",e,!0),n.onprogress=e=>{t(e.loaded,e.total)},n.onload=()=>{console.log(n,"request in RequestUrl"),200===n.status?s(n.response):i()},n.onerror=()=>{i()},n.responseType="arraybuffer",n.send(null)}))}function Ee(e,t){return new Promise(((s,i)=>{let n=new FileReader;n.onprogress=e=>{t(e.loaded,e.total)},n.onloadend=e=>{e.target.readyState===FileReader.DONE&&s(e.target.result)},n.onerror=()=>{i()},n.readAsArrayBuffer(e)}))}function Ie(){return new Promise(((e,t)=>{e({msg:"success"})}))}let De=null;function Re(e){De=e}function Ae(e,t,s){void 0!==De&&null!==De&&De(e,t,s)}class Ge{constructor(){this.count=null,this.current=null,this.callbacks=null}Run(e,t){this.count=e,this.current=0,this.callbacks=t,0===e?alert("run 0"):this.RunOnce()}RunOnce(){console.log(this.callbacks,"this.callbacks in RunOnce "),setTimeout((()=>{this.callbacks.runTask(this.current,this.TaskReady.bind(this))}),0)}TaskReady(){this.current+=1,this.current<this.count?this.RunOnce():this.callbacks.onReady&&this.callbacks.onReady()}}function Ue(e,t){let s=new Ge;s.Run(e,t)}class Te{constructor(){this.content=null}SetContent(e){this.content=e}}let _e=new Te,Be=Ie();function ze(e){Be.then((t=>{console.log(e,"testfile in testPromise"),e.SetContent(t),console.log(e,"testfile2 in testPromise"),console.log(t,"content in testPromise")})).catch((()=>{})).finally((()=>{console.log("testPromise-finally")}))}ze(_e);class Ve{constructor(e,t,s){this.name=Se(e),this.extension=xe(e),this.source=t,this.data=s,this.content=null}SetContent(e){this.content=e}}class He{constructor(){this.files=[]}GetFiles(){return this.files}GetContent(e){console.log("GetContent-3"),console.log(this.files,"this.files in GetContent"),Ue(this.files.length,{runTask:(t,s)=>{e.onFileListProgress(t,this.files.length),console.log("GetContent-5"),console.log(t,"index in RunTask"),console.log(s,"onTaskComplete in RunTask"),this.GetFileContent(this.files[t],{onReady:s,onProgress:e.onFileLoadProgress})},onReady:e.onReady})}GetFileContent(e,t){if(null!==e.content)return void t.onReady();console.log(e,"file in GetFileContent");let s=null;e.source===Oe.Url?(s=Pe(e.data,t.onProgress),console.log(s,"loaderPromise")):e.source===Oe.File&&(s=Ee(e.data,t.onProgress)),console.log("loaderPromise1"),s.then((t=>{console.log(t,"content in GetFileContent"),console.log(e,"file in loaderPromise"),e.SetContent(t)})).catch((()=>{})).finally((()=>{console.log("finally"),t.onReady()})),console.log("loaderPromise3")}FillFromInputFiles(e){this.files=[];for(let t of e){let e=new Ve(t.name,t.source,t.data);this.files.push(e)}}}class We{constructor(e,t,s){this.name=e,this.source=t,this.data=s}}function Ne(e){let t=[];for(let s of e){let e=Se(s);t.push(new We(e,Oe.Url,s))}return t}function qe(e){let t=[];for(let s of e){let e=Se(s.name);t.push(new We(e,Oe.File,s))}return t}class Ke{constructor(){this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null}}class Xe extends Ke{constructor(){super()}CanImportExtension(e){return"obj"===e}}class $e{constructor(){this.importers=[new Xe],this.fileList=new He}ImportFiles(e,t,s){s.onLoadStart(),this.LoadFiles(e,{onReady:()=>{console.log(this.fileList,"GetContent-0"),s.onImportStart()},onFileListProgress:s.onFileListProgress,onFileLoadProgress:s.onFileLoadProgress})}LoadFiles(e,t){let s=new He;s.FillFromInputFiles(e),console.log(JSON.stringify(s),"newFileList");let i=!1;this.HasImportableFile(s)&&(i=!0),i&&(this.fileList=s),console.log("GetContent-1"),this.fileList.GetContent({onReady:t.onReady,onFileListProgress:t.onFileListProgress,onFileLoadProgress:t.onFileLoadProgress}),console.log("GetContent-2"),console.log(this.fileList,"this.fileList in LoadFiles")}HasImportableFile(e){let t=this.GetImportableFiles(e);return t.length>0}GetImportableFiles(e){function t(e,t){for(let s=0;s<t.length;s++){let i=t[s];if(i.CanImportExtension(e.extension))return console.log(i,"importer in GetImportableFiles"),i}return null}let s=[],i=e.GetFiles();console.log(i,"files in GetImportableFiles");for(let n=0;n<i.length;n++){let e=i[n],o=t(e,this.importers);null!==o&&(s.push({file:e,importer:o}),console.log(s,"importableFiles  inGetImportableFiles"))}return s}}class Ze{constructor(){this.inProgress=!1,this.importer=new $e}InProgress(){return this.inProgress}LoadModel(e,t,s){this.inProgress,this.inProgress=!0,this.importer.ImportFiles(e,t,{onLoadStart:()=>{s.onLoadStart()},onFileListProgress:(e,t)=>{s.onFileListProgress(e,t)},onFileLoadProgress:(e,t)=>{s.onFileLoadProgress(e,t)},onImportStart:()=>{s.onImportStart()},onSelectMainFile:()=>{},onImportSuccess:()=>{s.onVisualizationStart()},onImportError:e=>{s.onLoadError(e)}})}}class Ye{constructor(){this.modelLoader=new Ze}LoadModel(e,t,s){console.log(e,"inputFiles in ThreeModelLoaderUI"),console.log(t,"settings"),console.log(s,"callbacks"),this.modelLoader.InProgress()||this.modelLoader.LoadModel(e,t,{onLoadStart:()=>{s.onStart()},onFileListProgress:(e,t)=>{console.log(e,t,"onFileListProgress文件进度")},onFileLoadProgress:(e,t)=>{console.log(e,t,"onFileLoadProgress")},onSelectMainFile:()=>{},onImportStart:()=>{},onVisualizationStart:()=>{},onModelFinished:()=>{},onTextureLoaded:()=>{},onLoadError:()=>{}})}}class Je{constructor(e,t,s){this.name=e,this.source=t,this.data=s}}class Qe{constructor(e,t,s){this.name=Se(e),this.extension=xe(e),this.source=t,this.data=s,this.content=null,this.size=s.size}SetContent(e){this.content=e,console.log(this,e,"this in setContent")}setSize(e){this.size=e}}class et{constructor(){this.files=[]}GetFiles(){return this.files}FillFromInputFiles(e){this.files=[];for(let t of e){let e=new Qe(t.name,t.source,t.data);this.files.push(e)}}GetContent(e){console.log(this.files,"this.files in GetContent"),Ue(this.files.length,{runTask:(t,s)=>{console.log(t,"index in runTask"),e.onFileListProgress(t,this.files.length),this.GetFileContent(this.files[t],{onReady:s,onProgress:(s,i)=>{console.log(s,i,"load onProgress"),this.files[t].setSize(i),e.onFileLoadProgress(s,i)}})},onReady:e.onReady})}GetFileContent(e,t){console.log(e," file in GetFileContent");let s=null;e.source===Oe.Url?s=Pe(e.data,t.onProgress):e.source===Oe.File&&(s=Ee(e.data,t.onProgress)),s.then((t=>{console.log(t,e,"content in loaderPromise"),e.SetContent(t),console.log(t,e,"content in loaderPromise2")})).catch((e=>{})).finally((()=>{t.onReady()}))}}function tt(e){let t=[];for(let s of e){console.log(s,"url in InputFilesFromUrls");let e=Se(s);t.push(new Je(e,Oe.Url,s))}return t}function st(e){let t=[];for(let s of e){console.log(s,"fileObject");let e=Se(s.name);t.push(new Je(e,Oe.File,s,s.size))}return t}const it={createFilesMap:function(e){const t=new Map;for(let s=0;s<e.length;s++){const i=e[s];t.set(i.name,e[s])}return t},getFilesFromItemList:function(e,t){let s=0,i=0;const n=[],o={};function a(){s++,console.log(s,"itemsCount"),s===i&&t(n,o)}function r(e){if(e.isDirectory){const t=e.createReader();t.readEntries((function(e){for(let t=0;t<e.length;t++)r(e[t]);a()}))}else e.isFile&&(e.file((function(t){console.log(t,"file in entry.file"),n.push(t),o[e.name]=t,a()})),console.log(e,"entry "),console.log(n,"files in handleEntry"));i++}for(let l=0;l<e.length;l++){const t=e[l];console.log(t,"item in getFilesFromItemList"),"file"===t.kind&&(console.log(t.webkitGetAsEntry(),"item.webkitGetAsEntry()"),r(t.webkitGetAsEntry()))}}};function nt(e){let t=new TextDecoder("utf-8");return t.decode(e)}function ot(e){URL.revokeObjectURL(e)}var at=s(6085);function rt(e,t){t.onModelFinished(e)}class lt{constructor(e){this,this.viewer=e,this.callbacks=null,this.objectURLs=[]}RevokeObjectUrls(){if(console.log(this.objectURLs,"this.objectURLs in RevokeObjectUrls"),null!==this.objectURLs){for(let e of this.objectURLs)ot(e);this.objectURLs=[]}}DragLoadFiles(e,t,s){if(this.callbacks=s,e.length>0){console.log(e,"files in DragLoadFiles"),t=t||it.createFilesMap(e),console.log(t,"filesMap in DragLoadFiles");const i=new U.lLk;i.setURLModifier((e=>{console.log(e,"url in setURLModifier"),e=e.replace(/^(\.?\/)/,"");const s=t[e];return console.log("file-url",s),s?(console.log("Loading in setURLModifier",e),console.log(URL.createObjectURL(s),"URL.createObjectURL(file)"),this.objectURLs.push(URL.createObjectURL(s)),URL.createObjectURL(s)):e})),console.log(this.objectURLs,"objectURLs"),i.addHandler(/\.tga$/i,new at.U);for(let t=0;t<e.length;t++)this.DragLoadFile(e[t],i,s)}}DragLoadFile(e,t,i){console.log(this,"this in DragLoadFile");const n=e.name,o=n.split(".").pop().toLowerCase(),a=new FileReader;switch(a.addEventListener("progress",(function(e){const t="("+Math.floor(e.total/1e3).format()+" KB)",s=Math.floor(e.loaded/e.total*100)+"%";console.log("Loading",n,t,s)})),o){case"fbx":a.addEventListener("load",(async function(e){const n=e.target.result,{FBXLoader:o}=await Promise.resolve().then(s.bind(s,6618)),a=new o(t),r=a.parse(n);console.log(this.objectURLs,"this.objectURLs in fbx"),rt(r,i)}),!1),a.readAsArrayBuffer(e);break;case"obj":a.addEventListener("load",(async function(e){const t=e.target.result,{OBJLoader:o}=await s.e(189).then(s.bind(s,8189)),a=(new o).parse(t);a.name=n,rt(a,i)}),!1),a.readAsText(e);break}}}let ct,ht,dt=null;new Set;function ut(e){dt=e}function gt(e,t){t.onModelFinished(e)}function mt(e){let t;if("string"===typeof e)t=e;else{const s=U.Zp0.decodeText(new Uint8Array(e,0,4));if("glTF"===s){const t=new DataView(e).getUint32(4,!0);return t<2}t=U.Zp0.decodeText(new Uint8Array(e))}const s=JSON.parse(t);return void 0!=s.asset&&s.asset.version[0]<2}function ft(e,t){switch(void 0===e.metadata&&(e.metadata={type:"Geometry"}),void 0===e.metadata.type&&(e.metadata.type="Geometry"),void 0!==e.metadata.formatVersion&&(e.metadata.version=e.metadata.formatVersion),e.metadata.type.toLowerCase()){case"buffergeometry":{const s=new U.s4_,i=s.parse(e),n=new U.Kj0(i);gt(n,t);break}case"geometry":console.error('Loader: "Geometry" is no longer supported.');break;case"object":{const s=new U.Gql;s.setResourcePath(ht.texturePath),s.parse(e,(function(e){e.isScene?(alert("scene"),gt(e,t)):gt(e,t)}));break}case"app":ct.fromJSON(e);break}}class pt{constructor(e,t){ht=this,ct=e,this.signals=e.signals,this.callbacks=null,this.objectURLs=[],console.log(t,"viewer in Loader"),this.fileList=new et,this.viewer=t,this.dragLoader=new lt(this.viewer),this.texturePath=""}loadItemUrls(e,t){this.callbacks=t,console.log(this.fileList,"this.fileList"),console.log(e,"urls in loadItemUrls");let s=tt(e);console.log(s,"inputFiles in loadItemUrls");let i=new et;i.FillFromInputFiles(s),console.log(i,"newFileList in loadItemUrls"),this.fileList=i,console.log(this.fileList,"this.fileList2"),t.onLoadStart(),this.fileList.GetContent({onReady:()=>{t.onImportStart(),this.loadFiles(this.fileList,e,n)},onFileListProgress:t.onFileListProgress,onFileLoadProgress:t.onFileLoadProgress});const n=new Map;for(let o=0;o<e.length;o++){const t=e[o];console.log(t,"file in loadItemUrls11 "),n.set(Se(t),t)}console.log(n,"filesMap in  loadItemUrls")}loadItemList(e,t){this.callbacks=t,console.log(e,"items in loadItemList"),it.getFilesFromItemList(e,((e,s)=>{console.log(e,"files in loadItemList"),console.log(st(e),"InputFilesFromFileObjects(files)");let i=st(e),n=new et;n.FillFromInputFiles(i),console.log(n,"newFileList in loadItemList"),this.fileList=n,console.log(this.fileList,"this.fileList in  loadItemList");let o=it.createFilesMap(e);t.onLoadStart(),this.fileList.GetContent({onReady:()=>{t.onImportStart(),this.loadFiles(this.fileList,e,o)},onFileListProgress:t.onFileListProgress,onFileLoadProgress:t.onFileLoadProgress})}))}loadFiles(e,t,s){if(console.log(e,t,"fileList in loadFiles"),t.length>0){s=s||it.createFilesMap(t),console.log(s,"filesMap in loadFiles");const i=new U.lLk;i.onStart=()=>{console.log("Started loading file")},i.setURLModifier((t=>{console.log(t,"url in setURLModifier"),"blob:"==t.substring(0,5)||(t=Se(t)),console.log(t,s,"url2222222");let i=e.files.find((e=>e.name===t));console.log(i,"filetest");let n=e.files.find((e=>e.name===t));if(console.log("file-url",n),n&&n.content){n=n.content,console.log("Loading in setURLModifier",t);let e=new Blob([n]);return console.log(e,"blob"),console.log(URL.createObjectURL(e),"URL.createObjectURL(blob)"),this.objectURLs.push(URL.createObjectURL(e)),URL.createObjectURL(e)}return t})),console.log(this.objectURLs,"objectURLs");let n=e.files;for(let e=0;e<n.length;e++)this.loadFile(n[e],s,i)}}async loadFile(e,t,i){console.log(e,t,"file in loadFile");const n=e.extension;e.source;const o=new FileReader;o.addEventListener("progress",(function(t){const s="("+Math.floor(t.total/1e3).format()+" KB)",i=Math.floor(t.loaded/t.total*100)+"%";console.log("Loading",e.name,s,i)}));try{switch(n){case"obj":{console.log(this.fileList,"this.fileList in obj");let n=e.name.split(".")[0];if(t.has(`${n}.obj`)&&t.has(`${n}.mtl`)){const{MTLLoader:e}=await s.e(322).then(s.bind(s,2322)),{OBJLoader:t}=await s.e(189).then(s.bind(s,8189));let o=this.fileList.files.find((e=>e.name===`${n}.mtl`)).content;const a=new e(i).parse(nt(o));console.log(a,"materials");const r=new t;let l=this.fileList.files.find((e=>e.name===`${n}.obj`)).content;const c=r.setMaterials(a).parse(nt(l));console.log(c,"object"),gt(c,this.callbacks)}else if(t.has(`${n}.obj`)){const{OBJLoader:e}=await s.e(189).then(s.bind(s,8189)),t=new e;let i=this.fileList.files.find((e=>e.name===`${n}.obj`)).content;const o=t.parse(nt(i));gt(o,this.callbacks)}break}case"fbx":{let t=e.content;const{FBXLoader:n}=await Promise.resolve().then(s.bind(s,6618)),o=new n(i),a=o.parse(t);console.log(this,"this in fbx22"),console.log(a,"object in fbx"),gt(a,this.callbacks);break}case"3dm":{let t=e.content;const{Rhino3dmLoader:i}=await s.e(503).then(s.bind(s,1503)),n=new i;n.setLibraryPath("/static/js/loaders/rhino3dm/"),n.parse(t,(e=>{gt(e,this.callbacks)}));break}case"3ds":{const{TDSLoader:t}=await s.e(24).then(s.bind(s,5024)),n=new t(i),o=n.parse(e.content);console.log(o,"object in 3ds"),gt(o,this.callbacks);break}case"3mf":{const{ThreeMFLoader:t}=await s.e(501).then(s.bind(s,4501)),i=new t,n=i.parse(e.content);gt(n,this.callbacks);break}case"amf":{const{AMFLoader:t}=await s.e(574).then(s.bind(s,2574)),i=new t,n=i.parse(e.content);gt(n,this.callbacks);break}case"dae":{const t=nt(e.content);console.log(t,"contents in dae");const{ColladaLoader:n}=await s.e(192).then(s.bind(s,6192)),o=new n(i),a=o.parse(t);a.scene.name=e.name,gt(a.scene,this.callbacks);break}case"drc":{const t=e.content,{DRACOLoader:i}=await s.e(511).then(s.bind(s,7511)),n=new i;n.setDecoderPath("/static/js/loaders/draco/"),n.decodeDracoFile(t,(t=>{let s;if(null!==t.index){const i=new U.Wid;s=new U.Kj0(t,i),s.name=e.name}else{const i=new U.UY4({size:.01});i.vertexColors=t.hasAttribute("color"),s=new U.woe(t,i),s.name=e.name}n.dispose(),gt(s,this.callbacks)}));break}case"glb":{const t=e.content,{DRACOLoader:i}=await s.e(511).then(s.bind(s,7511)),{GLTFLoader:n}=await s.e(103).then(s.bind(s,3103)),o=new i;o.setDecoderPath("/static/js/loaders/draco/");const a=new n;a.setDRACOLoader(o),a.parse(t,"",(t=>{const s=t.scene;s.name=e.name,s.animations.push(...t.animations),gt(s,this.callbacks)}),(e=>{this.callbacks.onLoadError(e)}));break}case"gltf":{const t=e.content;let n;if(mt(t))alert("Import of glTF asset not possible. Only versions >= 2.0 are supported. Please try to upgrade the file to glTF 2.0 using glTF-Pipeline.");else{const{DRACOLoader:e}=await s.e(511).then(s.bind(s,7511)),{GLTFLoader:t}=await s.e(103).then(s.bind(s,3103)),o=new e;o.setDecoderPath("/js/loaders/gltf/"),n=new t(i),n.setDRACOLoader(o)}n.parse(t,"",(t=>{const s=t.scene;s.name=e.name,s.animations.push(...t.animations),gt(s,this.callbacks)}));break}case"js":case"json":{let t,s=nt(e.content);if(-1!==s.indexOf("postMessage")){const e=new Blob([s],{type:"text/javascript"});console.log(e,"blob-jsjson");const t=URL.createObjectURL(e);console.log(t,"url-jsjson");const i=new Worker(t);return i.onmessage=function(e){e.data.metadata={version:2},ft(e.data,ht.callbacks)},void i.postMessage(Date.now())}try{t=JSON.parse(s)}catch(a){return void alert(a)}ft(t,ht.callbacks);break}case"ifc":{const{IFCLoader:t}=await s.e(273).then(s.bind(s,2273));let i=new t;i.ifcManager.setWasmPath("/loaders/ifc/");const n=await i.parse(e.content);console.log(n,"model"),n.mesh.name=e.name,gt(n,this.callbacks);break}case"kmz":{const{KMZLoader:t}=await Promise.all([s.e(192),s.e(302)]).then(s.bind(s,5302)),i=new t,n=i.parse(e.content);n.scene.name=e.name,gt(n.scene,this.callbacks);break}case"ldr":case"mpd":{let t=nt(e.content);const{LDrawLoader:i}=await s.e(471).then(s.bind(s,471)),n=new i;n.parse(t,(function(t){t.name=e.name,t.rotation.x=Math.PI,gt(t,ht.callbacks)}));break}case"md2":{const{MD2Loader:t}=await s.e(723).then(s.bind(s,6723)),i=(new t).parse(e.content),n=new U.Wid,o=new U.Kj0(i,n);o.mixer=new U.Xcj(o),o.name=e.name,o.animations.push(...i.animations),gt(o,ht.callbacks);break}case"pcd":{const t=e.content,{PCDLoader:i}=await s.e(797).then(s.bind(s,4797)),n=(new i).parse(t);n.name=e.name,gt(n,ht.callbacks);break}case"ply":{const t=e.content,{PLYLoader:i}=await s.e(666).then(s.bind(s,6666)),n=(new i).parse(t);let o;if(null!==n.index){const t=new U.Wid({color:22015,flatShading:!0});o=new U.Kj0(n,t),o.name=e.name}else{const t=new U.UY4({size:.01});t.vertexColors=n.hasAttribute("color"),o=new U.woe(n,t),o.name=e.name}gt(o,ht.callbacks);break}case"stl":o.addEventListener("load",(async function(t){const i=t.target.result,{STLLoader:n}=await s.e(298).then(s.bind(s,298)),o=(new n).parse(i),a=new U.Wid,r=new U.Kj0(o,a);r.name=e.name,gt(r,ht.callbacks)}),!1),void 0!==o.readAsBinaryString?o.readAsBinaryString(e.data):o.readAsArrayBuffer(e.data);break;case"svg":{const t=nt(e.content),{SVGLoader:i}=await s.e(190).then(s.bind(s,190)),n=new i,o=n.parse(t).paths,a=new U.ZAu;a.scale.multiplyScalar(.1),a.scale.y*=-1;for(let e=0;e<o.length;e++){const t=o[e],s=new U.vBJ({color:t.color,depthWrite:!1}),n=i.createShapes(t);for(let e=0;e<n.length;e++){const t=n[e],i=new U.oa8(t),o=new U.Kj0(i,s);a.add(o)}}gt(a,ht.callbacks);break}case"usdz":break;case"vox":break;case"vtk":case"vtp":break;case"wrl":break;case"xyz":break;case"zip":break}}catch(a){console.error("THREE.WebGLState:",a),this.callbacks.onLoadError(a)}}}function wt(e,t){async function s(e,t){let i=e.createReader();return new Promise(((e,n)=>{i.readEntries((async i=>{for(let e of i)e.isFile?t.push(e):e.isDirectory&&await s(e,t);e()}),(e=>{n(e)}))}))}async function i(e,t){let i=[];for(let o of e)o.isFile?i.push(o):o.isDirectory&&await s(o,i);let n=await Promise.all(i.map((e=>new Promise(((t,s)=>{e.file((e=>{t(e)}),(e=>{s(e)}))})))));t(n)}console.log(e,"dataTransfe-GetFilesFromDataTransfer"),console.log(t,"onReady");let n=null;if(DataTransferItem&&(DataTransferItem.prototype.getAsEntry?n=DataTransferItem.prototype.getAsEntry:DataTransferItem.prototype.webkitGetAsEntry&&(n=DataTransferItem.prototype.webkitGetAsEntry)),null!==n){let s=[];for(let t of e.items){let e=n.call(t);null!==e&&s.push(e)}i(s,(e=>{t(e)}))}else t(e.files)}class bt{constructor(e,t,s){this.r=e,this.g=t,this.b=s}Set(e,t,s){this.r=e,this.g=t,this.b=s}Clone(){return new bt(this.r,this.g,this.b)}}class vt{constructor(e){console.log(e,"websitein showedge"),this.viewer=e.viewer,this.mainObject=e.model,console.log(this.mainObject," this.mainObject in ShowEdge"),this.mainEdgeObject=null,this.edgeSettings={showEdges:!1,edgeColor:new bt(0,0,0),edgeThreshold:1}}UpdateWorldMatrix(){null!==this.mainObject&&this.mainObject.updateWorldMatrix(!0,!0)}EnumerateMeshes(e){console.log(this.mainObject,"this.mainObject in modeltool"),null!==this.mainObject&&this.mainObject.traverse((t=>{t.isMesh&&e(t)}))}EnumerateEdges(e){null!==this.mainEdgeObject&&this.mainEdgeObject.traverse((t=>{t.isLineSegments&&e(t)}))}SetEdgeSettings(e,t,s,i){this.mainObject=e,console.log(t,s,i,"show, color, threshold");let n=!1;!t||this.edgeSettings.showEdges&&this.edgeSettings.edgeThreshold===i||(n=!0),this.edgeSettings.showEdges=t,this.edgeSettings.edgeThreshold=i,this.edgeSettings.edgeColor=s,console.log(this.mainObject,"this.mainObject222222"),console.log(this.edgeSettings,"this.edgeSettings"),null!==this.mainObject&&(this.edgeSettings.showEdges?(this.ClearMainEdgeObject(),this.GenerateMainEdgeObject()):this.ClearMainEdgeObject())}GenerateMainEdgeObject(){console.log(this.mainObject,"this.mainObject1111");let e=ne(this.edgeSettings.edgeColor);console.log(e,"edgeColor"),this.mainEdgeObject=new U.Tme,this.UpdateWorldMatrix(),this.EnumerateMeshes((e=>{let t=new U.TOt(e.geometry,this.edgeSettings.edgeThreshold),s=new U.ejS(t,new U.nls({color:"blue"}));s.applyMatrix4(e.matrixWorld),s.userData=e.userData,s.visible=e.visible,this.mainEdgeObject.add(s)})),console.log(this.mainEdgeObject,"this.mainEdgeObject2"),console.log(this.viewer,"this.viewer"),this.viewer.scene.add(this.mainEdgeObject),console.log(this.mainEdgeObject,"this.mainEdgeObject3")}ClearMainEdgeObject(){console.log(this.mainEdgeObject,"this.mainEdgeObject1"),null!==this.mainEdgeObject&&(this.EnumerateMeshes((e=>{})),this.EnumerateEdges((e=>{e.geometry.dispose()})),this.viewer.scene.remove(this.mainEdgeObject),this.mainEdgeObject=null)}}class Mt{constructor(e){this.viewer=e.viewer,this.model=null,this.cloneModel=null,this.dragControls=null,this.status=""}duxian(){}setWireFrame(e,t){console.log(e,"val in setWireFrame "),t.traverse((t=>{if(t instanceof U.Kj0)if(e)if(t.material.length>1)for(var s=0;s<t.material.length;s++)t.material[s].wireframe=!0;else t.material.wireframe=!0;else if(t.material.length>1)for(s=0;s<t.material.length;s++)t.material[s].wireframe=!1;else t.material.wireframe=!1}))}dragMesh(e){this.dragControls?(this.dragControls.removeEventListener("dragstart",this.dragstart.bind(this)),this.dragControls.removeEventListener("dragend",this.dragend.bind(this)),this.dragControls.deactivate(),this.dragControls=null,this.viewer.scene.remove(this.dragControls),this.dragControls=new ue.S([this.cloneModel],this.viewer.camera,this.viewer.renderer.domElement),this.dragControls.addEventListener("dragstart",this.dragstart.bind(this)),this.dragControls.addEventListener("dragend",this.dragend.bind(this))):(this.model=e,this.cloneModel=e.clone(),this.dragControls=new ue.S([this.model],this.viewer.camera,this.viewer.renderer.domElement),this.dragControls.activate(),this.dragControls.addEventListener("dragstart",this.dragstart.bind(this)),this.dragControls.addEventListener("dragend",this.dragend.bind(this)))}dragstart(){this.viewer.controls.enabled=!1}dragend(){this.viewer.controls.enabled=!0}resetDragMesh(){this.status="复位",this.viewer.scene.remove(this.model),this.viewer.scene.add(this.cloneModel),this.model=this.cloneModel}dragMeshs(e,t){e?(this.dragMesh(t),this.dragControls.addEventListener("dragstart",this.dragstart.bind(this)),this.dragControls.addEventListener("dragend",this.dragend.bind(this))):(this.dragControls.removeEventListener("dragstart",this.dragstart.bind(this)),this.dragControls.removeEventListener("dragend",this.dragend.bind(this)),this.viewer.scene.remove(this.model),this.viewer.scene.add(this.cloneModel),this.dragMesh(this.cloneModel))}}const Lt={Light:1,Dark:2};class yt{constructor(){this.showEdges=!0,this.edgeColor=new bt(25,25,112),this.edgeThreshold=0,this.themeId=Lt.Light,this.environmentMapName="fishermans_bastion",this.backgroundIsEnvMap=!0,this.sceneColor=12571109,this.angle=50,this.nearest=1,this.farthest=3e4}}class jt{constructor(){this.css={"--ov_toolbar_background_color":{}};let e=document.querySelector(":root");console.log(e,"root in theme");let t=window.getComputedStyle(e);for(let s in this.css)Object.prototype.hasOwnProperty.call(this.css,s)&&(console.log(s,"property"),this.css[s].light=t.getPropertyValue(s),this.css[s].dark=t.getPropertyValue(s+"_dark"))}SwitchTheme(e){let t=null;if(e===Lt.Light)t="light";else{if(e!==Lt.Dark)return;t="dark"}let s=document.querySelector(":root");for(let i in this.css)if(Object.prototype.hasOwnProperty.call(this.css,i)){let e=this.css[i][t];void 0!==e&&(s.style.setProperty(i,e),console.log(i,"SwitchTheme-property"),console.log(e,"SwitchTheme-value"))}}}const Ct=1e-4,kt=57.29577951308232;function Ft(e,t,s){return Math.abs(t-e)<s}function Ot(e){let t=new U.yGw;e.object.updateWorldMatrix(!0,!1),t.extractRotation(e.object.matrixWorld);let s=e.face.normal.clone();return s.applyMatrix4(t),s}function St(e,t){const s=e.GetIntersection(),i=t.GetIntersection();let n={pointsDistance:null,parallelFacesDistance:null,facesAngle:null};const o=Ot(s),a=Ot(i);if(n.pointsDistance=s.point.distanceTo(i.point),n.facesAngle=o.angleTo(a),Ft(n.facesAngle,0,Ct)||Ft(n.facesAngle,Math.PI,Ct)){let e=(new U.JOQ).setFromNormalAndCoplanarPoint(o,s.point);n.parallelFacesDistance=Math.abs(e.distanceToPoint(i.point))}return n}function xt(){return new U.nls({color:"red",depthTest:!1})}function Pt(e,t){let s=(new U.u9r).setFromPoints(e);return new U.x12(s,t)}class Et{constructor(e,t){this.intersection=null,this.markerObject=new U.Tme;let s=xt(),i=new U.Ny0(0,0,t,t,0,2*Math.PI,!1,0);this.markerObject.add(Pt(i.getPoints(50),s)),this.markerObject.add(Pt([new U.Pa4(-t,0,0),new U.Pa4(t,0,0)],s)),this.markerObject.add(Pt([new U.Pa4(0,-t,0),new U.Pa4(0,t,0)],s)),this.UpdatePosition(e)}UpdatePosition(e){this.intersection=e;let t=Ot(this.intersection);this.markerObject.updateMatrixWorld(!0),this.markerObject.position.set(0,0,0),this.markerObject.lookAt(t),this.markerObject.position.set(this.intersection.point.x,this.intersection.point.y,this.intersection.point.z)}GetObject(){return this.markerObject}GetIntersection(){return this.intersection}Show(e){this.markerObject.visible=e}}class It{constructor(e,t){console.log(e,"viewer in MeasureTool"),this.viewer=e,this.settings=t,this.isActive=y.state.measure.isActive,this.markers=[],this.tempMarker=null,this.panel=null,this.info=""}IsActive(){return y.state.measure.isActive}SetActive(e){y.commit("measure/IsActive",e),y.state.measure.isActive?this.UpdatePanel():this.ClearMarkers()}Click(e){let t=this.viewer.GetMeshIntersectionUnderMouse(e);if(console.log(t,"intersection in Click"),null===t)return this.ClearMarkers(),void this.UpdatePanel();2===this.markers.length&&this.ClearMarkers(),this.AddMarker(t),this.UpdatePanel()}MouseMove(e){let t=this.viewer.GetMeshIntersectionUnderMouse(e);null!==t?(null===this.tempMarker&&(this.tempMarker=this.GenerateMarker(t)),this.tempMarker.UpdatePosition(t),this.tempMarker.Show(!0)):null!==this.tempMarker&&this.tempMarker.Show(!1)}UpdatePanel(){if(0===this.markers.length)y.commit("measure/AddInfo","选择一个点"),y.commit("measure/Reset"),y.commit("measure/ShowMeasureInfo",!1);else if(1===this.markers.length)y.commit("measure/AddInfo","选择另一个点"),y.commit("measure/Reset"),y.commit("measure/ShowMeasureInfo",!1);else{y.commit("measure/ShowMeasureInfo",!0);let e=St(this.markers[0],this.markers[1]);if(null!==e.pointsDistance&&(this.info="measure_distance",y.commit("measure/AddPointsDistance",e.pointsDistance.toFixed(3)),console.log(e.pointsDistance.toFixed(3),"measure_distance")),null!==e.parallelFacesDistance&&(this.info="measure_distance_parallel",y.commit("measure/AddDistanceParallel",e.parallelFacesDistance.toFixed(3)),console.log(e.parallelFacesDistance.toFixed(3),"measure_distance_parallel")),null!==e.facesAngle){this.info="measure_angle";let t=e.facesAngle*kt;y.commit("measure/AddAngel",t.toFixed(1)+"°"),console.log(t.toFixed(1)+"°","measure_angle")}}}Resize(){if(!this.isActive)return;let e=this.viewer.GetCanvas(),t=e.getBoundingClientRect(),s=this.panel.getBoundingClientRect(),i=t.right-t.left,n=s.right-s.left;this.panel.style.left=t.left+(i-n)/2+"px",this.panel.style.top=t.top+10+"px"}AddMarker(e){let t=this.GenerateMarker(e);if(console.log(t,"marker in addMarker"),this.markers.push(t),2===this.markers.length){let e=xt(),t=this.markers[0].GetIntersection().point,s=this.markers[1].GetIntersection().point;this.viewer.AddExtraObject(Pt([t,s],e))}}GenerateMarker(e){console.log(e,"intersection in GenerateMarker");let t=this.viewer.GetBoundingSphere((e=>!0)),s=t.radius/20,i=new Et(e,s);return console.log(i,"marker in GenerateMarker"),this.viewer.AddExtraObject(i.GetObject()),i}ClearMarkers(){this.viewer.ClearExtra(),this.markers=[],this.tempMarker=null}}var Dt=s(6618);let Rt,At;function Gt(){document.body.appendChild(Rt)}function Ut(){document.body.removeChild(Rt)}function Tt(e){}function _t(e){e.lengthComputable&&(Tt(e.loaded/e.total),console.log(Math.round(e.loaded/e.total*100,2)+"% downloaded"))}function Bt(e){const t="Error loading model";Rt.innerText=t,console.log(t),console.error(e)}const zt={Undefined:0,Intro:1,Model:2,Loading:3};let Vt=!0;class Ht extends pe{constructor(e){super(),this.signals={},this.parameters=e,this.settings=new yt,this.viewer=new ye(this.parameters.viewerDiv,this.parameters.view2,this.settings,this);let t=A(this.parameters.viewerDiv,"canvas");console.log(t,"canvas11111"),this.viewer.Init(t),this.uiState=zt.Undefined,this.hashHandler=new Fe,this.modelLoaderUI=new Ye,this.loader=new pt(this,this.viewer),this.themeHandler=new jt,this.measureTool=new It(this.viewer,this.settings),this.model=null,this.cloneModel=null,this.showEdge=new vt(this),this.wireFrame=new Mt(this),Rt=document.createElement("div"),Rt.style.position="absolute",Rt.style.top="0",Rt.style.opacity="0.8",Rt.style.width="100%",Rt.style.height="100%",Rt.style.display="flex",Rt.style.alignItems="center",Rt.style.justifyContent="center",Rt.style.background="#616161",At=document.createElement("img"),At.src="images/loading.gif",At.style.width="200px",At.style.height="200px",Rt.appendChild(At)}start(e){this.dispatchEvent({type:"start",message:"blas val change"+e})}Load(e){y.dispatch("app/showLoading",!0),Tt(0),Gt();const t=new Dt.FBXLoader,s="static/models/fbx/jiaju/";t.load(`${s}damo.fbx`,(t=>{console.log(t,"object in Load");const s=t;this.model=t,this.cloneModel=t,this.viewer.SetMainObject(s),me(s),this.FitModelToWindow(!0),this.UpdateEdgeDisplay(!0,e),y.dispatch("app/showLoading",!1),Ut()}),_t,Bt),this.UpdateEnvironmentMap(),this.viewer.SetMouseClickHandler(this.OnModelClicked.bind(this)),this.viewer.SetMouseMoveHandler(this.OnModelMouseMoved.bind(this)),this.InitDragAndDrop(),this.Resize(),window.addEventListener("resize",(()=>{this.Resize()})),this.hashHandler.SetEventListener(this.OnHashChange.bind(this)),this.OnHashChange()}InitDragAndDrop(){window.addEventListener("dragstart",(e=>{e.preventDefault()}),!1),window.addEventListener("dragover",(e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),!1),window.addEventListener("drop",(e=>{if(e.stopPropagation(),e.preventDefault(),Vt){if("text/plain"===event.dataTransfer.types[0])return;event.dataTransfer.items&&this.loader.loadItemList(event.dataTransfer.items,{onLoadStart:()=>{this.ClearModel(),y.dispatch("app/showLoading",!0),console.log("Loading Model start"),Tt(0),Gt()},onFileListProgress:(e,t)=>{console.log(e,t," onFileListProgress")},onFileLoadProgress:(e,t)=>{console.log(e,t," onFileLoadProgress"),Tt(e/t),console.log(Math.round(e/t*100,2)+"% downloaded")},onSelectMainFile:()=>{},onImportStart:()=>{},onVisualizationStart:()=>{},onModelFinished:e=>{this.OnModelLoaded(e),y.dispatch("app/showLoading",!1),Ut()},onTextureLoaded:()=>{},onLoadError:e=>{Rt.innerText=e}})}else wt(e.dataTransfer,(e=>{e.length>0&&(Ae("model_load_started","drop"),this.LoadModelFromFileList(e))}))}),!1)}OnHashChange(){if(this.hashHandler.HasHash()){let e=this.hashHandler.GetModelFilesFromHash();if(null===e)return;Ae("model_load_started","hash");let t={};this.LoadModelFromUrlList(e,t)}}LoadModelFromUrlList(e,t){if(console.log(e,"urls in  LoadModelFromUrlList"),Vt)this.loader.loadItemUrls(e,{onLoadStart:()=>{this.ClearModel(),y.dispatch("app/showLoading",!0),Tt(0),Gt(),console.log("Loading Model start")},onFileListProgress:(e,t)=>{console.log(e,t," onFileListProgress")},onFileLoadProgress:(e,t)=>{console.log(e,t," onFileLoadProgress"),Tt(e/t),console.log(Math.round(e/t*100,2)+"% downloaded")},onSelectMainFile:()=>{},onImportStart:()=>{},onVisualizationStart:()=>{},onModelFinished:e=>{this.OnModelLoaded(e),Ut(),y.dispatch("app/showLoading",!1)},onTextureLoaded:()=>{},onLoadError:e=>{const t="Error loading model";Rt.innerText=t,console.log(t),console.error(e)}});else{let s=Ne(e);console.log(s,"inputFiles in hash"),this.LoadModelFromInputFiles(s,t),this.ClearHashIfNotOnlyUrlList()}}LoadModelFromFileList(e){let t={},s=qe(e);console.log(s,"inputFiles in drag"),this.LoadModelFromInputFiles(s,t)}LoadModelFromInputFiles(e,t){this.modelLoaderUI.LoadModel(e,t,{onStart:()=>{},onFinish:()=>{},onRender:()=>{},onError:()=>{}})}ClearHashIfNotOnlyUrlList(){}SetUIState(e){this.uiState!==e&&(this.uiState=e,this.uiState===zt.Intro||(this.uiState===zt.Model?P(this.parameters.mainDiv,!0):(this.uiState,zt.Loading)),this.Resize())}OnModelClicked(e,t){this.viewer.outline.Click(t),console.log(e,t,"mouseCoordinates in OnModelClicked"),1===e&&this.measureTool.IsActive()&&this.measureTool.Click(t)}OnModelMouseMoved(e){this.measureTool.IsActive()&&this.measureTool.MouseMove(e)}OnModelLoaded(e){console.log(e,"threeObject in OnModelLoaded"),this.model=e,this.cloneModel=e,this.viewer.SetMainObject(e),me(e),this.FitModelToWindow(!0),this.UpdateEdgeDisplay(!0)}FitModelToWindow(e){let t=!e,s=this.viewer.GetBoundingSphere((e=>(console.log(e,"meshUserData"),!0)));console.log(s,"boundingSphere"),e&&this.viewer.AdjustClippingPlanesToSphere(s),this.viewer.FitSphereToWindow(s,t)}ClearModel(){this.model=null,this.viewer.Clear(),console.log(this.showEdge.mainEdgeObject,"in ClearModel")}OnSmallWidthChanged(){}UpdatePanelsVisibility(){let e=!1,t=!1;this.navigator.ShowPanels(e),this.sidebar.ShowPanels(t)}Resize(){this.viewer.Resize()}SwitchTheme(e,t){console.log(e,"newThemeId in SwitchTheme"),this.settings.themeId=e,this.themeHandler.SwitchTheme(this.settings.themeId)}UpdateEdgeDisplay(e,t=40){this.settings.showEdges=e,this.settings.edgeThreshold=e?t:0,this.showEdge.SetEdgeSettings(this.model,this.settings.showEdges,this.settings.edgeColor,this.settings.edgeThreshold)}onEnvironmentMapChange(){this.UpdateEnvironmentMap()}UpdateEnvironmentMap(){let e="static/envmaps/"+this.settings.environmentMapName+"/",t=[e+"posx.jpg",e+"negx.jpg",e+"posy.jpg",e+"negy.jpg",e+"posz.jpg",e+"negz.jpg"];this.viewer.SetEnvironmentMapSettings(t,this.settings.backgroundIsEnvMap)}Blast(e,t){fe(e,t)}Measure(e){this.measureTool.SetActive(e)}}function Wt(e){Re(e)}function Nt(e,t){ut(e);const s=new Ht({viewerDiv:document.getElementById("main_viewer")});return s.Load(t),s}function qt(e){window.innerWidth===screen.width&&window.innerHeight===screen.height||window.fullScreen?Xt():Kt(e)}function Kt(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():$t()}function Xt(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():this.noFullscreenSupport()}function $t(){alert("Your browser does not support the Fullscreen API.")}i["default"].use(d.ZP);new d.ZP.Store({state:{},getters:{},mutations:{},actions:{},modules:{}});var Zt={name:"ModelEngine",props:{width:{type:String,default:"500"},height:{type:String,default:"500"}},data(){return{website:null,wanggeValue:!1,rotationValue:!1,showSlider:!0,slideValue:0,btns:["默认","深色","浅色"],envMaps:[{name:"清空",url:"static/envmaps/noimage.jpg",backgroundIsEnvMap:!1},{name:"teide",url:"static/envmaps/teide/posx.jpg",backgroundIsEnvMap:!0}],tabIndex:0,model:null,dragMeshBtn:!1,duxianBtn:!1,toumingBtn:!1,fullScreenBtn:!0,celiangBtn:!1,isActive:!1}},computed:{...(0,d.rn)({showLoading:e=>e.app.showLoading,ifduxian:e=>e.app.duxian,info:e=>e.measure.info,pointsDistance:e=>e.measure.pointsDistance,parallelFacesDistance:e=>e.measure.parallelFacesDistance,facesAngle:e=>e.measure.facesAngle,MeasureisActive:e=>e.measure.isActive,showMeasureIInfo:e=>e.measure.showMeasureIInfo}),blastVal:{get(){return this.$store.state.app.blastVal},set(e){this.$store.state.app.blastVal=e}},edgeVal:{get(){return this.$store.state.app.edgeVal},set(e){this.$store.commit("app/CHANGE_EDGE_VAL",e)}},...(0,d.Se)(["getBlastVal"])},watch:{blastVal:{handler(e,t){console.log(e,t,"in watch")},deep:!0,immediate:!0}},methods:{async nativePick(e){const t=e?e.target.value:null;if(t)console.log("获得颜色: "+t);else{const t=new window.EyeDropper;console.log("按Esc可退出");try{const e=await t.open();console.log("获得颜色: "+e.sRGBHex)}catch(e){console.log("用户取消了取色")}}},switchleft(){this.isActive=!this.isActive},changeWange(e){this.wanggeValue=e,this.website.wireFrame.setWireFrame(this.wanggeValue,this.website.model)},backgroundTabClick(e){this.tabIndex=e,this.website.viewer.outline.SetbackgroundColor(e)},SetEnvironment(e,t){this.website.viewer.outline.SetEnvironment(e,t)},blastChange(e){console.log(this,"this in blastChange"),this.website.viewer.outline.Blast(this.website.model,e)},edgeChange(e){this.website.viewer.outline.Edge(this.website.model,e)},autoRotation(e){this.rotationValue=e,this.website.viewer.outline.rotation(this.rotationValue)},duxian(){this.website.viewer.outline.duxian(this.website.model,!this.$store.state.app.duxian)},dragMesh(){this.dragMeshBtn=!this.dragMeshBtn,this.dragMeshBtn,this.website.viewer.outline.dragMesh(this.website.model,this.dragMeshBtn)},resetDragMesh(){this.dragMeshBtn=!1,this.website.wireFrame.resetDragMesh(this.website.model)},dragMeshs(){this.dragMeshBtn=!this.dragMeshBtn,this.website.wireFrame.dragMeshs(this.dragMeshBtn,this.website.model)},reset(){this.website.viewer.outline.reset(this.website.model)},touming(){this.toumingBtn=!this.toumingBtn,this.website.viewer.outline.touming(this.website.model,this.toumingBtn)},touming2(){this.website.viewer.outline.touming(this.website.model,!0)},fullScreen(e){this.fullScreenBtn=!this.fullScreenBtn,e.preventDefault();let t=document.getElementById("model-wrapper");qt(t)},yincang(){this.website.viewer.outline.yincang(this.website.model,!0)},celiang(){this.website.Measure(!this.$store.state.MeasureisActive)},handleMessage(e){console.log(e,"event in handleMessage")}},mounted(){console.log(this.$store,"this.$store"),Wt(((e,t,s)=>{console.log({eventName:e,eventLabel:t,eventParams:s})})),this.website=Nt("./libs",this.$store.state.app.edgeVal),window.addEventListener("message",this.handleMessage)}},Yt=Zt,Jt=(0,l.Z)(Yt,k,F,!1,null,"2c739dcc",null),Qt=Jt.exports;const es=[Qt],ts=function(e){es.forEach((t=>{e.component(t.name,t)}))};"undefined"!==typeof window&&window.Vue&&ts(window.Vue);var ss={install:ts};i["default"].config.productionTip=!1,i["default"].use(ss),i["default"].use(C()),new i["default"]({store:y,render:e=>e(h)}).$mount("#app")}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=e,function(){var e=[];s.O=function(t,i,n,o){if(!i){var a=1/0;for(h=0;h<e.length;h++){i=e[h][0],n=e[h][1],o=e[h][2];for(var r=!0,l=0;l<i.length;l++)(!1&o||a>=o)&&Object.keys(s.O).every((function(e){return s.O[e](i[l])}))?i.splice(l--,1):(r=!1,o<a&&(a=o));if(r){e.splice(h--,1);var c=n();void 0!==c&&(t=c)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[i,n,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,i){return s.f[i](e,t),t}),[]))}}(),function(){s.u=function(e){return"static/js/"+e+"."+{24:"50bf17b6",103:"ff82cf74",189:"1bfb1d2c",190:"b24886dc",192:"cd6d2f40",273:"c27f0297",298:"791b48f3",302:"dce95d79",322:"d7290b43",471:"7da8d813",501:"a63e45cf",503:"7986e4bd",511:"c86681ed",574:"ca76f542",666:"6e588788",723:"b8e1c6f8",797:"e06bb427"}[e]+".js"}}(),function(){s.miniCssF=function(e){}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="three-model-viewer:";s.l=function(i,n,o,a){if(e[i])e[i].push(n);else{var r,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==t+o){r=d;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,s.nc&&r.setAttribute("nonce",s.nc),r.setAttribute("data-webpack",t+o),r.src=i),e[i]=[n];var u=function(t,s){r.onerror=r.onload=null,clearTimeout(g);var n=e[i];if(delete e[i],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach((function(e){return e(s)})),t)return t(s)},g=setTimeout(u.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=u.bind(null,r.onerror),r.onload=u.bind(null,r.onload),l&&document.head.appendChild(r)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){s.p=""}(),function(){var e={826:0};s.f.j=function(t,i){var n=s.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var o=new Promise((function(s,i){n=e[t]=[s,i]}));i.push(n[2]=o);var a=s.p+s.u(t),r=new Error,l=function(i){if(s.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var o=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;r.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",r.name="ChunkLoadError",r.type=o,r.request=a,n[1](r)}};s.l(a,l,"chunk-"+t,t)}},s.O.j=function(t){return 0===e[t]};var t=function(t,i){var n,o,a=i[0],r=i[1],l=i[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(l)var h=l(s)}for(t&&t(i);c<a.length;c++)o=a[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(h)},i=self["webpackChunkthree_model_viewer"]=self["webpackChunkthree_model_viewer"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[998],(function(){return s(1975)}));i=s.O(i)})();
//# sourceMappingURL=index.a2f3416f.js.map