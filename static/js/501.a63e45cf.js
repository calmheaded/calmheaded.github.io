"use strict";(self["webpackChunkthree_model_viewer"]=self["webpackChunkthree_model_viewer"]||[]).push([[501],{4501:function(t,e,r){r.r(e),r.d(e,{ThreeMFLoader:function(){return s}});var n=r(277),o=r(5683);class s extends n.aNw{constructor(t){super(t),this.availableExtensions=[]}load(t,e,r,o){const s=this,l=new n.hH6(s.manager);l.setPath(s.path),l.setResponseType("arraybuffer"),l.setRequestHeader(s.requestHeader),l.setWithCredentials(s.withCredentials),l.load(t,(function(r){try{e(s.parse(r))}catch(n){o?o(n):console.error(n),s.manager.itemError(t)}}),r,o)}parse(t){const e=this,r=new n.dpR(this.manager);function s(t){let e,r,s=null,i=null;const u=[],c=[];let a;const p={},d={},h={};try{s=o.GZ(new Uint8Array(t))}catch(m){if(m instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}for(i in s)i.match(/\_rels\/.rels$/)?e=i:i.match(/3D\/_rels\/.*\.model\.rels$/)?r=i:i.match(/^3D\/.*\.model$/)?u.push(i):i.match(/^3D\/Textures?\/.*/)&&c.push(i);const g=s[e],b=n.Zp0.decodeText(g),f=l(b);if(r){const t=s[r],e=n.Zp0.decodeText(t);a=l(e)}for(let o=0;o<u.length;o++){const t=u[o],e=s[t],r=n.Zp0.decodeText(e),l=(new DOMParser).parseFromString(r,"application/xml");"model"!==l.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",t);const i=l.querySelector("model"),c={};for(let n=0;n<i.attributes.length;n++){const t=i.attributes[n];t.name.match(/^xmlns:(.+)$/)&&(c[t.value]=RegExp.$1)}const a=w(i);a["xml"]=i,0<Object.keys(c).length&&(a["extensions"]=c),p[t]=a}for(let n=0;n<c.length;n++){const t=c[n];h[t]=s[t].buffer}return{rels:f,modelRels:a,model:p,printTicket:d,texture:h}}function l(t){const e=[],r=(new DOMParser).parseFromString(t,"application/xml"),n=r.querySelectorAll("Relationship");for(let o=0;o<n.length;o++){const t=n[o],r={target:t.getAttribute("Target"),id:t.getAttribute("Id"),type:t.getAttribute("Type")};e.push(r)}return e}function i(t){const e={};for(let r=0;r<t.length;r++){const n=t[r],o=n.getAttribute("name"),s=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"];0<=s.indexOf(o)&&(e[o]=n.textContent)}return e}function u(t){const e={id:t.getAttribute("id"),basematerials:[]},r=t.querySelectorAll("base");for(let n=0;n<r.length;n++){const t=r[n],o=h(t);o.index=n,e.basematerials.push(o)}return e}function c(t){const e={id:t.getAttribute("id"),path:t.getAttribute("path"),contenttype:t.getAttribute("contenttype"),tilestyleu:t.getAttribute("tilestyleu"),tilestylev:t.getAttribute("tilestylev"),filter:t.getAttribute("filter")};return e}function a(t){const e={id:t.getAttribute("id"),texid:t.getAttribute("texid"),displaypropertiesid:t.getAttribute("displaypropertiesid")},r=t.querySelectorAll("tex2coord"),n=[];for(let o=0;o<r.length;o++){const t=r[o],e=t.getAttribute("u"),s=t.getAttribute("v");n.push(parseFloat(e),parseFloat(s))}return e["uvs"]=new Float32Array(n),e}function p(t){const e={id:t.getAttribute("id"),displaypropertiesid:t.getAttribute("displaypropertiesid")},r=t.querySelectorAll("color"),o=[],s=new n.Ilk;for(let n=0;n<r.length;n++){const t=r[n],e=t.getAttribute("color");s.setStyle(e.substring(0,7)),s.convertSRGBToLinear(),o.push(s.r,s.g,s.b)}return e["colors"]=new Float32Array(o),e}function d(t){const e={id:t.getAttribute("id")},r=t.querySelectorAll("pbmetallic"),n=[];for(let o=0;o<r.length;o++){const t=r[o];n.push({name:t.getAttribute("name"),metallicness:parseFloat(t.getAttribute("metallicness")),roughness:parseFloat(t.getAttribute("roughness"))})}return e.data=n,e}function h(t){const e={};return e["name"]=t.getAttribute("name"),e["displaycolor"]=t.getAttribute("displaycolor"),e["displaypropertiesid"]=t.getAttribute("displaypropertiesid"),e}function g(t){const e={},r=[],n=t.querySelectorAll("vertices vertex");for(let i=0;i<n.length;i++){const t=n[i],e=t.getAttribute("x"),o=t.getAttribute("y"),s=t.getAttribute("z");r.push(parseFloat(e),parseFloat(o),parseFloat(s))}e["vertices"]=new Float32Array(r);const o=[],s=[],l=t.querySelectorAll("triangles triangle");for(let i=0;i<l.length;i++){const t=l[i],e=t.getAttribute("v1"),r=t.getAttribute("v2"),n=t.getAttribute("v3"),u=t.getAttribute("p1"),c=t.getAttribute("p2"),a=t.getAttribute("p3"),p=t.getAttribute("pid"),d={};d["v1"]=parseInt(e,10),d["v2"]=parseInt(r,10),d["v3"]=parseInt(n,10),s.push(d["v1"],d["v2"],d["v3"]),u&&(d["p1"]=parseInt(u,10)),c&&(d["p2"]=parseInt(c,10)),a&&(d["p3"]=parseInt(a,10)),p&&(d["pid"]=p),0<Object.keys(d).length&&o.push(d)}return e["triangleProperties"]=o,e["triangles"]=new Uint32Array(s),e}function b(t){const e=[],r=t.querySelectorAll("component");for(let n=0;n<r.length;n++){const t=r[n],o=f(t);e.push(o)}return e}function f(t){const e={};e["objectId"]=t.getAttribute("objectid");const r=t.getAttribute("transform");return r&&(e["transform"]=m(r)),e}function m(t){const e=[];t.split(" ").forEach((function(t){e.push(parseFloat(t))}));const r=new n.yGw;return r.set(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1),r}function A(t){const e={type:t.getAttribute("type")},r=t.getAttribute("id");r&&(e["id"]=r);const n=t.getAttribute("pid");n&&(e["pid"]=n);const o=t.getAttribute("pindex");o&&(e["pindex"]=o);const s=t.getAttribute("thumbnail");s&&(e["thumbnail"]=s);const l=t.getAttribute("partnumber");l&&(e["partnumber"]=l);const i=t.getAttribute("name");i&&(e["name"]=i);const u=t.querySelector("mesh");u&&(e["mesh"]=g(u));const c=t.querySelector("components");return c&&(e["components"]=b(c)),e}function y(t){const e={basematerials:{}},r=t.querySelectorAll("basematerials");for(let c=0;c<r.length;c++){const t=r[c],n=u(t);e["basematerials"][n["id"]]=n}e["texture2d"]={};const n=t.querySelectorAll("texture2d");for(let u=0;u<n.length;u++){const t=n[u],r=c(t);e["texture2d"][r["id"]]=r}e["colorgroup"]={};const o=t.querySelectorAll("colorgroup");for(let u=0;u<o.length;u++){const t=o[u],r=p(t);e["colorgroup"][r["id"]]=r}e["pbmetallicdisplayproperties"]={};const s=t.querySelectorAll("pbmetallicdisplayproperties");for(let u=0;u<s.length;u++){const t=s[u],r=d(t);e["pbmetallicdisplayproperties"][r["id"]]=r}e["texture2dgroup"]={};const l=t.querySelectorAll("texture2dgroup");for(let u=0;u<l.length;u++){const t=l[u],r=a(t);e["texture2dgroup"][r["id"]]=r}e["object"]={};const i=t.querySelectorAll("object");for(let u=0;u<i.length;u++){const t=i[u],r=A(t);e["object"][r["id"]]=r}return e}function v(t){const e=[],r=t.querySelectorAll("item");for(let n=0;n<r.length;n++){const t=r[n],o={objectId:t.getAttribute("objectid")},s=t.getAttribute("transform");s&&(o["transform"]=m(s)),e.push(o)}return e}function w(t){const e={unit:t.getAttribute("unit")||"millimeter"},r=t.querySelectorAll("metadata");r&&(e["metadata"]=i(r));const n=t.querySelector("resources");n&&(e["resources"]=y(n));const o=t.querySelector("build");return o&&(e["build"]=v(o)),e}function x(t,e,o,s){const l=t.texid,i=o.resources.texture2d,u=i[l];if(u){const t=s[u.path],e=u.contenttype,o=new Blob([t],{type:e}),l=URL.createObjectURL(o),i=r.load(l,(function(){URL.revokeObjectURL(l)}));switch(i.encoding=n.knz,u.tilestyleu){case"wrap":i.wrapS=n.rpg;break;case"mirror":i.wrapS=n.OoA;break;case"none":case"clamp":i.wrapS=n.uWy;break;default:i.wrapS=n.rpg}switch(u.tilestylev){case"wrap":i.wrapT=n.rpg;break;case"mirror":i.wrapT=n.OoA;break;case"none":case"clamp":i.wrapT=n.uWy;break;default:i.wrapT=n.rpg}switch(u.filter){case"auto":i.magFilter=n.wem,i.minFilter=n.D1R;break;case"linear":i.magFilter=n.wem,i.minFilter=n.wem;break;case"nearest":i.magFilter=n.TyD,i.minFilter=n.TyD;break;default:i.magFilter=n.wem,i.minFilter=n.D1R}return i}return null}function S(t,e,r,o,s,l,i){const u=i.pindex,c={};for(let n=0,d=e.length;n<d;n++){const t=e[n],r=void 0!==t.p1?t.p1:u;void 0===c[r]&&(c[r]=[]),c[r].push(t)}const a=Object.keys(c),p=[];for(let d=0,h=a.length;d<h;d++){const e=a[d],u=c[e],h=t.basematerials[e],g=O(h,o,s,l,i,D),b=new n.u9r,f=[],m=r.vertices;for(let t=0,r=u.length;t<r;t++){const e=u[t];f.push(m[3*e.v1+0]),f.push(m[3*e.v1+1]),f.push(m[3*e.v1+2]),f.push(m[3*e.v2+0]),f.push(m[3*e.v2+1]),f.push(m[3*e.v2+2]),f.push(m[3*e.v3+0]),f.push(m[3*e.v3+1]),f.push(m[3*e.v3+2])}b.setAttribute("position",new n.a$l(f,3));const A=new n.Kj0(b,g);p.push(A)}return p}function k(t,e,r,o,s,l,i){const u=new n.u9r,c=[],a=[],p=r.vertices,d=t.uvs;for(let n=0,f=e.length;n<f;n++){const t=e[n];c.push(p[3*t.v1+0]),c.push(p[3*t.v1+1]),c.push(p[3*t.v1+2]),c.push(p[3*t.v2+0]),c.push(p[3*t.v2+1]),c.push(p[3*t.v2+2]),c.push(p[3*t.v3+0]),c.push(p[3*t.v3+1]),c.push(p[3*t.v3+2]),a.push(d[2*t.p1+0]),a.push(d[2*t.p1+1]),a.push(d[2*t.p2+0]),a.push(d[2*t.p2+1]),a.push(d[2*t.p3+0]),a.push(d[2*t.p3+1])}u.setAttribute("position",new n.a$l(c,3)),u.setAttribute("uv",new n.a$l(a,2));const h=O(t,o,s,l,i,x),g=new n.xoR({map:h,flatShading:!0}),b=new n.Kj0(u,g);return b}function F(t,e,r,o){const s=new n.u9r,l=[],i=[],u=r.vertices,c=t.colors;for(let n=0,d=e.length;n<d;n++){const t=e[n],r=t.v1,s=t.v2,a=t.v3;l.push(u[3*r+0]),l.push(u[3*r+1]),l.push(u[3*r+2]),l.push(u[3*s+0]),l.push(u[3*s+1]),l.push(u[3*s+2]),l.push(u[3*a+0]),l.push(u[3*a+1]),l.push(u[3*a+2]);const p=void 0!==t.p1?t.p1:o.pindex,d=void 0!==t.p2?t.p2:p,h=void 0!==t.p3?t.p3:p;i.push(c[3*p+0]),i.push(c[3*p+1]),i.push(c[3*p+2]),i.push(c[3*d+0]),i.push(c[3*d+1]),i.push(c[3*d+2]),i.push(c[3*h+0]),i.push(c[3*h+1]),i.push(c[3*h+2])}s.setAttribute("position",new n.a$l(l,3)),s.setAttribute("color",new n.a$l(i,3));const a=new n.xoR({vertexColors:!0,flatShading:!0}),p=new n.Kj0(s,a);return p}function j(t){const e=new n.u9r;e.setIndex(new n.TlE(t["triangles"],1)),e.setAttribute("position",new n.TlE(t["vertices"],3));const r=new n.xoR({color:16777215,flatShading:!0}),o=new n.Kj0(e,r);return o}function R(t,e,r,n,o,s){const l=Object.keys(t),i=[];for(let u=0,c=l.length;u<c;u++){const c=l[u],a=t[c],p=T(c,n);switch(p){case"material":const t=n.resources.basematerials[c],l=S(t,a,e,r,n,o,s);for(let e=0,r=l.length;e<r;e++)i.push(l[e]);break;case"texture":const u=n.resources.texture2dgroup[c];i.push(k(u,a,e,r,n,o,s));break;case"vertexColors":const p=n.resources.colorgroup[c];i.push(F(p,a,e,s));break;case"default":i.push(j(e));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}if(s.name)for(let u=0;u<i.length;u++)i[u].name=s.name;return i}function T(t,e){return void 0!==e.resources.texture2dgroup[t]?"texture":void 0!==e.resources.basematerials[t]?"material":void 0!==e.resources.colorgroup[t]?"vertexColors":"default"===t?"default":void 0}function q(t,e){const r={},n=t["triangleProperties"],o=e.pid;for(let s=0,l=n.length;s<l;s++){const t=n[s];let e=void 0!==t.pid?t.pid:o;void 0===e&&(e="default"),void 0===r[e]&&(r[e]=[]),r[e].push(t)}return r}function E(t,e,r,o,s){const l=new n.ZAu,i=q(t,s),u=R(i,t,e,r,o,s);for(let n=0,c=u.length;n<c;n++)l.add(u[n]);return l}function I(t,r,n){if(!t)return;const o=[],s=Object.keys(t);for(let l=0;l<s.length;l++){const t=s[l];for(let r=0;r<e.availableExtensions.length;r++){const n=e.availableExtensions[r];n.ns===t&&o.push(n)}}for(let e=0;e<o.length;e++){const s=o[e];s.apply(n,t[s["ns"]],r)}}function O(t,e,r,n,o,s){return void 0!==t.build||(t.build=s(t,e,r,n,o)),t.build}function D(t,e,r){let o;const s=t.displaypropertiesid,l=r.resources.pbmetallicdisplayproperties;if(null!==s&&void 0!==l[s]){const e=l[s],r=e.data[t.index];o=new n.Wid({flatShading:!0,roughness:r.roughness,metalness:r.metallicness})}else o=new n.xoR({flatShading:!0});o.name=t.name;const i=t.displaycolor,u=i.substring(0,7);return o.color.setStyle(u),o.color.convertSRGBToLinear(),9===i.length&&(o.opacity=parseInt(i.charAt(7)+i.charAt(8),16)/255),o}function L(t,e,r,o){const s=new n.ZAu;for(let n=0;n<t.length;n++){const l=t[n];let i=e[l.objectId];void 0===i&&(C(l.objectId,e,r,o),i=e[l.objectId]);const u=i.clone(),c=l.transform;c&&u.applyMatrix4(c),s.add(u)}return s}function C(t,e,r,n){const o=r["resources"]["object"][t];if(o["mesh"]){const t=o["mesh"],s=r["extensions"],l=r["xml"];I(s,t,l),e[o.id]=O(t,e,r,n,o,E)}else{const t=o["components"];e[o.id]=O(t,e,r,n,o,L)}o.name&&(e[o.id].name=o.name)}function M(t){const e=t.model,r=t.modelRels,n={},o=Object.keys(e),s={};if(r)for(let l=0,i=r.length;l<i;l++){const e=r[l],n=e.target.substring(1);t.texture[n]&&(s[e.target]=t.texture[n])}for(let l=0;l<o.length;l++){const t=o[l],r=e[t],i=Object.keys(r["resources"]["object"]);for(let e=0;e<i.length;e++){const t=i[e];C(t,n,r,s)}}return n}function $(t){for(let e=0;e<t.length;e++){const r=t[e],n=r.target.split(".").pop();if("model"===n.toLowerCase())return r}}function U(t,e){const r=new n.ZAu,o=$(e["rels"]),s=e.model[o["target"].substring(1)]["build"];for(let n=0;n<s.length;n++){const e=s[n],o=t[e["objectId"]].clone(),l=e["transform"];l&&o.applyMatrix4(l),r.add(o)}return r}const Z=s(t),H=M(Z);return U(H,Z)}addExtension(t){this.availableExtensions.push(t)}}}}]);
//# sourceMappingURL=501.a63e45cf.js.map