"use strict";(self["webpackChunkthree_model_viewer"]=self["webpackChunkthree_model_viewer"]||[]).push([[192],{6192:function(e,t,n){n.r(t),n.d(t,{ColladaLoader:function(){return r}});var s=n(277),o=n(6085);class r extends s.aNw{constructor(e){super(e)}load(e,t,n,o){const r=this,a=""===r.path?s.Zp0.extractUrlBase(e):r.path,i=new s.hH6(r.manager);i.setPath(r.path),i.setRequestHeader(r.requestHeader),i.setWithCredentials(r.withCredentials),i.load(e,(function(n){try{t(r.parse(n,a))}catch(s){o?o(s):console.error(s),r.manager.itemError(e)}}),n,o)}parse(e,t){function n(e,t){const n=[],s=e.childNodes;for(let o=0,r=s.length;o<r;o++){const e=s[o];e.nodeName===t&&n.push(e)}return n}function r(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let s=0,o=t.length;s<o;s++)n[s]=t[s];return n}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let s=0,o=t.length;s<o;s++)n[s]=parseFloat(t[s]);return n}function i(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let s=0,o=t.length;s<o;s++)n[s]=parseInt(t[s]);return n}function c(e){return e.substring(1)}function l(){return"three_default_"+_t++}function d(e){return 0===Object.keys(e).length}function u(e){return{unit:f(n(e,"unit")[0]),upAxis:h(n(e,"up_axis")[0])}}function f(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function h(e){return void 0!==e?e.textContent:"Y_UP"}function m(e,t,s,o){const r=n(e,t)[0];if(void 0!==r){const e=n(r,s);for(let t=0;t<e.length;t++)o(e[t])}}function p(e,t){for(const n in e){const s=e[n];s.build=t(e[n])}}function b(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function g(e){const t={sources:{},samplers:{},channels:{}};let n=!1;for(let s=0,o=e.childNodes.length;s<o;s++){const o=e.childNodes[s];if(1!==o.nodeType)continue;let r;switch(o.nodeName){case"source":r=o.getAttribute("id"),t.sources[r]=ve(o);break;case"sampler":r=o.getAttribute("id"),t.samplers[r]=y(o);break;case"channel":r=o.getAttribute("target"),t.channels[r]=k(o);break;case"animation":g(o),n=!0;break;default:console.log(o)}}!1===n&&(Et.animations[e.getAttribute("id")||s.M8C.generateUUID()]=t)}function y(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"input":const e=c(s.getAttribute("source")),n=s.getAttribute("semantic");t.inputs[n]=e;break}}return t}function k(e){const t={},n=e.getAttribute("target");let s=n.split("/");const o=s.shift();let r=s.shift();const a=-1!==r.indexOf("("),i=-1!==r.indexOf(".");if(i)s=r.split("."),r=s.shift(),t.member=s.shift();else if(a){const e=r.split("(");r=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=o,t.sid=r,t.arraySyntax=a,t.memberSyntax=i,t.sampler=c(e.getAttribute("source")),t}function N(e){const t=[],n=e.channels,s=e.samplers,o=e.sources;for(const r in n)if(n.hasOwnProperty(r)){const e=n[r],a=s[e.sampler],i=a.inputs.INPUT,c=a.inputs.OUTPUT,l=o[i],d=o[c],u=x(e,l,d);_(u,t)}return t}function w(e){return b(Et.animations[e],N)}function x(e,t,n){const s=Et.nodes[e.id],o=lt(s.id),r=s.transforms[e.sid],a=s.matrix.clone().transpose();let i,c,l,d,u,f;const h={};switch(r){case"matrix":for(l=0,d=t.array.length;l<d;l++)if(i=t.array[l],c=l*n.stride,void 0===h[i]&&(h[i]={}),!0===e.arraySyntax){const t=n.array[c],s=e.indices[0]+4*e.indices[1];h[i][s]=t}else for(u=0,f=n.stride;u<f;u++)h[i][u]=n.array[c+u];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break}const m=A(h,a),p={name:o.uuid,keyframes:m};return p}function A(e,t){const n=[];for(const o in e)n.push({time:parseFloat(o),value:e[o]});n.sort(s);for(let o=0;o<16;o++)E(n,o,t.elements[o]);return n;function s(e,t){return e.time-t.time}}const v=new s.Pa4,T=new s.Pa4,C=new s._fP;function _(e,t){const n=e.keyframes,o=e.name,r=[],a=[],i=[],c=[];for(let s=0,l=n.length;s<l;s++){const e=n[s],t=e.time,o=e.value;Ye.fromArray(o).transpose(),Ye.decompose(v,C,T),r.push(t),a.push(v.x,v.y,v.z),i.push(C.x,C.y,C.z,C.w),c.push(T.x,T.y,T.z)}return a.length>0&&t.push(new s.yC1(o+".position",r,a)),i.length>0&&t.push(new s.iLg(o+".quaternion",r,i)),c.length>0&&t.push(new s.yC1(o+".scale",r,c)),t}function E(e,t,n){let s,o,r,a=!0;for(o=0,r=e.length;o<r;o++)s=e[o],void 0===s.value[t]?s.value[t]=null:a=!1;if(!0===a)for(o=0,r=e.length;o<r;o++)s=e[o],s.value[t]=n;else R(e,t)}function R(e,t){let n,s;for(let o=0,r=e.length;o<r;o++){const r=e[o];if(null===r.value[t]){if(n=O(e,o,t),s=j(e,o,t),null===n){r.value[t]=s.value[t];continue}if(null===s){r.value[t]=n.value[t];continue}L(r,n,s,t)}}}function O(e,t,n){while(t>=0){const s=e[t];if(null!==s.value[n])return s;t--}return null}function j(e,t,n){while(t<e.length){const s=e[t];if(null!==s.value[n])return s;t++}return null}function L(e,t,n,s){n.time-t.time!==0?e.value[s]=(e.time-t.time)*(n.value[s]-t.value[s])/(n.time-t.time)+t.value[s]:e.value[s]=t.value[s]}function I(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"instance_animation":t.animations.push(c(s.getAttribute("url")));break}}Et.clips[e.getAttribute("id")]=t}function q(e){const t=[],n=e.name,o=e.end-e.start||-1,r=e.animations;for(let s=0,a=r.length;s<a;s++){const e=w(r[s]);for(let n=0,s=e.length;n<s;n++)t.push(e[n])}return new s.m7l(n,o,t)}function M(e){return b(Et.clips[e],q)}function S(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"skin":t.id=c(s.getAttribute("source")),t.skin=P(s);break;case"morph":t.id=c(s.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}Et.controllers[e.getAttribute("id")]=t}function P(e){const t={sources:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=a(s.textContent);break;case"source":const e=s.getAttribute("id");t.sources[e]=ve(s);break;case"joints":t.joints=H(s);break;case"vertex_weights":t.vertexWeights=U(s);break}}return t}function H(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"input":const e=s.getAttribute("semantic"),n=c(s.getAttribute("source"));t.inputs[e]=n;break}}return t}function U(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"input":const e=s.getAttribute("semantic"),n=c(s.getAttribute("source")),o=parseInt(s.getAttribute("offset"));t.inputs[e]={id:n,offset:o};break;case"vcount":t.vcount=i(s.textContent);break;case"v":t.v=i(s.textContent);break}}return t}function G(e){const t={id:e.id},n=Et.geometries[t.id];return void 0!==e.skin&&(t.skin=B(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function B(e){const t=4,n={joints:[],indices:{array:[],stride:t},weights:{array:[],stride:t}},o=e.sources,r=e.vertexWeights,a=r.vcount,i=r.v,c=r.inputs.JOINT.offset,l=r.inputs.WEIGHT.offset,d=e.sources[e.joints.inputs.JOINT],u=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=o[r.inputs.WEIGHT.id].array;let h,m,p,b=0;for(h=0,p=a.length;h<p;h++){const e=a[h],s=[];for(m=0;m<e;m++){const e=i[b+c],t=i[b+l],n=f[t];s.push({index:e,weight:n}),b+=2}for(s.sort(g),m=0;m<t;m++){const e=s[m];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}for(e.bindShapeMatrix?n.bindMatrix=(new s.yGw).fromArray(e.bindShapeMatrix).transpose():n.bindMatrix=(new s.yGw).identity(),h=0,p=d.array.length;h<p;h++){const e=d.array[h],t=(new s.yGw).fromArray(u.array,h*u.stride).transpose();n.joints.push({name:e,boneInverse:t})}return n;function g(e,t){return t.weight-e.weight}}function F(e){return b(Et.controllers[e],G)}function z(e){const t={init_from:n(e,"init_from")[0].textContent};Et.images[e.getAttribute("id")]=t}function D(e){return void 0!==e.build?e.build:e.init_from}function J(e){const t=Et.images[e];return void 0!==t?b(t,D):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function V(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"profile_COMMON":t.profile=W(s);break}}Et.effects[e.getAttribute("id")]=t}function W(e){const t={surfaces:{},samplers:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"newparam":X(s,t);break;case"technique":t.technique=K(s);break;case"extra":t.extra=se(s);break}}return t}function X(e,t){const n=e.getAttribute("sid");for(let s=0,o=e.childNodes.length;s<o;s++){const o=e.childNodes[s];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[n]=$(o);break;case"sampler2D":t.samplers[n]=Z(o);break}}}function $(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"init_from":t.init_from=s.textContent;break}}return t}function Z(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"source":t.source=s.textContent;break}}return t}function K(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=s.nodeName,t.parameters=Y(s);break;case"extra":t.extra=se(s);break}}return t}function Y(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[s.nodeName]=Q(s);break;case"transparent":t[s.nodeName]={opaque:s.hasAttribute("opaque")?s.getAttribute("opaque"):"A_ONE",data:Q(s)};break}}return t}function Q(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"color":t[s.nodeName]=a(s.textContent);break;case"float":t[s.nodeName]=parseFloat(s.textContent);break;case"texture":t[s.nodeName]={id:s.getAttribute("texture"),extra:ee(s)};break}}return t}function ee(e){const t={technique:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"extra":te(s,t);break}}return t}function te(e,t){for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"technique":ne(s,t);break}}}function ne(e,t){for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[s.nodeName]=parseFloat(s.textContent);break;case"wrapU":case"wrapV":"TRUE"===s.textContent.toUpperCase()?t.technique[s.nodeName]=1:"FALSE"===s.textContent.toUpperCase()?t.technique[s.nodeName]=0:t.technique[s.nodeName]=parseInt(s.textContent);break;case"bump":t[s.nodeName]=re(s);break}}}function se(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"technique":t.technique=oe(s);break}}return t}function oe(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"double_sided":t[s.nodeName]=parseInt(s.textContent);break;case"bump":t[s.nodeName]=re(s);break}}return t}function re(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"texture":t[s.nodeName]={id:s.getAttribute("texture"),texcoord:s.getAttribute("texcoord"),extra:ee(s)};break}}return t}function ae(e){return e}function ie(e){return b(Et.effects[e],ae)}function ce(e){const t={name:e.getAttribute("name")};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"instance_effect":t.url=c(s.getAttribute("url"));break}}Et.materials[e.getAttribute("id")]=t}function le(e){let t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(n=n.toLowerCase(),n){case"tga":t=At;break;default:t=xt}return t}function de(e){const t=ie(e.url),n=t.profile.technique;let o;switch(n.type){case"phong":case"blinn":o=new s.xoR;break;case"lambert":o=new s.YBo;break;default:o=new s.vBJ;break}function r(e,n=null){const o=t.profile.samplers[e.id];let r=null;if(void 0!==o){const e=t.profile.surfaces[o.source];r=J(e.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=J(e.id);if(null!==r){const t=le(r);if(void 0!==t){const o=t.load(r),a=e.extra;if(void 0!==a&&void 0!==a.technique&&!1===d(a.technique)){const e=a.technique;o.wrapS=e.wrapU?s.rpg:s.uWy,o.wrapT=e.wrapV?s.rpg:s.uWy,o.offset.set(e.offsetU||0,e.offsetV||0),o.repeat.set(e.repeatU||1,e.repeatV||1)}else o.wrapS=s.rpg,o.wrapT=s.rpg;return null!==n&&(o.encoding=n),o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}o.name=e.name||"";const a=n.parameters;for(const l in a){const e=a[l];switch(l){case"diffuse":e.color&&o.color.fromArray(e.color),e.texture&&(o.map=r(e.texture,s.knz));break;case"specular":e.color&&o.specular&&o.specular.fromArray(e.color),e.texture&&(o.specularMap=r(e.texture));break;case"bump":e.texture&&(o.normalMap=r(e.texture));break;case"ambient":e.texture&&(o.lightMap=r(e.texture,s.knz));break;case"shininess":e.float&&o.shininess&&(o.shininess=e.float);break;case"emission":e.color&&o.emissive&&o.emissive.fromArray(e.color),e.texture&&(o.emissiveMap=r(e.texture,s.knz));break}}o.color.convertSRGBToLinear(),o.specular&&o.specular.convertSRGBToLinear(),o.emissive&&o.emissive.convertSRGBToLinear();let i=a["transparent"],c=a["transparency"];if(void 0===c&&i&&(c={float:1}),void 0===i&&c&&(i={opaque:"A_ONE",data:{color:[1,1,1,1]}}),i&&c)if(i.data.texture)o.transparent=!0;else{const e=i.data.color;switch(i.opaque){case"A_ONE":o.opacity=e[3]*c.float;break;case"RGB_ZERO":o.opacity=1-e[0]*c.float;break;case"A_ZERO":o.opacity=1-e[3]*c.float;break;case"RGB_ONE":o.opacity=e[0]*c.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',i.opaque)}o.opacity<1&&(o.transparent=!0)}if(void 0!==n.extra&&void 0!==n.extra.technique){const e=n.extra.technique;for(const t in e){const n=e[t];switch(t){case"double_sided":o.side=1===n?s.ehD:s.Wl3;break;case"bump":o.normalMap=r(n.texture),o.normalScale=new s.FM8(1,1);break}}}return o}function ue(e){return b(Et.materials[e],de)}function fe(e){const t={name:e.getAttribute("name")};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"optics":t.optics=he(s);break}}Et.cameras[e.getAttribute("id")]=t}function he(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];switch(n.nodeName){case"technique_common":return me(n)}}return{}}function me(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"perspective":case"orthographic":t.technique=s.nodeName,t.parameters=pe(s);break}}return t}function pe(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[s.nodeName]=parseFloat(s.textContent);break}}return t}function be(e){let t;switch(e.optics.technique){case"perspective":t=new s.cPb(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,o=e.optics.parameters.xmag;const r=e.optics.parameters.aspect_ratio;o=void 0===o?n*r:o,n=void 0===n?o/r:n,o*=.5,n*=.5,t=new s.iKG(-o,o,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new s.cPb;break}return t.name=e.name||"",t}function ge(e){const t=Et.cameras[e];return void 0!==t?b(t,be):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ye(e){let t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"technique_common":t=ke(s);break}}Et.lights[e.getAttribute("id")]=t}function ke(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=s.nodeName,t.parameters=Ne(s)}}return t}function Ne(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":const e=a(o.textContent);t.color=(new s.Ilk).fromArray(e).convertSRGBToLinear();break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":const n=parseFloat(o.textContent);t.distance=n?Math.sqrt(1/n):0;break}}return t}function we(e){let t;switch(e.technique){case"directional":t=new s.Ox3;break;case"point":t=new s.cek;break;case"spot":t=new s.PMe;break;case"ambient":t=new s.Mig;break}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function xe(e){const t=Et.lights[e];return void 0!==t?b(t,we):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function Ae(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},s=n(e,"mesh")[0];if(void 0!==s){for(let e=0;e<s.childNodes.length;e++){const n=s.childNodes[e];if(1!==n.nodeType)continue;const o=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[o]=ve(n);break;case"vertices":t.vertices=Te(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(Ce(n));break;default:console.log(n)}}Et.geometries[e.getAttribute("id")]=t}}function ve(e){const t={array:[],stride:3};for(let s=0;s<e.childNodes.length;s++){const o=e.childNodes[s];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=a(o.textContent);break;case"Name_array":t.array=r(o.textContent);break;case"technique_common":const e=n(o,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")));break}}return t}function Te(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];1===s.nodeType&&(t[s.getAttribute("semantic")]=c(s.getAttribute("source")))}return t}function Ce(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"input":const e=c(s.getAttribute("source")),n=s.getAttribute("semantic"),o=parseInt(s.getAttribute("offset")),r=parseInt(s.getAttribute("set")),a=r>0?n+r:n;t.inputs[a]={id:e,offset:o},t.stride=Math.max(t.stride,o+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=i(s.textContent);break;case"p":t.p=i(s.textContent);break}}return t}function _e(e){const t={};for(let n=0;n<e.length;n++){const s=e[n];void 0===t[s.type]&&(t[s.type]=[]),t[s.type].push(s)}return t}function Ee(e){let t=0;for(let n=0,s=e.length;n<s;n++){const s=e[n];!0===s.hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function Re(e){const t={},n=e.sources,s=e.vertices,o=e.primitives;if(0===o.length)return{};const r=_e(o);for(const a in r){const e=r[a];Ee(e),t[a]=Oe(e,n,s)}return t}function Oe(e,t,n){const o={},r={array:[],stride:0},a={array:[],stride:0},i={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:0},d={array:[],stride:4},u={array:[],stride:4},f=new s.u9r,h=[];let m=0;for(let s=0;s<e.length;s++){const o=e[s],p=o.inputs;let b=0;switch(o.type){case"lines":case"linestrips":b=2*o.count;break;case"triangles":b=3*o.count;break;case"polylist":for(let e=0;e<o.count;e++){const t=o.vcount[e];switch(t){case 3:b+=3;break;case 4:b+=6;break;default:b+=3*(t-2);break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",o.type)}f.addGroup(m,b,s),m+=b,o.material&&h.push(o.material);for(const s in p){const f=p[s];switch(s){case"VERTEX":for(const s in n){const h=n[s];switch(s){case"POSITION":const n=r.array.length;if(je(o,t[h],f.offset,r.array),r.stride=t[h].stride,t.skinWeights&&t.skinIndices&&(je(o,t.skinIndices,f.offset,d.array),je(o,t.skinWeights,f.offset,u.array)),!1===o.hasUV&&!0===e.uvsNeedsFix){const e=(r.array.length-n)/r.stride;for(let t=0;t<e;t++)i.array.push(0,0)}break;case"NORMAL":je(o,t[h],f.offset,a.array),a.stride=t[h].stride;break;case"COLOR":je(o,t[h],f.offset,l.array),l.stride=t[h].stride;break;case"TEXCOORD":je(o,t[h],f.offset,i.array),i.stride=t[h].stride;break;case"TEXCOORD1":je(o,t[h],f.offset,c.array),i.stride=t[h].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',s)}}break;case"NORMAL":je(o,t[f.id],f.offset,a.array),a.stride=t[f.id].stride;break;case"COLOR":je(o,t[f.id],f.offset,l.array,!0),l.stride=t[f.id].stride;break;case"TEXCOORD":je(o,t[f.id],f.offset,i.array),i.stride=t[f.id].stride;break;case"TEXCOORD1":je(o,t[f.id],f.offset,c.array),c.stride=t[f.id].stride;break}}}return r.array.length>0&&f.setAttribute("position",new s.a$l(r.array,r.stride)),a.array.length>0&&f.setAttribute("normal",new s.a$l(a.array,a.stride)),l.array.length>0&&f.setAttribute("color",new s.a$l(l.array,l.stride)),i.array.length>0&&f.setAttribute("uv",new s.a$l(i.array,i.stride)),c.array.length>0&&f.setAttribute("uv2",new s.a$l(c.array,c.stride)),d.array.length>0&&f.setAttribute("skinIndex",new s.a$l(d.array,d.stride)),u.array.length>0&&f.setAttribute("skinWeight",new s.a$l(u.array,u.stride)),o.data=f,o.type=e[0].type,o.materialKeys=h,o}function je(e,t,n,s,o=!1){const r=e.p,a=e.stride,i=e.vcount;function c(e){let t=r[e+n]*d;const a=t+d;for(;t<a;t++)s.push(l[t]);if(o){const e=s.length-d-1;vt.setRGB(s[e+0],s[e+1],s[e+2]).convertSRGBToLinear(),s[e+0]=vt.r,s[e+1]=vt.g,s[e+2]=vt.b}}const l=t.array,d=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=i.length;t<n;t++){const n=i[t];if(4===n){const t=e+0*a,n=e+1*a,s=e+2*a,o=e+3*a;c(t),c(n),c(o),c(n),c(s),c(o)}else if(3===n){const t=e+0*a,n=e+1*a,s=e+2*a;c(t),c(n),c(s)}else if(n>4)for(let t=1,s=n-2;t<=s;t++){const n=e+0*a,s=e+a*t,o=e+a*(t+1);c(n),c(s),c(o)}e+=a*n}}else for(let u=0,f=r.length;u<f;u+=a)c(u)}function Le(e){return b(Et.geometries[e],Re)}function Ie(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"technique_common":Se(s,t);break}}Et.kinematicsModels[e.getAttribute("id")]=t}function qe(e){return void 0!==e.build?e.build:e}function Me(e){return b(Et.kinematicsModels[e],qe)}function Se(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"joint":t.joints[s.getAttribute("sid")]=Pe(s);break;case"link":t.links.push(Ue(s));break}}}function Pe(e){let t;for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"prismatic":case"revolute":t=He(s);break}}return t}function He(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new s.Pa4,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"axis":const e=a(s.textContent);t.axis.fromArray(e);break;case"limits":const n=s.getElementsByTagName("max")[0],o=s.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(o.textContent);break}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function Ue(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"attachment_full":t.attachments.push(Ge(s));break;case"matrix":case"translate":case"rotate":t.transforms.push(Be(s));break}}return t}function Ge(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"link":t.links.push(Ue(s));break;case"matrix":case"translate":case"rotate":t.transforms.push(Be(s));break}}return t}function Be(e){const t={type:e.nodeName},n=a(e.textContent);switch(t.type){case"matrix":t.obj=new s.yGw,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new s.Pa4,t.obj.fromArray(n);break;case"rotate":t.obj=new s.Pa4,t.obj.fromArray(n),t.angle=s.M8C.degToRad(n[3]);break}return t}function Fe(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"rigid_body":t.rigidBodies[s.getAttribute("name")]={},ze(s,t.rigidBodies[s.getAttribute("name")]);break}}Et.physicsModels[e.getAttribute("id")]=t}function ze(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"technique_common":De(s,t);break}}}function De(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"inertia":t.inertia=a(s.textContent);break;case"mass":t.mass=a(s.textContent)[0];break}}}function Je(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ve(s));break}}Et.kinematicsScenes[c(e.getAttribute("url"))]=t}function Ve(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"axis":const e=s.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substring(0,n.length-1);break}}return t}function We(e){return void 0!==e.build?e.build:e}function Xe(e){return b(Et.kinematicsScenes[e],We)}function $e(){const e=Object.keys(Et.kinematicsModels)[0],t=Object.keys(Et.kinematicsScenes)[0],n=Object.keys(Et.visualScenes)[0];if(void 0===e||void 0===t)return;const o=Me(e),r=Xe(t),a=ht(n),i=r.bindJointAxis,c={};for(let s=0,u=i.length;s<u;s++){const e=i[s],t=yt.querySelector('[sid="'+e.target+'"]');if(t){const n=t.parentElement;l(e.jointIndex,n)}}function l(e,t){const n=t.getAttribute("name"),s=o.joints[e];a.traverse((function(o){o.name===n&&(c[e]={object:o,transforms:Ze(t),joint:s,position:s.zeroPosition})}))}const d=new s.yGw;Ct={joints:o&&o.joints,getJointValue:function(e){const t=c[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){const n=c[e];if(n){const o=n.joint;if(t>o.limits.max||t<o.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+o.limits.min+", max: "+o.limits.max+").");else if(o.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{const r=n.object,a=o.axis,i=n.transforms;Ye.identity();for(let n=0;n<i.length;n++){const r=i[n];if(r.sid&&-1!==r.sid.indexOf(e))switch(o.type){case"revolute":Ye.multiply(d.makeRotationAxis(a,s.M8C.degToRad(t)));break;case"prismatic":Ye.multiply(d.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+o.type);break}else switch(r.type){case"matrix":Ye.multiply(r.obj);break;case"translate":Ye.multiply(d.makeTranslation(r.obj.x,r.obj.y,r.obj.z));break;case"scale":Ye.scale(r.obj);break;case"rotate":Ye.multiply(d.makeRotationAxis(r.obj,r.angle));break}}r.matrix.copy(Ye),r.matrix.decompose(r.position,r.quaternion,r.scale),c[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function Ze(e){const t=[],n=yt.querySelector('[id="'+e.id+'"]');for(let o=0;o<n.childNodes.length;o++){const e=n.childNodes[o];if(1!==e.nodeType)continue;let r,i;switch(e.nodeName){case"matrix":r=a(e.textContent);const n=(new s.yGw).fromArray(r).transpose();t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:n});break;case"translate":case"scale":r=a(e.textContent),i=(new s.Pa4).fromArray(r),t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:i});break;case"rotate":r=a(e.textContent),i=(new s.Pa4).fromArray(r);const o=s.M8C.degToRad(r[3]);t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:i,angle:o});break}}return t}function Ke(e){const t=e.getElementsByTagName("node");for(let n=0;n<t.length;n++){const e=t[n];!1===e.hasAttribute("id")&&e.setAttribute("id",l())}}const Ye=new s.yGw,Qe=new s.Pa4;function et(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new s.yGw,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1!==o.nodeType)continue;let r;switch(o.nodeName){case"node":t.nodes.push(o.getAttribute("id")),et(o);break;case"instance_camera":t.instanceCameras.push(c(o.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(tt(o));break;case"instance_light":t.instanceLights.push(c(o.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(tt(o));break;case"instance_node":t.instanceNodes.push(c(o.getAttribute("url")));break;case"matrix":r=a(o.textContent),t.matrix.multiply(Ye.fromArray(r).transpose()),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"translate":r=a(o.textContent),Qe.fromArray(r),t.matrix.multiply(Ye.makeTranslation(Qe.x,Qe.y,Qe.z)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"rotate":r=a(o.textContent);const e=s.M8C.degToRad(r[3]);t.matrix.multiply(Ye.makeRotationAxis(Qe.fromArray(r),e)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"scale":r=a(o.textContent),t.matrix.scale(Qe.fromArray(r)),t.transforms[o.getAttribute("sid")]=o.nodeName;break;case"extra":break;default:console.log(o)}}return ct(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Et.nodes[t.id]=t,t}function tt(e){const t={id:c(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"bind_material":const e=s.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const s=e[n],o=s.getAttribute("symbol"),r=s.getAttribute("target");t.materials[o]=c(r)}break;case"skeleton":t.skeletons.push(c(s.textContent));break;default:break}}return t}function nt(e,t){const n=[],o=[];let r,a,i;for(r=0;r<e.length;r++){const s=e[r];let o;if(ct(s))o=lt(s),st(o,t,n);else if(ft(s)){const e=Et.visualScenes[s],o=e.children;for(let s=0;s<o.length;s++){const e=o[s];if("JOINT"===e.type){const s=lt(e.id);st(s,t,n)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(a=0;a<n.length;a++)if(i=n[a],i.bone.name===t[r].name){o[r]=i,i.processed=!0;break}for(r=0;r<n.length;r++)i=n[r],!1===i.processed&&(o.push(i),i.processed=!0);const c=[],l=[];for(r=0;r<o.length;r++)i=o[r],c.push(i.bone),l.push(i.boneInverse);return new s.OdW(c,l)}function st(e,t,n){e.traverse((function(e){if(!0===e.isBone){let o;for(let n=0;n<t.length;n++){const s=t[n];if(s.name===e.name){o=s.boneInverse;break}}void 0===o&&(o=new s.yGw),n.push({bone:e,boneInverse:o,processed:!1})}}))}function ot(e){const t=[],n=e.matrix,o=e.nodes,r=e.type,a=e.instanceCameras,i=e.instanceControllers,c=e.instanceLights,l=e.instanceGeometries,d=e.instanceNodes;for(let s=0,f=o.length;s<f;s++)t.push(lt(o[s]));for(let s=0,f=a.length;s<f;s++){const e=ge(a[s]);null!==e&&t.push(e.clone())}for(let s=0,f=i.length;s<f;s++){const e=i[s],n=F(e.id),o=Le(n.id),r=it(o,e.materials),a=e.skeletons,c=n.skin.joints,l=nt(a,c);for(let s=0,i=r.length;s<i;s++){const e=r[s];e.isSkinnedMesh&&(e.bind(l,n.skin.bindMatrix),e.normalizeSkinWeights()),t.push(e)}}for(let s=0,f=c.length;s<f;s++){const e=xe(c[s]);null!==e&&t.push(e.clone())}for(let s=0,f=l.length;s<f;s++){const e=l[s],n=Le(e.id),o=it(n,e.materials);for(let s=0,r=o.length;s<r;s++)t.push(o[s])}for(let s=0,f=d.length;s<f;s++)t.push(lt(d[s]).clone());let u;if(0===o.length&&1===t.length)u=t[0];else{u="JOINT"===r?new s.N$j:new s.ZAu;for(let e=0;e<t.length;e++)u.add(t[e])}return u.name="JOINT"===r?e.sid:e.name,u.matrix.copy(n),u.matrix.decompose(u.position,u.quaternion,u.scale),u}const rt=new s.vBJ({color:16711935});function at(e,t){const n=[];for(let s=0,o=e.length;s<o;s++){const o=t[e[s]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[s]),n.push(rt)):n.push(ue(o))}return n}function it(e,t){const n=[];for(const o in e){const r=e[o],a=at(r.materialKeys,t);if(0===a.length&&("lines"===o||"linestrips"===o?a.push(new s.nls):a.push(new s.xoR)),"lines"===o||"linestrips"===o)for(let e=0,t=a.length;e<t;e++){const t=a[e];if(!0===t.isMeshPhongMaterial||!0===t.isMeshLambertMaterial){const n=new s.nls;n.color.copy(t.color),n.opacity=t.opacity,n.transparent=t.transparent,a[e]=n}}const i=void 0!==r.data.attributes.skinIndex,c=1===a.length?a[0]:a;let l;switch(o){case"lines":l=new s.ejS(r.data,c);break;case"linestrips":l=new s.x12(r.data,c);break;case"triangles":case"polylist":l=i?new s.TUv(r.data,c):new s.Kj0(r.data,c);break}n.push(l)}return n}function ct(e){return void 0!==Et.nodes[e]}function lt(e){return b(Et.nodes[e],ot)}function dt(e){const t={name:e.getAttribute("name"),children:[]};Ke(e);const s=n(e,"node");for(let n=0;n<s.length;n++)t.children.push(et(s[n]));Et.visualScenes[e.getAttribute("id")]=t}function ut(e){const t=new s.ZAu;t.name=e.name;const n=e.children;for(let s=0;s<n.length;s++){const e=n[s];t.add(lt(e.id))}return t}function ft(e){return void 0!==Et.visualScenes[e]}function ht(e){return b(Et.visualScenes[e],ut)}function mt(e){const t=n(e,"instance_visual_scene")[0];return ht(c(t.getAttribute("url")))}function pt(){const e=Et.clips;if(!0===d(e)){if(!1===d(Et.animations)){const e=[];for(const t in Et.animations){const n=w(t);for(let t=0,s=n.length;t<s;t++)e.push(n[t])}Tt.push(new s.m7l("default",-1,e))}}else for(const t in e)Tt.push(M(t))}function bt(e){let t="";const n=[e];while(n.length){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}if(0===e.length)return{scene:new s.xsS};const gt=(new DOMParser).parseFromString(e,"application/xml"),yt=n(gt,"COLLADA")[0],kt=gt.getElementsByTagName("parsererror")[0];if(void 0!==kt){const e=n(kt,"div")[0];let t;return t=e?e.textContent:bt(kt),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const Nt=yt.getAttribute("version");console.debug("THREE.ColladaLoader: File version",Nt);const wt=u(n(yt,"asset")[0]),xt=new s.dpR(this.manager);let At;xt.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),o.U&&(At=new o.U(this.manager),At.setPath(this.resourcePath||t));const vt=new s.Ilk,Tt=[];let Ct={},_t=0;const Et={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};m(yt,"library_animations","animation",g),m(yt,"library_animation_clips","animation_clip",I),m(yt,"library_controllers","controller",S),m(yt,"library_images","image",z),m(yt,"library_effects","effect",V),m(yt,"library_materials","material",ce),m(yt,"library_cameras","camera",fe),m(yt,"library_lights","light",ye),m(yt,"library_geometries","geometry",Ae),m(yt,"library_nodes","node",et),m(yt,"library_visual_scenes","visual_scene",dt),m(yt,"library_kinematics_models","kinematics_model",Ie),m(yt,"library_physics_models","physics_model",Fe),m(yt,"scene","instance_kinematics_scene",Je),p(Et.animations,N),p(Et.clips,q),p(Et.controllers,G),p(Et.images,D),p(Et.effects,ae),p(Et.materials,de),p(Et.cameras,be),p(Et.lights,we),p(Et.geometries,Re),p(Et.visualScenes,ut),pt(),$e();const Rt=mt(n(yt,"scene")[0]);return Rt.animations=Tt,"Z_UP"===wt.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),Rt.rotation.set(-Math.PI/2,0,0)),Rt.scale.multiplyScalar(wt.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Tt},kinematics:Ct,library:Et,scene:Rt}}}}}]);
//# sourceMappingURL=192.cd6d2f40.js.map