"use strict";(self.webpackChunkthree_model_viewer=self.webpackChunkthree_model_viewer||[]).push([[669],{2669:function(e,t,r){r.r(t),r.d(t,{ThreeMFLoader:function(){return l}});var a=r(216),n=r(6925);class l extends a.aNw{constructor(e){super(e),this.availableExtensions=[]}load(e,t,r,n){const l=this;var i=new a.hH6(l.manager);i.setPath(l.path),i.setResponseType("arraybuffer"),i.setRequestHeader(l.requestHeader),i.setWithCredentials(l.withCredentials),i.load(e,(function(r){try{t(l.parse(r))}catch(r){n&&n(r),l.manager.itemError(e)}}),r,n)}parse(e){const t=this,r=new a.dpR(this.manager);function l(e){var t=[],r=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("Relationship");for(let n=0;n<r.length;n++){var a=r[n];a={target:a.getAttribute("Target"),id:a.getAttribute("Id"),type:a.getAttribute("Type")};t.push(a)}return t}function i(e){const t=[];return e.split(" ").forEach((function(e){t.push(parseFloat(e))})),e=new a.yGw,e.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),e}function s(e,t,n,l){if(e=e.texid,n=n.resources.texture2d[e],n){e=l[n.path],l=n.contenttype,e=new Blob([e],{type:l});const t=URL.createObjectURL(e);var i=r.load(t,(function(){URL.revokeObjectURL(t)}));switch(i.encoding=a.knz,n.tilestyleu){case"wrap":i.wrapS=a.rpg;break;case"mirror":i.wrapS=a.OoA;break;case"none":case"clamp":i.wrapS=a.uWy;break;default:i.wrapS=a.rpg}switch(n.tilestylev){case"wrap":i.wrapT=a.rpg;break;case"mirror":i.wrapT=a.OoA;break;case"none":case"clamp":i.wrapT=a.uWy;break;default:i.wrapT=a.rpg}switch(n.filter){case"auto":i.magFilter=a.wem,i.minFilter=a.D1R;break;case"linear":i.magFilter=a.wem,i.minFilter=a.wem;break;case"nearest":i.magFilter=a.TyD,i.minFilter=a.TyD;break;default:i.magFilter=a.wem,i.minFilter=a.D1R}return i}return null}function o(e,t,r,n,l,i){var o,u,d,h,v=Object.keys(e),g=[];for(let y=0,w=v.length;y<w;y++){var b=v[y],f=e[b];switch(d=b,void 0!==(h=n).resources.texture2dgroup[d]?"texture":void 0!==h.resources.basematerials[d]?"material":void 0!==h.resources.colorgroup[d]?"vertexColors":"default"===d?"default":void 0){case"material":var m=function(e,t,r,n,l,i,s){var o=s.pindex,u={};for(let a=0,p=t.length;a<p;a++){var d=t[a],h=void 0!==d.p1?d.p1:o;void 0===u[h]&&(u[h]=[]),u[h].push(d)}var v=Object.keys(u),g=[];for(let x=0,S=v.length;x<S;x++){var b=v[x],f=u[b],m=(b=p(e.basematerials[b],n,l,i,s,c),new a.u9r),A=[],y=r.vertices;for(let e=0,t=f.length;e<t;e++){var w=f[e];A.push(y[3*w.v1+0]),A.push(y[3*w.v1+1]),A.push(y[3*w.v1+2]),A.push(y[3*w.v2+0]),A.push(y[3*w.v2+1]),A.push(y[3*w.v2+2]),A.push(y[3*w.v3+0]),A.push(y[3*w.v3+1]),A.push(y[3*w.v3+2])}m.setAttribute("position",new a.a$l(A,3)),m=new a.Kj0(m,b),g.push(m)}return g}(n.resources.basematerials[b],f,t,r,n,l,i);for(let e=0,t=m.length;e<t;e++)g.push(m[e]);break;case"texture":var A=n.resources.texture2dgroup[b];g.push(function(e,t,r,n,l,i,o){var u=new a.u9r,c=[],d=[],h=r.vertices,v=e.uvs;for(let a=0,s=t.length;a<s;a++){var g=t[a];c.push(h[3*g.v1+0]),c.push(h[3*g.v1+1]),c.push(h[3*g.v1+2]),c.push(h[3*g.v2+0]),c.push(h[3*g.v2+1]),c.push(h[3*g.v2+2]),c.push(h[3*g.v3+0]),c.push(h[3*g.v3+1]),c.push(h[3*g.v3+2]),d.push(v[2*g.p1+0]),d.push(v[2*g.p1+1]),d.push(v[2*g.p2+0]),d.push(v[2*g.p2+1]),d.push(v[2*g.p3+0]),d.push(v[2*g.p3+1])}return u.setAttribute("position",new a.a$l(c,3)),u.setAttribute("uv",new a.a$l(d,2)),r=p(e,n,l,i,o,s),e=new a.xoR({map:r,flatShading:!0}),new a.Kj0(u,e)}(A,f,t,r,n,l,i));break;case"vertexColors":A=n.resources.colorgroup[b],g.push(function(e,t,r,n){var l=new a.u9r,i=[],s=[],o=r.vertices,u=e.colors;for(let a=0,v=t.length;a<v;a++){var p=t[a],c=p.v1,d=p.v2,h=p.v3;c=(i.push(o[3*c+0]),i.push(o[3*c+1]),i.push(o[3*c+2]),i.push(o[3*d+0]),i.push(o[3*d+1]),i.push(o[3*d+2]),i.push(o[3*h+0]),i.push(o[3*h+1]),i.push(o[3*h+2]),void 0!==p.p1?p.p1:n.pindex),d=void 0!==p.p2?p.p2:c,h=void 0!==p.p3?p.p3:c;s.push(u[3*c+0]),s.push(u[3*c+1]),s.push(u[3*c+2]),s.push(u[3*d+0]),s.push(u[3*d+1]),s.push(u[3*d+2]),s.push(u[3*h+0]),s.push(u[3*h+1]),s.push(u[3*h+2])}return l.setAttribute("position",new a.a$l(i,3)),l.setAttribute("color",new a.a$l(s,3)),r=new a.xoR({vertexColors:!0,flatShading:!0}),new a.Kj0(l,r)}(A,f,t,i));break;case"default":g.push((o=t,u=void 0,(u=new a.u9r).setIndex(new a.TlE(o.triangles,1)),u.setAttribute("position",new a.TlE(o.vertices,3)),o=new a.xoR({color:16777215,flatShading:!0}),new a.Kj0(u,o)))}}if(i.name)for(let a=0;a<g.length;a++)g[a].name=i.name;return g}function u(e,t,r,n,l){var i=new a.ZAu,s=o(function(e,t){var r={},a=e.triangleProperties,n=t.pid;for(let i=0,s=a.length;i<s;i++){var l=a[i];let e=void 0!==l.pid?l.pid:n;void 0===r[e=void 0===e?"default":e]&&(r[e]=[]),r[e].push(l)}return r}(e,l),e,t,r,n,l);for(let a=0,o=s.length;a<o;a++)i.add(s[a]);return i}function p(e,t,r,a,n,l){return void 0===e.build&&(e.build=l(e,t,r,a,n)),e.build}function c(e,t,r){let n;var l=e.displaypropertiesid;r=r.resources.pbmetallicdisplayproperties,(n=null!==l&&void 0!==r[l]?(r=r[l].data[e.index],new a.Wid({flatShading:!0,roughness:r.roughness,metalness:r.metallicness})):new a.xoR({flatShading:!0})).name=e.name,l=e.displaycolor,r=l.substring(0,7);return n.color.setStyle(r),n.color.convertSRGBToLinear(),9===l.length&&(n.opacity=parseInt(l.charAt(7)+l.charAt(8),16)/255),n}function d(e,t,r,n){var l=new a.ZAu;for(let a=0;a<e.length;a++){var i=e[a];let o=t[i.objectId];void 0===o&&(h(i.objectId,t,r,n),o=t[i.objectId]);var s=o.clone();i=i.transform;i&&s.applyMatrix4(i),l.add(s)}return l}function h(e,r,a,n){if(e=a.resources.object[e],e.mesh){var l=e.mesh,i=a.extensions,s=a.xml,o=i,c=l,h=s;if(o){var v=[],g=Object.keys(o);for(let e=0;e<g.length;e++){var b=g[e];for(let e=0;e<t.availableExtensions.length;e++){var f=t.availableExtensions[e];f.ns===b&&v.push(f)}}for(let e=0;e<v.length;e++){var m=v[e];m.apply(h,o[m.ns],c)}}r[e.id]=p(l,r,a,n,e,u)}else i=e.components,r[e.id]=p(i,r,a,n,e,d);e.name&&(r[e.id].name=e.name)}e=function(e){let t,r,s=null,o=null;var u=[],p=[];let c;var d={},h={};try{s=n.GZ(new Uint8Array(e))}catch(e){if(e instanceof ReferenceError)return null}for(o in s)o.match(/\_rels\/.rels$/)?t=o:o.match(/3D\/_rels\/.*\.model\.rels$/)?r=o:o.match(/^3D\/.*\.model$/)?u.push(o):o.match(/^3D\/Textures?\/.*/)&&p.push(o);const v=s[t],g=a.Zp0.decodeText(v);if(e=l(g),r){const e=s[r],t=a.Zp0.decodeText(e);c=l(t)}for(let n=0;n<u.length;n++){var b=u[n],f=s[b],m=(f=a.Zp0.decodeText(f),f=(new DOMParser).parseFromString(f,"application/xml"),f.documentElement.nodeName.toLowerCase(),f.querySelector("model")),A={};for(let e=0;e<m.attributes.length;e++){var y=m.attributes[e];y.name.match(/^xmlns:(.+)$/)&&(A[y.value]=RegExp.$1)}f=function(e){var t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");return r&&(t.metadata=function(e){var t={};for(let n=0;n<e.length;n++){var r=e[n],a=r.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(a)&&(t[a]=r.textContent)}return t}(r)),r=e.querySelector("resources"),r&&(t.resources=function(e){var t={basematerials:{}},r=e.querySelectorAll("basematerials");for(let a=0;a<r.length;a++){var n=function(e){var t={id:e.getAttribute("id"),basematerials:[]},r=e.querySelectorAll("base");for(let n=0;n<r.length;n++){var a=function(e){var t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}(r[n]);a.index=n,t.basematerials.push(a)}return t}(r[a]);t.basematerials[n.id]=n}t.texture2d={};var l=e.querySelectorAll("texture2d");for(let a=0;a<l.length;a++){var s=function(e){return e={id:e.getAttribute("id"),path:e.getAttribute("path"),contenttype:e.getAttribute("contenttype"),tilestyleu:e.getAttribute("tilestyleu"),tilestylev:e.getAttribute("tilestylev"),filter:e.getAttribute("filter")},e}(l[a]);t.texture2d[s.id]=s}t.colorgroup={};var o=e.querySelectorAll("colorgroup");for(let i=0;i<o.length;i++){var u=function(e){var t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("color"),n=[],l=new a.Ilk;for(let a=0;a<r.length;a++){var i=r[a].getAttribute("color");l.setStyle(i.substring(0,7)),l.convertSRGBToLinear(),n.push(l.r,l.g,l.b)}return t.colors=new Float32Array(n),t}(o[i]);t.colorgroup[u.id]=u}t.pbmetallicdisplayproperties={};var p=e.querySelectorAll("pbmetallicdisplayproperties");for(let a=0;a<p.length;a++){var c=function(e){var t={id:e.getAttribute("id")},r=e.querySelectorAll("pbmetallic"),a=[];for(let l=0;l<r.length;l++){var n=r[l];a.push({name:n.getAttribute("name"),metallicness:parseFloat(n.getAttribute("metallicness")),roughness:parseFloat(n.getAttribute("roughness"))})}return t.data=a,t}(p[a]);t.pbmetallicdisplayproperties[c.id]=c}t.texture2dgroup={};var d=e.querySelectorAll("texture2dgroup");for(let a=0;a<d.length;a++){var h=function(e){var t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("tex2coord"),a=[];for(let i=0;i<r.length;i++){var n=r[i],l=n.getAttribute("u");n=n.getAttribute("v");a.push(parseFloat(l),parseFloat(n))}return t.uvs=new Float32Array(a),t}(d[a]);t.texture2dgroup[h.id]=h}t.object={};var v=e.querySelectorAll("object");for(let a=0;a<v.length;a++){var g=function(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");return r&&(t.id=r),r=e.getAttribute("pid"),r&&(t.pid=r),r=e.getAttribute("pindex"),r&&(t.pindex=r),r=e.getAttribute("thumbnail"),r&&(t.thumbnail=r),r=e.getAttribute("partnumber"),r&&(t.partnumber=r),r=e.getAttribute("name"),r&&(t.name=r),r=e.querySelector("mesh"),r&&(t.mesh=function(e){var t={},r=[],a=e.querySelectorAll("vertices vertex");for(let m=0;m<a.length;m++){var n=a[m],l=n.getAttribute("x"),i=n.getAttribute("y");n=n.getAttribute("z");r.push(parseFloat(l),parseFloat(i),parseFloat(n))}t.vertices=new Float32Array(r);var s=[],o=[],u=e.querySelectorAll("triangles triangle");for(let m=0;m<u.length;m++){var p=u[m],c=p.getAttribute("v1"),d=p.getAttribute("v2"),h=p.getAttribute("v3"),v=p.getAttribute("p1"),g=p.getAttribute("p2"),b=p.getAttribute("p3"),f=(p=p.getAttribute("pid"),{});f.v1=parseInt(c,10),f.v2=parseInt(d,10),f.v3=parseInt(h,10),o.push(f.v1,f.v2,f.v3),v&&(f.p1=parseInt(v,10)),g&&(f.p2=parseInt(g,10)),b&&(f.p3=parseInt(b,10)),p&&(f.pid=p),0<Object.keys(f).length&&s.push(f)}return t.triangleProperties=s,t.triangles=new Uint32Array(o),t}(r)),r=e.querySelector("components"),r&&(t.components=function(e){var t=[],r=e.querySelectorAll("component");for(let n=0;n<r.length;n++){var a=function(e){var t={};t.objectId=e.getAttribute("objectid"),e=e.getAttribute("transform");return e&&(t.transform=i(e)),t}(r[n]);t.push(a)}return t}(r)),t}(v[a]);t.object[g.id]=g}return t}(r)),r=e.querySelector("build"),r&&(t.build=function(e){var t=[],r=e.querySelectorAll("item");for(let l=0;l<r.length;l++){var a=r[l],n={objectId:a.getAttribute("objectid")};a=a.getAttribute("transform");a&&(n.transform=i(a)),t.push(n)}return t}(r)),t}(m),f.xml=m,0<Object.keys(A).length&&(f.extensions=A),d[b]=f}for(let a=0;a<p.length;a++){var w=p[a];h[w]=s[w].buffer}return{rels:e,modelRels:c,model:d,printTicket:{},texture:h}}(e);var v=function(e){var t=e.model,r=e.modelRels,a={},n=Object.keys(t),l={};if(r)for(let p=0,c=r.length;p<c;p++){var i=r[p],s=i.target.substring(1);e.texture[s]&&(l[i.target]=e.texture[s])}for(let p=0;p<n.length;p++){var o=t[n[p]],u=Object.keys(o.resources.object);for(let e=0;e<u.length;e++)h(u[e],a,o,l)}return a}(e),g=new a.ZAu,b=function(e){for(let r=0;r<e.length;r++){var t=e[r];if("model"===t.target.split(".").pop().toLowerCase())return t}}(e.rels),f=e.model[b.target.substring(1)].build;for(let a=0;a<f.length;a++){var m=f[a],A=v[m.objectId].clone();m=m.transform;m&&A.applyMatrix4(m),g.add(A)}return g}addExtension(e){this.availableExtensions.push(e)}}}}]);