"use strict";(self.webpackChunkthree_model_viewer=self.webpackChunkthree_model_viewer||[]).push([[225],{7225:function(e,t,s){s.r(t),s.d(t,{GLTFLoader:function(){return n}});var r=s(216);class n extends r.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new u(e)})),this.register((function(e){return new v(e)})),this.register((function(e){return new T(e)})),this.register((function(e){return new d(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new f(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new o(e)})),this.register((function(e){return new x(e)})),this.register((function(e){return new R(e)}))}load(e,t,s,n){const i=this;let a;function o(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.Zp0.extractUrlBase(e),this.manager.itemStart(e);var c=new r.hH6(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,(function(s){try{i.parse(s,a,(function(s){t(s),i.manager.itemEnd(e)}),o)}catch(s){o(s)}}),s,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let i;var o={},l={};if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(r.Zp0.decodeText(new Uint8Array(e,0,4))===A){try{o[a.KHR_BINARY_GLTF]=new E(e)}catch(e){return void(n&&n(e))}i=JSON.parse(o[a.KHR_BINARY_GLTF].content)}else i=JSON.parse(r.Zp0.decodeText(new Uint8Array(e)));else i=e;if(void 0===i.asset||i.asset.version[0]<2)n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var u=new V(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){var h=this.pluginCallbacks[e](u);o[(l[h.name]=h).name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){var d=i.extensionsUsed[e],m=i.extensionsRequired||[];switch(d){case a.KHR_MATERIALS_UNLIT:o[d]=new c;break;case a.KHR_DRACO_MESH_COMPRESSION:o[d]=new w(i,this.dracoLoader);break;case a.KHR_TEXTURE_TRANSFORM:o[d]=new y;break;case a.KHR_MESH_QUANTIZATION:o[d]=new S;break;default:m.indexOf(d)}}u.setExtensions(o),u.setPlugins(l),u.parse(s,n)}}parseAsync(e,t){const s=this;return new Promise((function(r,n){s.parse(e,t,r,n)}))}}function i(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const a={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class o{constructor(e){this.parser=e,this.name=a.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){var e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){var s=t[r];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){var t=this.parser,s="light:"+e,n=t.cache.get(s);if(!n){var i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;var o=new r.Ilk(16777215),c=(void 0!==a.color&&o.fromArray(a.color),void 0!==a.range?a.range:0);switch(a.type){case"directional":(l=new r.Ox3(o)).target.position.set(0,0,-1),l.add(l.target);break;case"point":(l=new r.cek(o)).distance=c;break;case"spot":(l=new r.PMe(o)).distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}l.position.set(0,0,0),l.decay=2,K(l,a),void 0!==a.intensity&&(l.intensity=a.intensity),l.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(l),t.cache.add(s,n)}return n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser;e=s.json.nodes[e];const r=(e.extensions&&e.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return s._getNodeRef(t.cache,r,e)}))}}class c{constructor(){this.name=a.KHR_MATERIALS_UNLIT}getMaterialType(){return r.vBJ}extendParams(e,t,s){var n,i=[];e.color=new r.Ilk(1,1,1),e.opacity=1,t=t.pbrMetallicRoughness;return t&&(Array.isArray(t.baseColorFactor)&&(n=t.baseColorFactor,e.color.fromArray(n),e.opacity=n[3]),void 0!==t.baseColorTexture)&&i.push(s.assignTexture(e,"map",t.baseColorTexture,r.knz)),Promise.all(i)}}class l{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]&&void 0!==(e=e.extensions[this.name].emissiveStrength)&&(t.emissiveIntensity=e),Promise.resolve()}}class u{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){return e=this.parser.json.materials[e],e.extensions&&e.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){var s,n=this.parser;e=n.json.materials[e];return e.extensions&&e.extensions[this.name]?(s=[],void 0!==(e=e.extensions[this.name]).clearcoatFactor&&(t.clearcoat=e.clearcoatFactor),void 0!==e.clearcoatTexture&&s.push(n.assignTexture(t,"clearcoatMap",e.clearcoatTexture)),void 0!==e.clearcoatRoughnessFactor&&(t.clearcoatRoughness=e.clearcoatRoughnessFactor),void 0!==e.clearcoatRoughnessTexture&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",e.clearcoatRoughnessTexture)),void 0!==e.clearcoatNormalTexture&&(s.push(n.assignTexture(t,"clearcoatNormalMap",e.clearcoatNormalTexture)),void 0!==e.clearcoatNormalTexture.scale)&&(n=e.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new r.FM8(n,n)),Promise.all(s)):Promise.resolve()}}class h{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){return e=this.parser.json.materials[e],e.extensions&&e.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){var s,r=this.parser;e=r.json.materials[e];return e.extensions&&e.extensions[this.name]?(s=[],void 0!==(e=e.extensions[this.name]).iridescenceFactor&&(t.iridescence=e.iridescenceFactor),void 0!==e.iridescenceTexture&&s.push(r.assignTexture(t,"iridescenceMap",e.iridescenceTexture)),void 0!==e.iridescenceIor&&(t.iridescenceIOR=e.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==e.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=e.iridescenceThicknessMinimum),void 0!==e.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=e.iridescenceThicknessMaximum),void 0!==e.iridescenceThicknessTexture&&s.push(r.assignTexture(t,"iridescenceThicknessMap",e.iridescenceThicknessTexture)),Promise.all(s)):Promise.resolve()}}class d{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SHEEN}getMaterialType(e){return e=this.parser.json.materials[e],e.extensions&&e.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){var s,n=this.parser;e=n.json.materials[e];return e.extensions&&e.extensions[this.name]?(s=[],t.sheenColor=new r.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1,void 0!==(e=e.extensions[this.name]).sheenColorFactor&&t.sheenColor.fromArray(e.sheenColorFactor),void 0!==e.sheenRoughnessFactor&&(t.sheenRoughness=e.sheenRoughnessFactor),void 0!==e.sheenColorTexture&&s.push(n.assignTexture(t,"sheenColorMap",e.sheenColorTexture,r.knz)),void 0!==e.sheenRoughnessTexture&&s.push(n.assignTexture(t,"sheenRoughnessMap",e.sheenRoughnessTexture)),Promise.all(s)):Promise.resolve()}}class m{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){return e=this.parser.json.materials[e],e.extensions&&e.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){var s,r=this.parser;e=r.json.materials[e];return e.extensions&&e.extensions[this.name]?(s=[],void 0!==(e=e.extensions[this.name]).transmissionFactor&&(t.transmission=e.transmissionFactor),void 0!==e.transmissionTexture&&s.push(r.assignTexture(t,"transmissionMap",e.transmissionTexture)),Promise.all(s)):Promise.resolve()}}class p{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_VOLUME}getMaterialType(e){return e=this.parser.json.materials[e],e.extensions&&e.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){var s,n=this.parser;e=n.json.materials[e];return e.extensions&&e.extensions[this.name]?(s=[],e=e.extensions[this.name],t.thickness=void 0!==e.thicknessFactor?e.thicknessFactor:0,void 0!==e.thicknessTexture&&s.push(n.assignTexture(t,"thicknessMap",e.thicknessTexture)),t.attenuationDistance=e.attenuationDistance||1/0,n=e.attenuationColor||[1,1,1],t.attenuationColor=new r.Ilk(n[0],n[1],n[2]),Promise.all(s)):Promise.resolve()}}class f{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IOR}getMaterialType(e){return e=this.parser.json.materials[e],e.extensions&&e.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]&&(e=e.extensions[this.name],t.ior=void 0!==e.ior?e.ior:1.5),Promise.resolve()}}class g{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SPECULAR}getMaterialType(e){return e=this.parser.json.materials[e],e.extensions&&e.extensions[this.name]?r.EJi:null}extendMaterialParams(e,t){var s,n,i=this.parser;e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(s=[],e=e.extensions[this.name],t.specularIntensity=void 0!==e.specularFactor?e.specularFactor:1,void 0!==e.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",e.specularTexture)),n=e.specularColorFactor||[1,1,1],t.specularColor=new r.Ilk(n[0],n[1],n[2]),void 0!==e.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",e.specularColorTexture,r.knz)),Promise.all(s)):Promise.resolve()}}class v{constructor(e){this.parser=e,this.name=a.KHR_TEXTURE_BASISU}loadTexture(e){var t=this.parser,s=t.json,r=s.textures[e];if(r.extensions&&r.extensions[this.name]){r=r.extensions[this.name];var n=t.options.ktx2Loader;if(n)return t.loadTextureImage(e,r.source,n);if(s.extensionsRequired&&0<=s.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return null}}class T{constructor(e){this.parser=e,this.name=a.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,r=s.json;var n=r.textures[e];if(!n.extensions||!n.extensions[t])return null;const i=n.extensions[t];n=r.images[i.source];let a=s.textureLoader;return n.uri&&null!==(n=s.options.manager.getHandler(n.uri))&&(a=n),this.detectSupport().then((function(n){if(n)return s.loadTextureImage(e,i.source,a);if(r.extensionsRequired&&0<=r.extensionsRequired.indexOf(t))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class x{constructor(e){this.name=a.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){var t=this.parser.json;e=t.bufferViews[e];if(e.extensions&&e.extensions[this.name]){const s=e.extensions[this.name];e=this.parser.getDependency("buffer",s.buffer);const r=this.parser.options.meshoptDecoder;if(r&&r.supported)return e.then((function(e){var t=s.byteOffset||0,n=s.byteLength||0;const i=s.count,a=s.byteStride,o=new Uint8Array(e,t,n);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(i,a,o,s.mode,s.filter).then((function(e){return e.buffer})):r.ready.then((function(){var e=new ArrayBuffer(i*a);return r.decodeGltfBuffer(new Uint8Array(e),i,a,o,s.mode,s.filter),e}))}));if(t.extensionsRequired&&0<=t.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return null}}class R{constructor(e){this.name=a.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){var t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;for(const r of t.meshes[s.mesh].primitives)if(r.mode!==b.TRIANGLES&&r.mode!==b.TRIANGLE_STRIP&&r.mode!==b.TRIANGLE_FAN&&void 0!==r.mode)return null;var n=s.extensions[this.name].attributes,i=[];const a={};for(const r in n)i.push(this.parser.getDependency("accessor",n[r]).then((e=>(a[r]=e,a[r]))));return i.length<1?null:(i.push(this.parser.createNodeMesh(e)),Promise.all(i).then((e=>{var t=e.pop(),s=t.isGroup?t.children:[t],n=e[0].count,i=[];for(const d of s){var o=new r.yGw,c=new r.Pa4,l=new r._fP,u=new r.Pa4(1,1,1),h=new r.SPe(d.geometry,d.material,n);for(let e=0;e<n;e++)a.TRANSLATION&&c.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&l.fromBufferAttribute(a.ROTATION,e),a.SCALE&&u.fromBufferAttribute(a.SCALE,e),h.setMatrixAt(e,o.compose(c,l,u));for(const e in a)"TRANSLATION"!==e&&"ROTATION"!==e&&"SCALE"!==e&&d.geometry.setAttribute(e,a[e]);r.Tme.prototype.copy.call(h,d),h.frustumCulled=!1,this.parser.assignFinalMaterial(h),i.push(h)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]})))}}const A="glTF",_={JSON:1313821514,BIN:5130562};class E{constructor(e){this.name=a.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:r.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==A)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var s=this.header.length-12,n=new DataView(e,12);let i=0;for(;i<s;){var o,c=n.getUint32(i,!0),l=(i+=4,n.getUint32(i,!0));i+=4,l===_.JSON?(o=new Uint8Array(e,12+i,c),this.content=r.Zp0.decodeText(o)):l===_.BIN&&(o=12+i,this.body=e.slice(o,o+c)),i+=c}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class w{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=a.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){var s=this.json;const r=this.dracoLoader;var n=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes;const a={},o={},c={};for(const m in i){var l=k[m]||m.toLowerCase();a[l]=i[m]}for(const m in e.attributes){var u,h,d=k[m]||m.toLowerCase();void 0!==i[m]&&(u=s.accessors[e.attributes[m]],h=N[u.componentType],c[d]=h.name,o[d]=!0===u.normalized)}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){var s=e.attributes[t],r=o[t];void 0!==r&&(s.normalized=r)}t(e)}),a,c)}))}))}}class y{constructor(){this.name=a.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord,void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class S{constructor(){this.name=a.KHR_MESH_QUANTIZATION}}class L extends r._C8{constructor(e,t,s,r){super(e,t,s,r)}copySampleValue_(e){var t=this.resultBuffer,s=this.sampleValues,r=this.valueSize,n=e*r*3+r;for(let i=0;i!==r;i++)t[i]=s[n+i];return t}interpolate_(e,t,s,r){var n=this.resultBuffer,i=this.sampleValues,a=this.valueSize,o=2*a,c=3*a,l=r-t,u=(r=(s-t)/l,s=r*r,t=s*r,e*c),h=u-c,d=-2*t+3*s,m=t-s,p=1-d,f=m-s+r;for(let R=0;R!==a;R++){var g=i[h+R+a],v=i[h+R+o]*l,T=i[u+R+a],x=i[u+R]*l;n[R]=p*g+f*v+d*T+m*x}return n}}const I=new r._fP;class M extends L{interpolate_(e,t,s,r){return e=super.interpolate_(e,t,s,r),I.fromArray(e).normalize().toArray(e),e}}const b={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},N={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},O={9728:r.TyD,9729:r.wem,9984:r.YLQ,9985:r.qyh,9986:r.aH4,9987:r.D1R},P={33071:r.uWy,33648:r.OoA,10497:r.rpg},C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},H={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},F={CUBICSPLINE:void 0,LINEAR:r.NMF,STEP:r.Syv},D={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function U(e,t,s){for(const r in s.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=s.extensions[r])}function K(e,t){void 0!==t.extras&&"object"==typeof t.extras&&Object.assign(e.userData,t.extras)}function j(e){let t="";var s=Object.keys(e).sort();for(let r=0,n=s.length;r<n;r++)t+=s[r]+":"+e[s[r]]+";";return t}function G(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const B=new r.yGw;class V{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new i,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={};let s=!(this.nodeNamesUsed={}),n=!1,a=-1;"undefined"!=typeof navigator&&(s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=-1<navigator.userAgent.indexOf("Firefox"),a=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||s||n&&a<98?this.textureLoader=new r.dpR(this.options.manager):this.textureLoader=new r.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new r.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,r=this.json,n=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(t){const i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:s,userData:{}};U(n,i,r),K(i,r),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(i)}))).then((function(){e(i)}))})).catch(t)}_markDefs(){var e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let i=0,a=t.length;i<a;i++){var r=t[i].joints;for(let t=0,s=r.length;t<s;t++)e[r[t]].isBone=!0}for(let i=0,a=e.length;i<a;i++){var n=e[i];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin)&&(s[n.mesh].isSkinnedMesh=!0),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;var r=s.clone();const n=(e,t)=>{var s,r,i=this.associations.get(e);for([s,r]of(null!=i&&this.associations.set(t,i),e.children.entries()))n(r,t.children[s])};return n(s,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){var t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){var s=e(t[r]);if(s)return s}return null}_invokeAll(e){var t=Object.values(this.plugins),s=(t.unshift(this),[]);for(let n=0;n<t.length;n++){var r=e(t[n]);r&&s.push(r)}return s}getDependency(e,t){var s=e+":"+t;let r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne((function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)})))break;throw new Error("Unknown type: "+e)}this.cache.add(s,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this;var s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map((function(t,s){return r.getDependency(e,s)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[a.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,i){s.load(r.Zp0.resolveURL(t.uri,n.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var s=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+s)}))}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];var i,a;return void 0===n.bufferView&&void 0===n.sparse?(e=C[n.type],a=N[n.componentType],i=!0===n.normalized,a=new a(n.count*e),Promise.resolve(new r.TlE(a,e,i))):(a=[],void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then((function(e){var i=e[0],a=C[n.type],o=N[n.componentType],c=o.BYTES_PER_ELEMENT,l=c*a,u=n.byteOffset||0,h=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;let m,p;if(h&&h!==l){l=Math.floor(u/h);var f="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+l+":"+n.count;let e=t.cache.get(f);e||(m=new o(i,l*h,n.count*h/c),e=new r.vpT(m,h/c),t.cache.add(f,e)),p=new r.kB5(e,a,u%h/c,d)}else m=null===i?new o(n.count*a):new o(i,u,n.count*a),p=new r.TlE(m,a,d);if(void 0!==n.sparse){l=C.SCALAR,f=N[n.sparse.indices.componentType],h=n.sparse.indices.byteOffset||0,c=n.sparse.values.byteOffset||0;var g=new f(e[1],h,n.sparse.count*l),v=new o(e[2],c,n.sparse.count*a);null!==i&&(p=new r.TlE(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=g.length;e<t;e++){var T=g[e];if(p.setX(T,v[e*a]),2<=a&&p.setY(T,v[e*a+1]),3<=a&&p.setZ(T,v[e*a+2]),4<=a&&p.setW(T,v[e*a+3]),5<=a)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})))}loadTexture(e){var t=this.json,s=this.options,r=t.textures[e].source;t=t.images[r];let n=this.textureLoader;return t.uri&&null!==(s=s.manager.getHandler(t.uri))&&(n=s),this.loadTextureImage(e,r,n)}loadTextureImage(e,t,s){const n=this,i=this.json,a=i.textures[e],o=i.images[t];var c=(o.uri||o.bufferView)+":"+a.sampler;return this.textureCache[c]||(t=this.loadImageSource(t,s).then((function(t){t.flipY=!1,t.name=a.name||o.name||"";var s=(i.samplers||{})[a.sampler]||{};return t.magFilter=O[s.magFilter]||r.wem,t.minFilter=O[s.minFilter]||r.D1R,t.wrapS=P[s.wrapS]||r.rpg,t.wrapT=P[s.wrapT]||r.rpg,n.associations.set(t,{textures:e}),t})).catch((function(){return null})),this.textureCache[c]=t)}loadImageSource(e,t){var s=this.json;const n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const i=s.images[e],a=self.URL||self.webkitURL;let o=i.uri||"",c=!1;if(void 0!==i.bufferView)o=this.getDependency("bufferView",i.bufferView).then((function(e){return c=!0,e=new Blob([e],{type:i.mimeType}),o=a.createObjectURL(e)}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return s=Promise.resolve(o).then((function(e){return new Promise((function(s,i){let a=s;!0===t.isImageBitmapLoader&&(a=function(e){e=new r.xEZ(e),e.needsUpdate=!0,s(e)}),t.load(r.Zp0.resolveURL(e,n.path),a,void 0,i)}))})).then((function(e){var t;return!0===c&&a.revokeObjectURL(o),e.userData.mimeType=i.mimeType||(0<(t=i.uri).search(/\.jpe?g($|\?)/i)||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":0<t.search(/\.webp($|\?)/i)||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw e})),this.sourceCache[e]=s}assignTexture(e,t,s,r){const n=this;return this.getDependency("texture",s.index).then((function(i){var o,c;return i?(void 0!==s.texCoord&&0!=s.texCoord&&"aoMap"===t&&s.texCoord,n.extensions[a.KHR_TEXTURE_TRANSFORM]&&(o=void 0!==s.extensions?s.extensions[a.KHR_TEXTURE_TRANSFORM]:void 0)&&(c=n.associations.get(i),i=n.extensions[a.KHR_TEXTURE_TRANSFORM].extendTexture(i,o),n.associations.set(i,c)),void 0!==r&&(i.encoding=r),e[t]=i):null}))}assignFinalMaterial(e){var t=e.geometry;let s=e.material;var n=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){var o="PointsMaterial:"+s.uuid;let e=this.cache.get(o);e||(e=new r.UY4,r.F5T.prototype.copy.call(e,s),e.color.copy(s.color),e.map=s.map,e.sizeAttenuation=!1,this.cache.add(o,e)),s=e}else if(e.isLine){o="LineBasicMaterial:"+s.uuid;let e=this.cache.get(o);e||(e=new r.nls,r.F5T.prototype.copy.call(e,s),e.color.copy(s.color),this.cache.add(o,e)),s=e}if(n||i||a){let e="ClonedMaterial:"+s.uuid+":",t=(n&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),a&&(e+="flat-shading:"),this.cache.get(e));t||(t=s.clone(),i&&(t.vertexColors=!0),a&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale)&&(t.clearcoatNormalScale.y*=-1),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return r.Wid}loadMaterial(e){const t=this;var s=this.json;const n=this.extensions,i=s.materials[e];let o;const c={};s=[];var l,u=((i.extensions||{})[a.KHR_MATERIALS_UNLIT]?(l=n[a.KHR_MATERIALS_UNLIT],o=l.getMaterialType(),s.push(l.extendParams(c,i,t))):(l=i.pbrMetallicRoughness||{},c.color=new r.Ilk(1,1,1),c.opacity=1,Array.isArray(l.baseColorFactor)&&(u=l.baseColorFactor,c.color.fromArray(u),c.opacity=u[3]),void 0!==l.baseColorTexture&&s.push(t.assignTexture(c,"map",l.baseColorTexture,r.knz)),c.metalness=void 0!==l.metallicFactor?l.metallicFactor:1,c.roughness=void 0!==l.roughnessFactor?l.roughnessFactor:1,void 0!==l.metallicRoughnessTexture&&(s.push(t.assignTexture(c,"metalnessMap",l.metallicRoughnessTexture)),s.push(t.assignTexture(c,"roughnessMap",l.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),s.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,c)}))))),!0===i.doubleSided&&(c.side=r.ehD),i.alphaMode||D.OPAQUE);return u===D.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,u===D.MASK&&(c.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&o!==r.vBJ&&(s.push(t.assignTexture(c,"normalMap",i.normalTexture)),c.normalScale=new r.FM8(1,1),void 0!==i.normalTexture.scale)&&(l=i.normalTexture.scale,c.normalScale.set(l,l)),void 0!==i.occlusionTexture&&o!==r.vBJ&&(s.push(t.assignTexture(c,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength)&&(c.aoMapIntensity=i.occlusionTexture.strength),void 0!==i.emissiveFactor&&o!==r.vBJ&&(c.emissive=(new r.Ilk).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&o!==r.vBJ&&s.push(t.assignTexture(c,"emissiveMap",i.emissiveTexture,r.knz)),Promise.all(s).then((function(){var s=new o(c);return i.name&&(s.name=i.name),K(s,i),t.associations.set(s,{materials:e}),i.extensions&&U(n,s,i),s}))}createUniqueName(e){var t=r.iUV.sanitizeNodeName(e||"");let s=t;for(let r=1;this.nodeNamesUsed[s];++r)s=t+"_"+r;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions;var n=this.primitiveCache,i=[];for(let u=0,h=e.length;u<h;u++){var o=e[u],c=function(e){var t=e.extensions&&e.extensions[a.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+j(t.attributes):e.indices+":"+j(e.attributes)+":"+e.mode}(o),l=n[c];if(l)i.push(l.promise);else{let e;e=o.extensions&&o.extensions[a.KHR_DRACO_MESH_COMPRESSION]?function(e){return s[a.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return X(s,e,t)}))}(o):X(new r.u9r,o,t),n[c]={primitive:o,promise:e},i.push(e)}}return Promise.all(i)}loadMesh(e){const t=this;var s=this.json;const n=this.extensions,i=s.meshes[e],a=i.primitives;var o=[];for(let l=0,u=a.length;l<u;l++){var c=void 0===a[l].material?(void 0===(c=this.cache).DefaultMaterial&&(c.DefaultMaterial=new r.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.Wl3})),c.DefaultMaterial):this.getDependency("material",a[l].material);o.push(c)}return o.push(t.loadGeometries(a)),Promise.all(o).then((function(s){var o=s.slice(0,s.length-1),c=s[s.length-1],l=[];for(let v=0,T=c.length;v<T;v++){var u=c[v],h=a[v];let s;var d=o[v];if(h.mode===b.TRIANGLES||h.mode===b.TRIANGLE_STRIP||h.mode===b.TRIANGLE_FAN||void 0===h.mode)!0!==(s=new(!0===i.isSkinnedMesh?r.TUv:r.Kj0)(u,d)).isSkinnedMesh||s.geometry.attributes.skinWeight.normalized||s.normalizeSkinWeights(),h.mode===b.TRIANGLE_STRIP?s.geometry=z(s.geometry,r.UlW):h.mode===b.TRIANGLE_FAN&&(s.geometry=z(s.geometry,r.z$h));else if(h.mode===b.LINES)s=new r.ejS(u,d);else if(h.mode===b.LINE_STRIP)s=new r.x12(u,d);else if(h.mode===b.LINE_LOOP)s=new r.blk(u,d);else{if(h.mode!==b.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);s=new r.woe(u,d)}if(0<Object.keys(s.geometry.morphAttributes).length){f=p=m=void 0;var m=s,p=i;if(m.updateMorphTargets(),void 0!==p.weights)for(let e=0,t=p.weights.length;e<t;e++)m.morphTargetInfluences[e]=p.weights[e];if(p.extras&&Array.isArray(p.extras.targetNames)){var f=p.extras.targetNames;if(m.morphTargetInfluences.length===f.length){m.morphTargetDictionary={};for(let e=0,t=f.length;e<t;e++)m.morphTargetDictionary[f[e]]=e}}}s.name=t.createUniqueName(i.name||"mesh_"+e),K(s,i),h.extensions&&U(n,s,h),t.assignFinalMaterial(s),l.push(s)}for(let r=0,n=l.length;r<n;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return l[0];var g=new r.ZAu;t.associations.set(g,{meshes:e});for(let e=0,t=l.length;e<t;e++)g.add(l[e]);return g}))}loadCamera(e){let t;e=this.json.cameras[e];var s=e[e.type];if(s)return"perspective"===e.type?t=new r.cPb(r.M8C.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===e.type&&(t=new r.iKG(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),e.name&&(t.name=this.createUniqueName(e.name)),K(t,e),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e];var s=[];for(let r=0,n=t.joints.length;r<n;r++)s.push(this.getDependency("node",t.joints[r]));return void 0!==t.inverseBindMatrices?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then((function(e){var t=e.pop(),s=e,n=[],i=[];for(let o=0,c=s.length;o<c;o++){var a=s[o];a&&(n.push(a),a=new r.yGw,null!==t&&a.fromArray(t.array,16*o),i.push(a))}return new r.OdW(n,i)}))}loadAnimation(e){const t=this.json.animations[e];var s=[],n=[],i=[],a=[],o=[];for(let r=0,m=t.channels.length;r<m;r++){var c=t.channels[r],l=t.samplers[c.sampler],u=(c=c.target,c.node),h=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;s.push(this.getDependency("node",u)),n.push(this.getDependency("accessor",h)),i.push(this.getDependency("accessor",d)),a.push(l),o.push(c)}return Promise.all([Promise.all(s),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o)]).then((function(s){var n=s[0],i=s[1],a=s[2],o=s[3],c=s[4],l=[];for(let e=0,t=n.length;e<t;e++){var u=n[e],h=i[e],d=a[e],m=o[e],p=c[e];if(void 0!==u){let e;switch(u.updateMatrix(),H[p.path]){case H.weights:e=r.dUE;break;case H.rotation:e=r.iLg;break;case H.position:case H.scale:default:e=r.yC1}var f=u.name||u.uuid,g=void 0!==m.interpolation?F[m.interpolation]:r.NMF;const t=[];H[p.path]===H.weights?u.traverse((function(e){e.morphTargetInfluences&&t.push(e.name||e.uuid)})):t.push(f);let s=d.array;if(d.normalized){var v=G(s.constructor),T=new Float32Array(s.length);for(let e=0,t=s.length;e<t;e++)T[e]=s[e]*v;s=T}for(let n=0,i=t.length;n<i;n++){var x=new e(t[n]+"."+H[p.path],h.array,s,g);"CUBICSPLINE"===m.interpolation&&(x.createInterpolant=function(e){return new(this instanceof r.iLg?M:L)(this.times,this.values,this.getValueSize()/3,e)},x.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(x)}}}return s=t.name||"animation_"+e,new r.m7l(s,void 0,l)}))}createNodeMesh(e){var t=this.json;const s=this,r=t.nodes[e];return void 0===r.mesh?null:s.getDependency("mesh",r.mesh).then((function(e){return e=s._getNodeRef(s.meshCache,r.mesh,e),void 0!==r.weights&&e.traverse((function(e){if(e.isMesh)for(let t=0,s=r.weights.length;t<s;t++)e.morphTargetInfluences[t]=r.weights[t]})),e}))}loadNode(e){var t=this.json;const s=this.extensions,n=this,i=t.nodes[e],a=i.name?n.createUniqueName(i.name):"";return function(){const t=[];var s=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)})),r=(s&&t.push(s),void 0!==i.camera&&t.push(n.getDependency("camera",i.camera).then((function(e){return n._getNodeRef(n.cameraCache,i.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),[]),a=i.children||[];for(let e=0,i=a.length;e<i;e++)r.push(n.getDependency("node",a[e]));return s=void 0===i.skin?Promise.resolve(null):n.getDependency("skin",i.skin),Promise.all([Promise.all(t),Promise.all(r),s])}().then((function(t){var o=t[0],c=t[1];const l=t[2];let u;if((u=!0===i.isBone?new r.N$j:1<o.length?new r.ZAu:1===o.length?o[0]:new r.Tme)!==o[0])for(let e=0,s=o.length;e<s;e++)u.add(o[e]);i.name&&(u.userData.name=i.name,u.name=a),K(u,i),i.extensions&&U(s,u,i),void 0!==i.matrix?((t=new r.yGw).fromArray(i.matrix),u.applyMatrix4(t)):(void 0!==i.translation&&u.position.fromArray(i.translation),void 0!==i.rotation&&u.quaternion.fromArray(i.rotation),void 0!==i.scale&&u.scale.fromArray(i.scale)),n.associations.has(u)||n.associations.set(u,{}),n.associations.get(u).nodes=e,null!==l&&u.traverse((function(e){e.isSkinnedMesh&&e.bind(l,B)}));for(let e=0,s=c.length;e<s;e++)u.add(c[e]);return u}))}loadScene(e){var t=this.extensions;e=this.json.scenes[e];const s=this,n=new r.ZAu;e.name&&(n.name=s.createUniqueName(e.name)),K(n,e),e.extensions&&U(t,n,e);var i=e.nodes||[],a=[];for(let r=0,o=i.length;r<o;r++)a.push(s.getDependency("node",i[r]));return Promise.all(a).then((function(e){for(let t=0,s=e.length;t<s;t++)n.add(e[t]);return s.associations=(e=>{const t=new Map;for(var[n,i]of s.associations)(n instanceof r.F5T||n instanceof r.xEZ)&&t.set(n,i);return e.traverse((e=>{var r=s.associations.get(e);null!=r&&t.set(e,r)})),t})(n),n}))}}function X(e,t,s){var n=t.attributes,i=[];for(const r in n){var a=k[r]||r.toLowerCase();a in e.attributes||i.push(function(t,r){return s.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}(n[r],a))}void 0===t.indices||e.index||(o=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)})),i.push(o)),K(e,t);var o=e,c=t,l=s,u=c.attributes,h=new r.ZzF;if(void 0!==u.POSITION){u=l.json.accessors[u.POSITION];var d=u.min,m=u.max;if(void 0!==d&&void 0!==m){h.set(new r.Pa4(d[0],d[1],d[2]),new r.Pa4(m[0],m[1],m[2])),u.normalized&&(d=G(N[u.componentType]),h.min.multiplyScalar(d),h.max.multiplyScalar(d));var p=c.targets;if(void 0!==p){var f=new r.Pa4,g=new r.Pa4;for(let e=0,t=p.length;e<t;e++){var v,T,x=p[e];void 0!==x.POSITION&&(T=(x=l.json.accessors[x.POSITION]).min,v=x.max,void 0!==T)&&void 0!==v&&(g.setX(Math.max(Math.abs(T[0]),Math.abs(v[0]))),g.setY(Math.max(Math.abs(T[1]),Math.abs(v[1]))),g.setZ(Math.max(Math.abs(T[2]),Math.abs(v[2]))),x.normalized&&(T=G(N[x.componentType]),g.multiplyScalar(T)),f.max(g))}h.expandByVector(f)}o.boundingBox=h,m=new r.aLr,h.getCenter(m.center),m.radius=h.min.distanceTo(h.max)/2,o.boundingSphere=m}}return Promise.all(i).then((function(){if(void 0===t.targets)return e;{var r=e,n=t.targets,i=s;let d=!1,m=!1,p=!1;for(let e=0,t=n.length;e<t;e++){var a=n[e];if(void 0!==a.POSITION&&(d=!0),void 0!==a.NORMAL&&(m=!0),void 0!==a.COLOR_0&&(p=!0),d&&m&&p)break}if(!d&&!m&&!p)return Promise.resolve(r);var o=[],c=[],l=[];for(let e=0,t=n.length;e<t;e++){var u,h=n[e];d&&(u=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):r.attributes.position,o.push(u)),m&&(u=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):r.attributes.normal,c.push(u)),p&&(h=void 0!==h.COLOR_0?i.getDependency("accessor",h.COLOR_0):r.attributes.color,l.push(h))}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(l)]).then((function(e){var t=e[0],s=e[1];e=e[2];return d&&(r.morphAttributes.position=t),m&&(r.morphAttributes.normal=s),p&&(r.morphAttributes.color=e),r.morphTargetsRelative=!0,r}))}}))}function z(e,t){let s=e.getIndex();if(null===s){var n=[],i=e.getAttribute("position");if(void 0===i)return e;for(let e=0;e<i.count;e++)n.push(e);e.setIndex(n),s=e.getIndex()}var a=s.count-2,o=[];if(t===r.z$h)for(let r=1;r<=a;r++)o.push(s.getX(0)),o.push(s.getX(r)),o.push(s.getX(r+1));else for(let r=0;r<a;r++)r%2==0?(o.push(s.getX(r)),o.push(s.getX(r+1)),o.push(s.getX(r+2))):(o.push(s.getX(r+2)),o.push(s.getX(r+1)),o.push(s.getX(r)));return t=e.clone(),t.setIndex(o),t}}}]);