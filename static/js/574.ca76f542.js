"use strict";(self["webpackChunkthree_model_viewer"]=self["webpackChunkthree_model_viewer"]||[]).push([[574],{2574:function(e,t,n){n.r(t),n.d(t,{AMFLoader:function(){return l}});var o=n(277),a=n(5683);class l extends o.aNw{constructor(e){super(e)}load(e,t,n,a){const l=this,r=new o.hH6(l.manager);r.setPath(l.path),r.setResponseType("arraybuffer"),r.setRequestHeader(l.requestHeader),r.setWithCredentials(l.withCredentials),r.load(e,(function(n){try{t(l.parse(n))}catch(o){a?a(o):console.error(o),l.manager.itemError(e)}}),n,a)}parse(e){function t(e){let t=new DataView(e);const n=String.fromCharCode(t.getUint8(0),t.getUint8(1));if("PK"===n){let n=null,o=null;console.log("THREE.AMFLoader: Loading Zip");try{n=a.GZ(new Uint8Array(e))}catch(i){if(i instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(o in n)if(".amf"===o.toLowerCase().slice(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+o),t=new DataView(n[o].buffer)}const l=o.Zp0.decodeText(t),r=(new DOMParser).parseFromString(l,"application/xml");return"amf"!==r.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):r}function n(e){let t=1,n="millimeter";void 0!==e.documentElement.attributes.unit&&(n=e.documentElement.attributes.unit.value.toLowerCase());const o={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==o[n]&&(t=o[n]),console.log("THREE.AMFLoader: Unit scale: "+t),t}function l(e){let t="AMF Material";const n=e.attributes.id.textContent;let a={r:1,g:1,b:1,a:1},l=null;for(let o=0;o<e.childNodes.length;o++){const n=e.childNodes[o];"metadata"===n.nodeName&&void 0!==n.attributes.type?"name"===n.attributes.type.value&&(t=n.textContent):"color"===n.nodeName&&(a=r(n))}return l=new o.xoR({flatShading:!0,color:new o.Ilk(a.r,a.g,a.b),name:t}),1!==a.a&&(l.transparent=!0,l.opacity=a.a),{id:n,material:l}}function r(e){const t={r:1,g:1,b:1,a:1};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];"r"===o.nodeName?t.r=o.textContent:"g"===o.nodeName?t.g=o.textContent:"b"===o.nodeName?t.b=o.textContent:"a"===o.nodeName&&(t.a=o.textContent)}return t}function i(e){const t={name:"",triangles:[],materialid:null};let n=e.firstElementChild;void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);while(n){if("metadata"===n.nodeName)void 0!==n.attributes.type&&"name"===n.attributes.type.value&&(t.name=n.textContent);else if("triangle"===n.nodeName){const e=n.getElementsByTagName("v1")[0].textContent,o=n.getElementsByTagName("v2")[0].textContent,a=n.getElementsByTagName("v3")[0].textContent;t.triangles.push(e,o,a)}n=n.nextElementSibling}return t}function s(e){const t=[],n=[];let o=e.firstElementChild;while(o){if("vertex"===o.nodeName){let e=o.firstElementChild;while(e){if("coordinates"===e.nodeName){const n=e.getElementsByTagName("x")[0].textContent,o=e.getElementsByTagName("y")[0].textContent,a=e.getElementsByTagName("z")[0].textContent;t.push(n,o,a)}else if("normal"===e.nodeName){const t=e.getElementsByTagName("nx")[0].textContent,o=e.getElementsByTagName("ny")[0].textContent,a=e.getElementsByTagName("nz")[0].textContent;n.push(t,o,a)}e=e.nextElementSibling}}o=o.nextElementSibling}return{vertices:t,normals:n}}function m(e){const t=e.attributes.id.textContent,n={name:"amfobject",meshes:[]};let o=null,a=e.firstElementChild;while(a){if("metadata"===a.nodeName)void 0!==a.attributes.type&&"name"===a.attributes.type.value&&(n.name=a.textContent);else if("color"===a.nodeName)o=r(a);else if("mesh"===a.nodeName){let e=a.firstElementChild;const t={vertices:[],normals:[],volumes:[],color:o};while(e){if("vertices"===e.nodeName){const n=s(e);t.normals=t.normals.concat(n.normals),t.vertices=t.vertices.concat(n.vertices)}else"volume"===e.nodeName&&t.volumes.push(i(e));e=e.nextElementSibling}n.meshes.push(t)}a=a.nextElementSibling}return{id:t,obj:n}}const c=t(e);let d="",u="";const f=n(c),g={},h={},b=c.documentElement.childNodes;let E,N;for(E=0;E<b.length;E++){const e=b[E];if("metadata"===e.nodeName)void 0!==e.attributes.type&&("name"===e.attributes.type.value?d=e.textContent:"author"===e.attributes.type.value&&(u=e.textContent));else if("material"===e.nodeName){const t=l(e);g[t.id]=t.material}else if("object"===e.nodeName){const t=m(e);h[t.id]=t.obj}}const p=new o.ZAu,x=new o.xoR({color:11184895,flatShading:!0});p.name=d,p.userData.author=u,p.userData.loader="AMF";for(const a in h){const e=h[a],t=e.meshes,n=new o.ZAu;for(n.name=e.name||"",E=0;E<t.length;E++){let e=x;const a=t[E],l=new o.a$l(a.vertices,3);let r=null;if(a.normals.length&&(r=new o.a$l(a.normals,3)),a.color){const t=a.color;e=x.clone(),e.color=new o.Ilk(t.r,t.g,t.b),1!==t.a&&(e.transparent=!0,e.opacity=t.a)}const i=a.volumes;for(N=0;N<i.length;N++){const t=i[N],a=new o.u9r;let s=e;a.setIndex(t.triangles),a.setAttribute("position",l.clone()),r&&a.setAttribute("normal",r.clone()),void 0!==g[t.materialId]&&(s=g[t.materialId]),a.scale(f,f,f),n.add(new o.Kj0(a,s.clone()))}}p.add(n)}return p}}}}]);
//# sourceMappingURL=574.ca76f542.js.map