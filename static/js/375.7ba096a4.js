"use strict";(self.webpackChunkthree_model_viewer=self.webpackChunkthree_model_viewer||[]).push([[375],{375:function(e,t,r){r.r(t),r.d(t,{FBXLoader:function(){return d}});var a=r(216),n=r(6925);function i(e,t,r){var a=r.length-e-1;if(t>=r[a])return a-1;if(t<=r[e])return e;let n=e,i=a,s=Math.floor((n+i)/2);for(;t<r[s]||t>=r[s+1];)t<r[s]?i=s:n=s,s=Math.floor((n+i)/2);return s}function s(e,t,r,a){var n=[],i=[],s=[];for(let u=n[0]=1;u<=r;++u){i[u]=t-a[e+1-u],s[u]=a[e+u]-t;let r=0;for(let e=0;e<u;++e){var o=s[e+1],l=i[u-e],c=n[e]/(o+l);n[e]=r+o*c,r=l*c}n[u]=r}return n}function o(e,t,r,n,s){var o=s<e?s:e,l=[],c=i(e,n,t),u=function(e,t,r,a,n){var i=[];for(let w=0;w<=r;++w)i[w]=0;var s=[];for(let w=0;w<=a;++w)s[w]=i.slice(0);var o=[];for(let w=0;w<=r;++w)o[w]=i.slice(0);o[0][0]=1;var l=i.slice(0),c=i.slice(0);for(let w=1;w<=r;++w){l[w]=t-n[e+1-w],c[w]=n[e+w]-t;let r=0;for(let e=0;e<w;++e){var u=c[e+1],p=l[w-e],h=(o[w][e]=u+p,o[e][w-1]/o[w][e]);o[e][w]=r+u*h,r=p*h}o[w][w]=r}for(let w=0;w<=r;++w)s[0][w]=o[w][r];for(let w=0;w<=r;++w){let e=0,t=1;var d=[];for(let a=0;a<=r;++a)d[a]=i.slice(0);for(let n=d[0][0]=1;n<=a;++n){let a=0;var f=w-n,m=r-n,v=(w>=n&&(d[t][0]=d[e][0]/o[1+m][f],a=d[t][0]*o[f][m]),-1<=f?1:-f),g=w-1<=m?n-1:r-w;for(let r=v;r<=g;++r)d[t][r]=(d[e][r]-d[e][r-1])/o[1+m][f+r],a+=d[t][r]*o[f+r][m];w<=m&&(d[t][n]=-d[e][n-1]/o[1+m][w],a+=d[t][n]*o[w][m]),s[n][w]=a,v=e,e=t,t=v}}let y=r;for(let w=1;w<=a;++w){for(let e=0;e<=r;++e)s[w][e]*=y;y*=r-w}return s}(c,n,e,o,t),p=[];for(let a=0;a<r.length;++a){var h=r[a].clone(),d=h.w;h.x*=d,h.y*=d,h.z*=d,p[a]=h}for(let a=0;a<=o;++a){var f=p[c-e].clone().multiplyScalar(u[a][0]);for(let t=1;t<=e;++t)f.add(p[c-e+t].clone().multiplyScalar(u[a][t]));l[a]=f}for(let i=o+1;i<=s+1;++i)l[i]=new a.Ltg(0,0,0);return l}function l(e){var t=e.length,r=[],n=[];for(let l=0;l<t;++l){var i=e[l];r[l]=new a.Pa4(i.x,i.y,i.z),n[l]=i.w}var s=[];for(let a=0;a<t;++a){var o=r[a].clone();for(let e=1;e<=a;++e)o.sub(s[a-e].clone().multiplyScalar(function(e,t){let r=1;for(let n=2;n<=e;++n)r*=n;let a=1;for(let n=2;n<=t;++n)a*=n;for(let n=2;n<=e-t;++n)a*=n;return r/a}(a,e)*n[e]));s[a]=o.divideScalar(n[0])}return s}class c extends a.Hyl{constructor(e,t,r,n,i){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=i||this.knots.length-1;for(let o=0;o<r.length;++o){var s=r[o];this.controlPoints[o]=new a.Ltg(s.x,s.y,s.z,s.w)}}getPoint(e,t=new a.Pa4){return e=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),e=function(e,t,r,n){var o=i(e,n,t),l=s(o,n,e,t),c=new a.Ltg(0,0,0,0);for(let a=0;a<=e;++a){var u=r[o-e+a],p=l[a],h=u.w*p;c.x+=u.x*h,c.y+=u.y*h,c.z+=u.z*h,c.w+=u.w*p}return c}(this.degree,this.knots,this.controlPoints,e),1!==e.w&&e.divideScalar(e.w),t.set(e.x,e.y,e.z)}getTangent(e,t=new a.Pa4){e=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]);var r,n,i=(i=this.degree,r=this.knots,n=this.controlPoints,l(o(i,r,n,e,1)));return t.copy(i[1]).normalize(),t}}let u,p,h;class d extends a.aNw{constructor(e){super(e)}load(e,t,r,n){const i=this,s=""===i.path?a.Zp0.extractUrlBase(e):i.path;var o=new a.hH6(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r,s))}catch(r){n&&n(r),i.manager.itemError(e)}}),r,n)}parse(e,t){if(n="Kaydara FBX Binary  \0",(r=e).byteLength>=n.length&&n===M(r,0,n.length))u=(new y).parse(e);else{if(r=M(e),!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;for(let a=0;a<t.length;++a)if(function(t){var a=e[t-1];return e=e.slice(r+t),r++,a}(1)===t[a])return;return 1}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(x(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+x(r));u=(new g).parse(r)}var r,n=new a.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new f(n,this.manager).parse(u)}}class f{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){p=this.parseConnections();var e=this.parseImages(),t=(e=this.parseTextures(e),e=this.parseMaterials(e),this.parseDeformers()),r=(new m).parse(t);return this.parseScene(t,r,e),h}parseConnections(){const e=new Map;return"Connections"in u&&u.Connections.connections.forEach((function(t){var r=t[0],a=t[1],n=(t=t[2],e.has(r)||e.set(r,{parents:[],children:[]}),{ID:a,relationship:t});e.get(r).parents.push(n),e.has(a)||e.set(a,{parents:[],children:[]}),n={ID:r,relationship:t};e.get(a).children.push(n)})),e}parseImages(){var e={},t={};if("Video"in u.Objects){var r=u.Objects.Video;for(const s in r){var a,n,i=r[s];e[parseInt(s)]=i.RelativeFilename||i.Filename,"Content"in i&&(n=i.Content instanceof ArrayBuffer&&0<i.Content.byteLength,a="string"==typeof i.Content&&""!==i.Content,n||a)&&(n=this.parseImage(r[s]),t[i.RelativeFilename||i.Filename]=n)}}for(const o in e){var s=e[o];e[o]=void 0!==t[s]?t[s]:e[o].split("\\").pop()}return e}parseImage(e){var t=e.Content;e=e.RelativeFilename||e.Filename,e=e.slice(e.lastIndexOf(".")+1).toLowerCase();let r;switch(e){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga"),r="image/tga";break;default:return}return"string"==typeof t?"data:"+r+";base64,"+t:(e=new Uint8Array(t),window.URL.createObjectURL(new Blob([e],{type:r})))}parseTextures(e){var t=new Map;if("Texture"in u.Objects){var r=u.Objects.Texture;for(const n in r){var a=this.parseTexture(r[n],e);t.set(parseInt(n),a)}}return t}parseTexture(e,t){t=this.loadTexture(e,t);var r=(t.ID=e.id,t.name=e.attrName,e.WrapModeU),n=e.WrapModeV;r=void 0!==r?r.value:0,n=void 0!==n?n.value:0;return t.wrapS=0===r?a.rpg:a.uWy,t.wrapT=0===n?a.rpg:a.uWy,"Scaling"in e&&(r=e.Scaling.value,t.repeat.x=r[0],t.repeat.y=r[1]),"Translation"in e&&(n=e.Translation.value,t.offset.x=n[0],t.offset.y=n[1]),t}loadTexture(e,t){let r;var n=this.textureLoader.path,i=p.get(e.id).children;let s;return void 0!==i&&0<i.length&&void 0!==t[i[0].ID]&&(0!==(r=t[i[0].ID]).indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0)),t=e.FileName.slice(-3).toLowerCase(),s="tga"===t?null===(i=this.manager.getHandler(".tga"))?new a.xEZ:(i.setPath(this.textureLoader.path),i.load(r)):"psd"===t?new a.xEZ:this.textureLoader.load(r),this.textureLoader.setPath(n),s}parseMaterials(e){var t=new Map;if("Material"in u.Objects){var r=u.Objects.Material;for(const n in r){var a=this.parseMaterial(r[n],e);null!==a&&t.set(parseInt(n),a)}}return t}parseMaterial(e,t){var r=e.id,n=e.attrName;let i,s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!p.has(r))return null;switch(e=this.parseParameters(e,t,r),s.toLowerCase()){case"phong":i=new a.xoR;break;case"lambert":i=new a.YBo;break;default:i=new a.xoR}return i.setValues(e),i.name=n,i}parseParameters(e,t,r){const n={},i=(e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=(new a.Ilk).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(n.color=(new a.Ilk).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=(new a.Ilk).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(n.emissive=(new a.Ilk).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=(new a.Ilk).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(n.specular=(new a.Ilk).fromArray(e.SpecularColor.value)),this);return p.get(r).children.forEach((function(e){var r=e.relationship;switch(r){case"Bump":n.bumpMap=i.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":n.aoMap=i.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=i.getTexture(t,e.ID),void 0!==n.map&&(n.map.encoding=a.knz);break;case"DisplacementColor":n.displacementMap=i.getTexture(t,e.ID);break;case"EmissiveColor":n.emissiveMap=i.getTexture(t,e.ID),void 0!==n.emissiveMap&&(n.emissiveMap.encoding=a.knz);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=i.getTexture(t,e.ID);break;case"ReflectionColor":n.envMap=i.getTexture(t,e.ID),void 0!==n.envMap&&(n.envMap.mapping=a.dSO,n.envMap.encoding=a.knz);break;case"SpecularColor":n.specularMap=i.getTexture(t,e.ID),void 0!==n.specularMap&&(n.specularMap.encoding=a.knz);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=i.getTexture(t,e.ID),n.transparent=!0}})),n}getTexture(e,t){return"LayeredTexture"in u.Objects&&t in u.Objects.LayeredTexture&&(t=p.get(t).children[0].ID),e.get(t)}parseDeformers(){var e={},t={};if("Deformer"in u.Objects){var r=u.Objects.Deformer;for(const s in r){var a,n=r[s],i=p.get(parseInt(s));"Skin"===n.attrType?((a=this.parseSkeleton(i,r)).ID=s,i.parents.length,a.geometryID=i.parents[0].ID,e[s]=a):"BlendShape"===n.attrType&&((a={id:s}).rawTargets=this.parseMorphTargets(i,r),a.id=s,i.parents.length,t[s]=a)}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach((function(e){var n=t[e.ID];"Cluster"===n.attrType&&(e={ID:e.ID,indices:[],weights:[],transformLink:(new a.yGw).fromArray(n.TransformLink.a)},"Indexes"in n&&(e.indices=n.Indexes.a,e.weights=n.Weights.a),r.push(e))})),{rawBones:r,bones:[]}}parseMorphTargets(e,t){var r=[];for(let s=0;s<e.children.length;s++){var a=e.children[s],n=t[a.ID],i={name:n.attrName,initialWeight:n.DeformPercent,id:n.id,fullWeights:n.FullWeights.a};if("BlendShapeChannel"!==n.attrType)return;i.geoID=p.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(i)}return r}parseScene(e,t,r){h=new a.ZAu;const n=this.parseModels(e.skeletons,t,r),i=u.Objects.Model,s=this;n.forEach((function(e){var t=i[e.ID];s.setLookAtProperties(e,t),p.get(e.ID).parents.forEach((function(t){t=n.get(t.ID),void 0!==t&&t.add(e)})),null===e.parent&&h.add(e)})),this.bindSkeleton(e.skeletons,t,n),this.createAmbientLight(),h.traverse((function(e){var t;e.userData.transformData&&(e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld),t=D(e.userData.transformData),e.applyMatrix4(t),e.updateWorldMatrix())})),r=(new v).parse(),1===h.children.length&&h.children[0].isGroup&&(h.children[0].animations=r,h=h.children[0]),h.animations=r}parseModels(e,t,r){var n=new Map,i=u.Objects.Model;for(const c in i){var s=parseInt(c),o=i[c],l=p.get(s);let u=this.buildSkeleton(l,e,s,o.attrName);if(!u){switch(o.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,t,r);break;case"NurbsCurve":u=this.createCurve(l,t);break;case"LimbNode":case"Root":u=new a.N$j;break;default:u=new a.ZAu}u.name=o.attrName?a.iUV.sanitizeNodeName(o.attrName):"",u.ID=s}this.getTransformData(u,o),n.set(s,u)}return n}buildSkeleton(e,t,r,n){let i=null;return e.parents.forEach((function(e){for(const s in t){const o=t[s];o.rawBones.forEach((function(t,s){var l;t.ID===e.ID&&(l=i,(i=new a.N$j).matrixWorld.copy(t.transformLink),i.name=n?a.iUV.sanitizeNodeName(n):"",i.ID=r,o.bones[s]=i,null!==l)&&i.add(l)}))}})),i}createCamera(e){let t,r;if(e.children.forEach((function(e){e=u.Objects.NodeAttribute[e.ID],void 0!==e&&(r=e)})),void 0===r)t=new a.Tme;else{let e=0,s=(void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1),1),o=(void 0!==r.NearPlane&&(s=r.NearPlane.value/1e3),1e3),l=(void 0!==r.FarPlane&&(o=r.FarPlane.value/1e3),window.innerWidth),c=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(l=r.AspectWidth.value,c=r.AspectHeight.value);var n=l/c;let u=45;void 0!==r.FieldOfView&&(u=r.FieldOfView.value);var i=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new a.cPb(u,n,s,o),null!==i&&t.setFocalLength(i);break;case 1:t=new a.iKG(-l/2,l/2,c/2,-c/2,s,o);break;default:t=new a.Tme}}return t}createLight(e){let t,r;if(e.children.forEach((function(e){e=u.Objects.NodeAttribute[e.ID],void 0!==e&&(r=e)})),void 0===r)t=new a.Tme;else{let e,n=(e=void 0===r.LightType?0:r.LightType.value,16777215),i=(void 0!==r.Color&&(n=(new a.Ilk).fromArray(r.Color.value)),void 0===r.Intensity?1:r.Intensity.value/100),s=(void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(i=0),0);switch(void 0!==r.FarAttenuationEnd&&(s=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),e){case 0:t=new a.cek(n,i,s,1);break;case 1:t=new a.Ox3(n,i);break;case 2:let e=Math.PI/3,o=(void 0!==r.InnerAngle&&(e=a.M8C.degToRad(r.InnerAngle.value)),0);void 0!==r.OuterAngle&&(o=a.M8C.degToRad(r.OuterAngle.value),o=Math.max(o,1)),t=new a.PMe(n,i,s,e,o,1);break;default:t=new a.cek(n,i)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let n,i=null,s=null;const o=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))})),1<o.length?s=o:0<o.length?s=o[0]:(s=new a.xoR({color:13421772}),o.push(s)),"color"in i.attributes&&o.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(n=new a.TUv(i,s)).normalizeSkinWeights():n=new a.Kj0(i,s),n}createCurve(e,t){e=e.children.reduce((function(e,r){return t.has(r.ID)?t.get(r.ID):e}),null);var r=new a.nls({color:3342591,linewidth:1});return new a.x12(e,r)}getTransformData(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?N(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&p.get(e.ID).children.forEach((function(t){"LookAtProperty"===t.relationship&&"Lcl_Translation"in(t=u.Objects.Model[t.ID])&&(t=t.Lcl_Translation.value,void 0!==e.target?(e.target.position.fromArray(t),h.add(e.target)):e.lookAt((new a.Pa4).fromArray(t)))}))}bindSkeleton(e,t,r){const n=this.parsePoseNodes();for(const i in e){const s=e[i];p.get(parseInt(s.ID)).parents.forEach((function(e){t.has(e.ID)&&(e=e.ID,p.get(e).parents.forEach((function(e){r.has(e.ID)&&r.get(e.ID).bind(new a.OdW(s.bones),n[e.ID])})))}))}}parsePoseNodes(){const e={};if("Pose"in u.Objects){var t,r=u.Objects.Pose;for(const n in r)"BindPose"===r[n].attrType&&0<r[n].NbPoseNodes&&(t=r[n].PoseNode,Array.isArray(t)?t.forEach((function(t){e[t.Node]=(new a.yGw).fromArray(t.Matrix.a)})):e[t.Node]=(new a.yGw).fromArray(t.Matrix.a))}return e}createAmbientLight(){var e,t,r;"GlobalSettings"in u&&"AmbientColor"in u.GlobalSettings&&(r=(t=u.GlobalSettings.AmbientColor.value)[0],e=t[1],t=t[2],0===r&&0===e&&0===t||(r=new a.Ilk(r,e,t),h.add(new a.Mig(r,1))))}}class m{constructor(){this.negativeMaterialIndices=!1}parse(e){var t=new Map;if("Geometry"in u.Objects){var r=u.Objects.Geometry;for(const n in r){var a=p.get(parseInt(n));a=this.parseGeometry(a,r[n],e);t.set(parseInt(n),a)}}return this.negativeMaterialIndices,t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const a=r.skeletons,n=[];var i,s=e.parents.map((function(e){return u.Objects.Model[e.ID]}));if(0!==s.length)return i=e.children.reduce((function(e,t){return void 0!==a[t.ID]?a[t.ID]:e}),null),e.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&n.push(r.morphTargets[e.ID])})),e={},"RotationOrder"in(s=s[0])&&(e.eulerOrder=N(s.RotationOrder.value)),"InheritType"in s&&(e.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(e.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(e.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(e.scale=s.GeometricScaling.value),s=D(e),this.genGeometry(t,i,n,s)}genGeometry(e,t,r,n){const i=new a.u9r;e.attrName&&(i.name=e.attrName);var s=this.parseGeoNode(e,t);const o=this.genBuffers(s);var l=new a.a$l(o.vertex,3);if(l.applyMatrix4(n),i.setAttribute("position",l),0<o.colors.length&&i.setAttribute("color",new a.a$l(o.colors,3)),t&&(i.setAttribute("skinIndex",new a.qlB(o.weightsIndices,4)),i.setAttribute("skinWeight",new a.a$l(o.vertexWeights,4)),i.FBX_Deformer=t),0<o.normal.length&&(l=(new a.Vkp).getNormalMatrix(n),(t=new a.a$l(o.normal,3)).applyNormalMatrix(l),i.setAttribute("normal",t)),o.uvs.forEach((function(e,t){let r="uv"+(t+1).toString();0===t&&(r="uv"),i.setAttribute(r,new a.a$l(o.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=o.materialIndex[0],r=0;o.materialIndex.forEach((function(t,a){t!==e&&(i.addGroup(r,a-r,e),e=t,r=a)})),0<i.groups.length&&(t=(l=i.groups[i.groups.length-1]).start+l.count)!==o.materialIndex.length&&i.addGroup(t,o.materialIndex.length-t,e),0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,r,n),i}parseGeoNode(e,t){const r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t).rawBones.forEach((function(e,t){e.indices.forEach((function(a,n){void 0===r.weightTable[a]&&(r.weightTable[a]=[]),r.weightTable[a].push({id:t,weight:e.weights[n]})}))})),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,a=0,n=!1,i=[],s=[],o=[],l=[],c=[],u=[];const p=this;return e.vertexIndices.forEach((function(h,d){let f,m=!1,v=(h<0&&(h^=-1,m=!0),[]),g=[];var y;if(i.push(3*h,3*h+1,3*h+2),e.color&&(y=P(d,r,h,e.color),o.push(y[0],y[1],y[2])),e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach((function(e){g.push(e.weight),v.push(e.id)})),4<g.length){n=n||!0;const e=[0,0,0,0],t=[0,0,0,0];g.forEach((function(r,a){let n=r,i=v[a];t.forEach((function(t,r,a){n>t&&(a[r]=n,n=t,a=e[r],e[r]=i,i=a)}))})),v=e,g=t}for(;g.length<4;)g.push(0),v.push(0);for(let e=0;e<4;++e)c.push(g[e]),u.push(v[e])}e.normal&&(y=P(d,r,h,e.normal),s.push(y[0],y[1],y[2])),e.material&&"AllSame"!==e.material.mappingType&&(f=P(d,r,h,e.material)[0])<0&&(p.negativeMaterialIndices=!0,f=0),e.uv&&e.uv.forEach((function(e,t){e=P(d,r,h,e),void 0===l[t]&&(l[t]=[]),l[t].push(e[0]),l[t].push(e[1])})),a++,m&&(p.genFace(t,e,i,f,s,o,l,c,u,a),r++,a=0,i=[],s=[],o=[],l=[],c=[],u=[])})),t}genFace(e,t,r,a,n,i,s,o,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[4*(u-1)]),e.vertexWeights.push(o[4*(u-1)+1]),e.vertexWeights.push(o[4*(u-1)+2]),e.vertexWeights.push(o[4*(u-1)+3]),e.vertexWeights.push(o[4*u]),e.vertexWeights.push(o[4*u+1]),e.vertexWeights.push(o[4*u+2]),e.vertexWeights.push(o[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[3*(u-1)]),e.colors.push(i[3*(u-1)+1]),e.colors.push(i[3*(u-1)+2]),e.colors.push(i[3*u]),e.colors.push(i[3*u+1]),e.colors.push(i[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[3*(u-1)]),e.normal.push(n[3*(u-1)+1]),e.normal.push(n[3*(u-1)+2]),e.normal.push(n[3*u]),e.normal.push(n[3*u+1]),e.normal.push(n[3*u+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(s[r][0]),e.uvs[r].push(s[r][1]),e.uvs[r].push(s[r][2*(u-1)]),e.uvs[r].push(s[r][2*(u-1)+1]),e.uvs[r].push(s[r][2*u]),e.uvs[r].push(s[r][2*u+1])}))}addMorphTargets(e,t,r,a){if(0!==r.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];const n=this;r.forEach((function(r){r.rawTargets.forEach((function(r){var i=u.Objects.Geometry[r.geoID];void 0!==i&&n.genMorphGeometry(e,t,i,a,r.name)}))}))}}genMorphGeometry(e,t,r,n,i){t=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[];var s=void 0!==r.Vertices?r.Vertices.a:[],o=void 0!==r.Indexes?r.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l);for(let a=0;a<o.length;a++){var u=3*o[a];c[u]=s[3*a],c[1+u]=s[3*a+1],c[2+u]=s[3*a+2]}l=this.genBuffers({vertexIndices:t,vertexPositions:c}),t=new a.a$l(l.vertex,3),t.name=i||r.attrName,t.applyMatrix4(n),e.morphAttributes.position.push(t)}parseNormals(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.Normals.a;let n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:n,mappingType:t,referenceType:r}}parseUVs(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;let a=[];return{dataSize:2,buffer:e.UV.a,indices:a="IndexToDirect"===r?e.UVIndex.a:a,mappingType:t,referenceType:r}}parseVertexColors(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;let a=[];return{dataSize:4,buffer:e.Colors.a,indices:a="IndexToDirect"===r?e.ColorIndex.a:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};var a=e.Materials.a,n=[];for(let i=0;i<a.length;++i)n.push(i);return{dataSize:1,buffer:a,indices:n,mappingType:t,referenceType:r}}parseNurbsGeometry(e){var t=parseInt(e.Order);if(isNaN(t))return new a.u9r;var r=t-1,n=(t=e.KnotVector.a,[]),i=e.Points.a;for(let l=0,c=i.length;l<c;l+=4)n.push((new a.Ltg).fromArray(i,l));let s,o;if("Closed"===e.Form)n.push(n[0]);else if("Periodic"===e.Form){s=r,o=t.length-1-s;for(let e=0;e<r;++e)n.push(n[e])}return e=new c(r,t,n,s,o).getPoints(12*n.length),(new a.u9r).setFromPoints(e)}}class v{parse(){var e=[],t=this.parseClips();if(void 0!==t)for(const a in t){var r=t[a];r=this.addClip(r);e.push(r)}return e}parseClips(){var e;if(void 0!==u.Objects.AnimationCurve)return e=this.parseAnimationCurveNodes(),this.parseAnimationCurves(e),e=this.parseAnimationLayers(e),this.parseAnimStacks(e)}parseAnimationCurveNodes(){var e=u.Objects.AnimationCurveNode,t=new Map;for(const a in e){var r=e[a];null!==r.attrName.match(/S|R|T|DeformPercent/)&&(r={id:r.id,attr:r.attrName,curves:{}},t.set(r.id,r))}return t}parseAnimationCurves(e){var t=u.Objects.AnimationCurve;for(const i in t){var r,a={id:t[i].id,times:t[i].KeyTime.a.map(b),values:t[i].KeyValueFloat.a},n=p.get(a.id);void 0!==n&&(r=n.parents[0].ID,(n=n.parents[0].relationship).match(/X/)?e.get(r).curves.x=a:n.match(/Y/)?e.get(r).curves.y=a:n.match(/Z/)?e.get(r).curves.z=a:n.match(/d|DeformPercent/)&&e.has(r)&&(e.get(r).curves.morph=a))}}parseAnimationLayers(e){var t=u.Objects.AnimationLayer,r=new Map;for(const i in t){const t=[];var n=p.get(parseInt(i));void 0!==n&&(n.children.forEach((function(r,n){if(e.has(r.ID)){var i=e.get(r.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===t[n]){var s=p.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==s){const e=u.Objects.Model[s.toString()];if(void 0===e)return;const r={modelName:e.attrName?a.iUV.sanitizeNodeName(e.attrName):"",ID:e.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};h.traverse((function(t){t.ID===e.id&&(r.transform=t.matrix,t.userData.transformData)&&(r.eulerOrder=t.userData.transformData.eulerOrder)})),r.transform||(r.transform=new a.yGw),"PreRotation"in e&&(r.preRotation=e.PreRotation.value),"PostRotation"in e&&(r.postRotation=e.PostRotation.value),t[n]=r}}t[n]&&(t[n][i.attr]=i)}else void 0!==i.curves.morph&&(void 0===t[n]&&(s=p.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,r=p.get(s).parents[0].ID,r=p.get(r).parents[0].ID,r=p.get(r).parents[0].ID,r={modelName:(r=u.Objects.Model[r]).attrName?a.iUV.sanitizeNodeName(r.attrName):"",morphName:u.Objects.Deformer[s].attrName},t[n]=r),t[n][i.attr]=i)}})),r.set(parseInt(i),t))}return r}parseAnimStacks(e){var t=u.Objects.AnimationStack,r={};for(const n in t){var a=p.get(parseInt(n)).children;a=(a.length,e.get(a[0].ID));r[n]={name:t[n].attrName,layer:a}}return r}addClip(e){let t=[];const r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new a.m7l(e.name,-1,t)}generateTracks(e){var t=[];let r=new a.Pa4;var n,i=new a._fP;let s=new a.Pa4;return e.transform&&e.transform.decompose(r,i,s),r=r.toArray(),i=(new a.USm).setFromQuaternion(i,e.eulerOrder).toArray(),s=s.toArray(),void 0!==e.T&&0<Object.keys(e.T.curves).length&&void 0!==(n=this.generateVectorTrack(e.modelName,e.T.curves,r,"position"))&&t.push(n),void 0!==e.R&&0<Object.keys(e.R.curves).length&&void 0!==(n=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder))&&t.push(n),void 0!==e.S&&0<Object.keys(e.S.curves).length&&void 0!==(i=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale"))&&t.push(i),void 0!==e.DeformPercent&&void 0!==(n=this.generateMorphTrack(e))&&t.push(n),t}generateVectorTrack(e,t,r,n){var i=this.getTimesForAllAxes(t);t=this.getKeyframeTrackValues(i,t,r);return new a.yC1(e+"."+n,i,t)}generateRotationTrack(e,t,r,n,i,s){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(a.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(a.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(a.M8C.degToRad));var o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,r),c=(void 0!==n&&((n=n.map(a.M8C.degToRad)).push(s),n=(new a.USm).fromArray(n),n=(new a._fP).setFromEuler(n)),void 0!==i&&((i=i.map(a.M8C.degToRad)).push(s),i=(new a.USm).fromArray(i),i=(new a._fP).setFromEuler(i).invert()),new a._fP),u=new a.USm,p=[];for(let a=0;a<l.length;a+=3)u.set(l[a],l[a+1],l[a+2],s),c.setFromEuler(u),void 0!==n&&c.premultiply(n),void 0!==i&&c.multiply(i),c.toArray(p,a/3*4);return new a.iLg(e+".quaternion",o,p)}generateMorphTrack(e){var t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),n=h.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new a.dUE(e.modelName+".morphTargetInfluences["+n+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),1<(t=(t=void 0!==e.z?t.concat(e.z.times):t).sort((function(e,t){return e-t}))).length){let e=1,a=t[0];for(let n=1;n<t.length;n++){var r=t[n];r!==a&&(t[e]=r,a=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){const a=r,n=[];let i=-1,s=-1,o=-1;return e.forEach((function(e){t.x&&(i=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==i?(e=t.x.values[i],n.push(e),a[0]=e):n.push(a[0]),-1!==s?(e=t.y.values[s],n.push(e),a[1]=e):n.push(a[1]),-1!==o?(e=t.z.values[o],n.push(e),a[2]=e):n.push(a[2])})),n}interpolateRotations(e){for(let l=1;l<e.values.length;l++){var t=e.values[l-1],r=e.values[l]-t,a=Math.abs(r);if(180<=a){a=a/180;var n=r/a;let c=t+n;r=e.times[l-1];var i=(e.times[l]-r)/a;let u=r+i;for(var s=[],o=[];u<e.times[l];)s.push(u),u+=i,o.push(c),c+=n;e.times=S(e.times,l,s),e.values=S(e.values,l,o)}}}}class g{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),--this.currentIndent}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new I,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,a){var n,i=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);i||s||(i=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),n=e.match("^\\t{"+(t.currentIndent-1)+"}}"),i?t.parseNodeBegin(e,i):s?t.parseNodeProperty(e,s,r[++a]):n?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e))})),this.allNodes}parseNodeBegin(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),a=(t=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),{name:r}),n=(t=this.parseNodeAttr(t),this.getCurrentNode());0===this.currentIndent?this.allNodes.add(r,a):r in n?("PoseNode"===r?n.PoseNode.push(a):void 0!==n[r].id&&(n[r]={},n[r][n[r].id]=n[r]),""!==t.id&&(n[r][t.id]=a)):"number"==typeof t.id?(n[r]={},n[r][t.id]=a):"Properties70"!==r&&(n[r]="PoseNode"===r?[a]:a),"number"==typeof t.id&&(a.id=t.id),""!==t.name&&(a.attrName=t.name),""!==t.type&&(a.attrType=t.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0],r=(""!==e[0]&&(t=parseInt(e[0]),isNaN(t))&&(t=e[0]),""),a="";return 1<e.length&&(r=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:t,name:r,type:a}}parseNodeProperty(e,t,r){let a=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();if("Content"===a&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim()),t=this.getCurrentNode(),"Properties70"===t.name)this.parseNodeSpecialProperty(e,a,n);else{if("C"===a){r=n.split(",").slice(1),e=parseInt(r[0]),r=parseInt(r[1]);let o=n.split(",").slice(3);o=o.map((function(e){return e.trim().replace(/^"/,"")})),a="connections";var i=n=[e,r],s=o;for(let e=0,t=i.length,r=s.length;e<r;e++,t++)i[t]=s[e];void 0===t[a]&&(t[a]=[])}"Node"===a&&(t.id=n),a in t&&Array.isArray(t[a])?t[a].push(n):"a"!==a?t[a]=n:t.a=n,this.setCurrentProp(t,a),"a"===a&&","!==n.slice(-1)&&(t.a=C(n))}}parseNodePropertyContinued(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=C(t.a))}parseNodeSpecialProperty(e,t,r){r=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}));var a=r[0],n=r[1],i=r[2],s=r[3];let o=r[4];switch(n){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":o=parseFloat(o);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":o=C(o)}this.getPrevNode()[a]={type:n,type2:i,flag:s,value:o},this.setCurrentProp(this.getPrevNode(),a)}}class y{parse(e){var t=new w(e),r=(t.skip(23),t.getUint32());if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);for(var a=new I;!this.endOfContent(t);){var n=this.parseNode(t,r);null!==n&&a.add(n.name,n)}return a}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){var r={},a=7500<=t?e.getUint64():e.getUint32(),n=7500<=t?e.getUint64():e.getUint32(),i=(7500<=t?e.getUint64():e.getUint32(),e.getUint8()),s=e.getString(i);if(0===a)return null;var o=[];for(let p=0;p<n;p++)o.push(this.parseProperty(e));i=0<o.length?o[0]:"";var l=1<o.length?o[1]:"",c=2<o.length?o[2]:"";for(r.singleProperty=1===n&&e.getOffset()===a;a>e.getOffset();){var u=this.parseNode(e,t);null!==u&&this.parseSubNode(s,r,u)}return r.propertyList=o,"number"==typeof i&&(r.id=i),""!==l&&(r.attrName=l),""!==c&&(r.attrType=c),""!==s&&(r.name=s),r}parseSubNode(e,t,r){if(!0===r.singleProperty){var a=r.propertyList[0];Array.isArray(a)?(t[r.name]=r).a=a:t[r.name]=a}else if("Connections"===e&&"C"===r.name){const e=[];r.propertyList.forEach((function(t,r){0!==r&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach((function(e){t[e]=r[e]}));else if("Properties70"===e&&"P"===r.name){let n,i=r.propertyList[0],s=r.propertyList[1];a=r.propertyList[2],e=r.propertyList[3],0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),n="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[i]={type:s,type2:a,flag:e,value:n}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){var t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var a=e.getUint32(),i=e.getUint32(),s=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}i=n.HT(new Uint8Array(e.getArrayBuffer(s)));var o=new w(i.buffer);switch(t){case"b":case"c":return o.getBooleanArray(a);case"d":return o.getFloat64Array(a);case"f":return o.getFloat32Array(a);case"i":return o.getInt32Array(a);case"l":return o.getInt64Array(a)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class w{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){var t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){var t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){var t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){var t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){var t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let a=0;a<e;a++)t[a]=this.getUint8();var r=t.indexOf(0);return 0<=r&&(t=t.slice(0,r)),a.Zp0.decodeText(new Uint8Array(t))}}class I{add(e,t){this[e]=t}}function x(e){if(e=e.match(/FBXVersion: (\d+)/),e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function b(e){return e/46186158e3}const T=[];function P(e,t,r,a){let n;switch(a.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=r;break;case"AllSame":n=a.indices[0]}var i=(n="IndexToDirect"===a.referenceType?a.indices[n]:n)*a.dataSize,s=i+a.dataSize,o=T,l=a.buffer,c=s;for(let u=i,p=0;u<c;u++,p++)o[p]=l[u];return o}const k=new a.USm,A=new a.Pa4;function D(e){var t=new a.yGw,r=new a.yGw,n=new a.yGw,i=new a.yGw,s=new a.yGw,o=new a.yGw,l=new a.yGw,c=new a.yGw,u=new a.yGw,p=new a.yGw,h=new a.yGw,d=new a.yGw,f=e.inheritType||0,m=(e.translation&&t.setPosition(A.fromArray(e.translation)),e.preRotation&&((m=e.preRotation.map(a.M8C.degToRad)).push(e.eulerOrder||a.USm.DefaultOrder),r.makeRotationFromEuler(k.fromArray(m))),e.rotation&&((m=e.rotation.map(a.M8C.degToRad)).push(e.eulerOrder||a.USm.DefaultOrder),n.makeRotationFromEuler(k.fromArray(m))),e.postRotation&&((m=e.postRotation.map(a.M8C.degToRad)).push(e.eulerOrder||a.USm.DefaultOrder),i.makeRotationFromEuler(k.fromArray(m)),i.invert()),e.scale&&s.scale(A.fromArray(e.scale)),e.scalingOffset&&l.setPosition(A.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(A.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(A.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(A.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),p.copy(e.parentMatrixWorld)),r.clone().multiply(n).multiply(i)),v=(e=new a.yGw,e.extractRotation(p),new a.yGw),g=(v=(v.copyPosition(p),v.clone().invert().multiply(p)),v=e.clone().invert().multiply(v),s),y=new a.yGw;(0===f?y.copy(e).multiply(m).multiply(v):1===f?y.copy(e).multiply(v).multiply(m):(f=(new a.yGw).scale((new a.Pa4).setFromMatrixScale(h)).clone().invert(),h=v.clone().multiply(f),y.copy(e).multiply(m).multiply(h))).multiply(g),v=u.clone().invert(),f=o.clone().invert(),e=t.clone().multiply(c).multiply(u).multiply(r).multiply(n).multiply(i).multiply(v).multiply(l).multiply(o).multiply(s).multiply(f),m=(new a.yGw).copyPosition(e),h=p.clone().multiply(m);return d.copyPosition(h),(e=d.clone().multiply(y)).premultiply(p.invert()),e}function N(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?t[0]:t[e]}function C(e){return e.split(",").map((function(e){return parseFloat(e)}))}function M(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),a.Zp0.decodeText(new Uint8Array(e,t,r))}function S(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}}}]);