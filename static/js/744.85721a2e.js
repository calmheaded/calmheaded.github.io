"use strict";(self.webpackChunkthree_model_viewer=self.webpackChunkthree_model_viewer||[]).push([[744],{6744:function(e,t,n){n.r(t),n.d(t,{AMFLoader:function(){return o}});var a=n(216),r=n(6925);class o extends a.aNw{constructor(e){super(e)}load(e,t,n,r){const o=this;var l=new a.hH6(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,(function(n){try{t(o.parse(n))}catch(n){r&&r(n),o.manager.itemError(e)}}),n,r)}parse(e){function t(e){var t={r:1,g:1,b:1,a:1};for(let a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}function n(e){var n=e.attributes.id.textContent,a={name:"amfobject",meshes:[]};let r=null,o=e.firstElementChild;for(;o;){if("metadata"===o.nodeName)void 0!==o.attributes.type&&"name"===o.attributes.type.value&&(a.name=o.textContent);else if("color"===o.nodeName)r=t(o);else if("mesh"===o.nodeName){let e=o.firstElementChild;for(var l,i={vertices:[],normals:[],volumes:[],color:r};e;)"vertices"===e.nodeName?(l=function(e){var t,n,a,r=[],o=[];let l=e.firstElementChild;for(;l;){if("vertex"===l.nodeName){let e=l.firstElementChild;for(;e;)"coordinates"===e.nodeName?(t=e.getElementsByTagName("x")[0].textContent,n=e.getElementsByTagName("y")[0].textContent,a=e.getElementsByTagName("z")[0].textContent,r.push(t,n,a)):"normal"===e.nodeName&&(t=e.getElementsByTagName("nx")[0].textContent,n=e.getElementsByTagName("ny")[0].textContent,a=e.getElementsByTagName("nz")[0].textContent,o.push(t,n,a)),e=e.nextElementSibling}l=l.nextElementSibling}return{vertices:r,normals:o}}(e),i.normals=i.normals.concat(l.normals),i.vertices=i.vertices.concat(l.vertices)):"volume"===e.nodeName&&i.volumes.push(function(e){var t,n,a,r={name:"",triangles:[],materialid:null};let o=e.firstElementChild;for(void 0!==e.attributes.materialid&&(r.materialId=e.attributes.materialid.nodeValue);o;)"metadata"===o.nodeName?void 0!==o.attributes.type&&"name"===o.attributes.type.value&&(r.name=o.textContent):"triangle"===o.nodeName&&(t=o.getElementsByTagName("v1")[0].textContent,n=o.getElementsByTagName("v2")[0].textContent,a=o.getElementsByTagName("v3")[0].textContent,r.triangles.push(t,n,a)),o=o.nextElementSibling;return r}(e)),e=e.nextElementSibling;a.meshes.push(i)}o=o.nextElementSibling}return{id:n,obj:a}}e=function(t){let n=new DataView(t);if("PK"===String.fromCharCode(n.getUint8(0),n.getUint8(1))){let a=null,o=null;try{a=r.GZ(new Uint8Array(t))}catch(e){if(e instanceof ReferenceError)return null}for(o in a)if(".amf"===o.toLowerCase().slice(-4))break;n=new DataView(a[o].buffer)}return t=a.Zp0.decodeText(n),"amf"!==(t=(new DOMParser).parseFromString(t,"application/xml")).documentElement.nodeName.toLowerCase()?null:t}(e);let o="",l="";var i=function(e){let t=1,n="millimeter";return void 0!==e.documentElement.attributes.unit&&(n=e.documentElement.attributes.unit.value.toLowerCase()),e={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001},void 0!==e[n]?e[n]:t}(e),m={},s={},d=e.documentElement.childNodes;let u,c;for(u=0;u<d.length;u++){var f,v=d[u];"metadata"===v.nodeName?void 0!==v.attributes.type&&("name"===v.attributes.type.value?o=v.textContent:"author"===v.attributes.type.value&&(l=v.textContent)):"material"===v.nodeName?m[(f=function(e){let n="AMF Material";var r=e.attributes.id.textContent;let o={r:1,g:1,b:1,a:1};var l=null;for(let a=0;a<e.childNodes.length;a++){var i=e.childNodes[a];"metadata"===i.nodeName&&void 0!==i.attributes.type?"name"===i.attributes.type.value&&(n=i.textContent):"color"===i.nodeName&&(o=t(i))}return l=new a.xoR({flatShading:!0,color:new a.Ilk(o.r,o.g,o.b),name:n}),1!==o.a&&(l.transparent=!0,l.opacity=o.a),{id:r,material:l}}(v)).id]=f.material:"object"===v.nodeName&&(s[(f=n(v)).id]=f.obj)}var g=new a.ZAu,h=new a.xoR({color:11184895,flatShading:!0});g.name=o,g.userData.author=l,g.userData.loader="AMF";for(const r in s){var b=s[r],N=b.meshes,x=new a.ZAu;for(x.name=b.name||"",u=0;u<N.length;u++){let e=h;var C,p=N[u],y=new a.a$l(p.vertices,3);let t=null;p.normals.length&&(t=new a.a$l(p.normals,3)),p.color&&(C=p.color,(e=h.clone()).color=new a.Ilk(C.r,C.g,C.b),1!==C.a)&&(e.transparent=!0,e.opacity=C.a);var w=p.volumes;for(c=0;c<w.length;c++){var E=w[c],T=new a.u9r;let n=e;T.setIndex(E.triangles),T.setAttribute("position",y.clone()),t&&T.setAttribute("normal",t.clone()),void 0!==m[E.materialId]&&(n=m[E.materialId]),T.scale(i,i,i),x.add(new a.Kj0(T,n.clone()))}}g.add(x)}return g}}}}]);